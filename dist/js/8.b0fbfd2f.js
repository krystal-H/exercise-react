(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"65m2":function(e,t,a){},"6MFL":function(e,t,a){},NAHi:function(e,t,a){"use strict";a.r(t);a("pNMO"),a("4Brf"),a("0oug"),a("4mDm"),a("07d7"),a("PKPk"),a("3bBZ");var n=a("q1tI"),r=a.n(n),c=(a("yq1k"),a("L/Qf"),a("2/Rp")),i=a("L60R"),l=(a("kyDF"),r.a.memo(function(e){var t=e.dataAnalysisName,a=void 0===t?"未命名":t,n=e.analysisiType,l=e.testEnv,o=function(){i.b.next("save")};return r.a.createElement("header",{className:"data-analysis-header"},r.a.createElement("span",{className:"d-a-name"},a),r.a.createElement("div",{className:"tools-wrapper"},3===n?r.a.createElement(r.a.Fragment,null,r.a.createElement(c.a,{type:"primary",size:"small",onClick:function(){i.c.next("text")},icon:"bug"},"调试"),r.a.createElement(c.a,{type:"primary",size:"small",onClick:o,disabled:![0,1,3].includes(l),icon:"save"},"保存"),r.a.createElement(c.a,{type:"primary",size:"small",onClick:function(){i.a.next("publish")},disabled:![1,3].includes(l),icon:"cloud-upload"},"发布")):r.a.createElement(r.a.Fragment,null,r.a.createElement(c.a,{type:"primary",size:"small",onClick:o,icon:"save"},"保存"))))})),o=a("Cr9J"),u=(a("TeQF"),a("2B1R"),a("+2oP"),a("sMBO"),a("5DmW"),a("27RR"),a("tkto"),a("5s+n"),a("p532"),a("Rm1S"),a("FZtP"),a("1vPl"),a("5rEg")),s=(a("AUBz"),a("ZTPi")),d=(a("ma9I"),a("8QGh"),a("2fM7")),m=(a("dlhN"),a("MJZm")),p=(a("wJTb"),a("Nlzp"));function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}u.a.Search,m.a.TreeNode;var y=d.a.Option;function b(e){var t=e.setSelectedData,a=e.setPropsProductId,c=e.productId,i=v(Object(n.useState)([]),2),l=i[0],o=i[1],u=v(Object(n.useState)(0),2),s=(u[0],u[1],v(Object(n.useState)([]),2)),f=s[0],b=s[1],E=v(Object(n.useState)({properties:[],events:[]}),2),g=E[0],h=E[1],O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.properties,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.events,a=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],e.map(function(e){var t=e.name,a=e.dataType.type;return{key:"设备属性表.".concat(t),title:"".concat(t," (").concat(a,")")}})),n=t.map(function(e){var t=e.identifier,a=e.name,n=e.outputData,r={title:a,key:"_events_|"+t,disabled:!0};return n&&n.length>0&&(r.children=n.map(function(e){var t=e.name,a=e.dataType.type;return{key:"设备事件表.".concat(t),title:"".concat(t," (").concat(a,")")}})),r});return[{title:"设备属性表",key:"设备属性表",children:a},{title:"设备事件表",key:"设备事件表",children:n}]};Object(n.useEffect)(function(){Object(p.c)(p.a.getProductList,{pageRows:9999,instanceId:2},{needVersion:1.2}).then(function(e){var t=e.data&&e.data.list||[];o(t)})},[]),Object(n.useEffect)(function(){},[]),Object(n.useEffect)(function(){c&&function(e){Object(p.c)(p.a.getTsl,{productId:e}).then(function(e){var t=e.data,a=JSON.parse(t),n=a.properties,r=void 0===n?[]:n,c=a.events,i=void 0===c?[]:c;h({properties:r,events:i}),b(O(r,i))})}(c)},[c]);return r.a.createElement("div",{className:"sql"},r.a.createElement("div",{className:"tree-content"},r.a.createElement(d.a,{className:"proselect",placeholder:"请先选择产品",value:c,onChange:function(e){a(e),b([])},showSearch:!0,optionFilterProp:"children"},l.map(function(e){var t=e.productId,a=e.productName;return r.a.createElement(y,{key:t,value:t},a)})),r.a.createElement(m.a,{autoExpandParent:!0,defaultExpandAll:!0,treeData:f,onSelect:function(e){console.log(e),t(e)}})))}function E(e){var t,a=e.setSelectedData,c=e.proLogicData,i=(t="",function e(a){var n=[];for(var r in a){var c=a[r],i={title:r,key:t&&"".concat(t,".").concat(r)||r};c&&"object"===f(c)?(t=t&&"".concat(t,".").concat(r)||r,i.children=e(c)):i.title="".concat(r," (").concat(c,")"),n.push(i)}return t="",n}(c));Object(n.useEffect)(function(){},[]);return r.a.createElement("div",{className:"sql"},r.a.createElement("div",{className:"tree-content"},r.a.createElement(m.a,{autoExpandParent:!0,defaultExpandAll:!0,treeData:i,onSelect:function(e){console.log(e),a(e)}})))}a("pjDv"),a("JfAA"),a("2oDE");var g=a("CtXQ"),h=(a("k3Gp"),a("kLXV")),O=(a("mbEz"),a("wCAj")),I=(a("MKzF"),a("kaz8")),j=(a("tULf"),a("Vl3Y")),w=(a("GRva"),a("gK9i")),S=a("BkRI"),k=a.n(S),T=a("P2RN"),N=a("DgvE");function C(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function A(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function x(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function P(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?x(a,!0).forEach(function(t){D(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):x(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function D(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var q=w.a.Panel;j.a.create({name:"sql-config"})(function(e){var t=e.visible,a=e.cancelHandle,n=e.form,c=e.requestList,i=void 0===c?[]:c,l=e.responseList,o=void 0===l?[]:l,s=e.invokeUrl,d=e.setConfigModalData,m=e.saveData,p=e.apiName,f=e.onPage,v=n.getFieldDecorator,y=(n.setFieldsValue,function(e,t,a,n){d(function(r){var c=P({},r);return c[n][t][a]=e,c})}),b=[{title:"属性名称",dataIndex:"key",key:"key",width:"200px"},{title:"数据类型",dataIndex:"type",key:"type",render:function(e,t,a){var n=t.type;return r.a.createElement("select",{value:n,onChange:function(e){return y(e.target.value,a,"type","requestList")}},r.a.createElement("option",{value:""},"请选择"),r.a.createElement("option",{value:"VARCHAR"},"VARCHAR"),r.a.createElement("option",{value:"INTEGER"},"INTEGER"),r.a.createElement("option",{value:"TIMESTAMP"},"TIMESTAMP"),r.a.createElement("option",{value:"DOUBLE"},"DOUBLE"),r.a.createElement("option",{value:"DATE"},"DATE"))}},{title:"是否必填",dataIndex:"ro",key:"ro",render:function(e,t,a){var n=t.ro;return r.a.createElement(I.a,{checked:n,onChange:function(e){return y(e.target.checked,a,"ro","requestList")}})}}],E=[{title:"属性名称",dataIndex:"key",key:"key",width:"200px"},{title:"数据类型",dataIndex:"type",key:"type",render:function(e,t,a){var n=t.type;return r.a.createElement("select",{value:n,onChange:function(e){return y(e.target.value,a,"type","responseList")}},r.a.createElement("option",{value:""},"请选择"),r.a.createElement("option",{value:"VARCHAR"},"VARCHAR"),r.a.createElement("option",{value:"INTEGER"},"INTEGER"),r.a.createElement("option",{value:"TIMESTAMP"},"TIMESTAMP"),r.a.createElement("option",{value:"DOUBLE"},"DOUBLE"),r.a.createElement("option",{value:"DATE"},"DATE"))}}];return r.a.createElement(h.a,{className:"sql-modal-self-class",visible:t,width:600,title:"生成API",closable:!0,centered:!0,okText:"提交",onOk:function(){n.validateFields(function(e,t){if(!e){var a=!1;if([].concat(A(i),A(o)).forEach(function(e){""===e.type&&(a=!0)}),a)return void Object(T.a)({message:"请为所有参数选择数据类型！"});m(P({},t))}})},onCancel:a,destroyOnClose:!0,maskClosable:!1},r.a.createElement("div",{className:"sql-config-wrapper"},r.a.createElement(w.a,{defaultActiveKey:["1","2","3","4"]},r.a.createElement(q,{header:"基本信息",key:"1"},r.a.createElement(j.a.Item,{label:"API名称"},v("apiName",{rules:[{required:!0,message:"请输入API名称！"}],initialValue:p})(r.a.createElement(u.a,{placeholder:"请输入API名称！"}))),r.a.createElement(j.a.Item,{label:"ApiSrn"},v("apiSrn",{initialValue:s,rules:[{required:!0,message:"请输入ApiSrn！"}]})(r.a.createElement(u.a,null)))),r.a.createElement(q,{header:"请求参数",key:"2"},r.a.createElement(O.a,{rowKey:"key",columns:b,dataSource:i,pagination:!1})),r.a.createElement(q,{header:"返回参数",key:"3"},r.a.createElement(O.a,{rowKey:"key",columns:E,dataSource:o,pagination:!1})),r.a.createElement(q,{header:"高级设置",key:"4"},r.a.createElement(j.a.Item,null,v("onPage",{valuePropName:"checked",initialValue:f})(r.a.createElement(I.a,null,"开启返回结果分页")))))))});function L(e){var t=e.visible,a=e.cancelHandle,i=e.params,l=e.sqlTest;console.log("---params--",i);var o=C(Object(n.useState)(new Array(i.length)),2),s=o[0],d=o[1];return r.a.createElement(h.a,{className:"modal-sql-paramsconfig",visible:t,title:"参数配置",closable:!0,centered:!0,footer:null,onCancel:a,destroyOnClose:!0,maskClosable:!1},r.a.createElement("div",{className:"test-config-wrapper"},i.map(function(e,t){return r.a.createElement("div",{key:t,className:"param"},r.a.createElement("span",{className:"key"},e," :"),r.a.createElement(u.a,{className:"input",placeholder:"输入参数值",onChange:function(e){!function(e,t){var a=e.target.value,n=k()(s);n[t]=a,d(n)}(e,t)}}))}),r.a.createElement(c.a,{className:"testbtn",type:"primary",onClick:function(){l(s)}},"开始调试")))}function B(e){var t=e.visible,a=e.cancelHandle,n=e.downHistoryLi,i=e.getDownTslHistory,l=e.downHistoryLoading,o=e.addTslHistory,u=[{title:"导出时间",dataIndex:"createTime",width:150,render:function(e){return r.a.createElement("span",null,N.a.pekingToStr(e))}},{title:"路径地址",dataIndex:"filePath"},{title:"状态",dataIndex:"status",width:90,render:function(e){return r.a.createElement("span",null,{0:"处理中",1:"成功",2:"失败"}[e]||"--")}}];return r.a.createElement(h.a,{className:"modal-downHistoryLi",visible:t,title:"导出列表",closable:!0,centered:!0,footer:null,onCancel:a,destroyOnClose:!0,maskClosable:!1,width:800},r.a.createElement("div",{className:"topbtnbox"},r.a.createElement(c.a,{className:"addbtn",type:"link",onClick:o},"新增导出"),r.a.createElement(g.a,{type:"sync",title:"刷新列表",spin:l,className:"refresh",onClick:i})),r.a.createElement(O.a,{rowKey:"createTime",columns:u,dataSource:n,scroll:{y:600},pagination:!1}))}function R(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function V(e){var t=e.fieldList,a=t.map(function(e,t){var a=k()(e);return a.id=t+1,a}),n=Object.keys(t[0]).map(function(e){return{title:e,dataIndex:e}});return r.a.createElement("div",{className:"table-filed-content"},r.a.createElement(O.a,{rowKey:"id",columns:[{title:"序号",dataIndex:"id"}].concat(R(n)),dataSource:a,scroll:{y:400},pagination:!1}))}var H=a("54Vy");a("boRK");function F(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function M(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?F(a,!0).forEach(function(t){K(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):F(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function K(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function J(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var z=s.a.TabPane,U=u.a.TextArea,G=function(e){return e.match(/(?<={).*?(?=})/g)||[]};function Z(e){var t=e.service,a=e.getServeStatu,l=J(Object(n.useState)(void 0),2),o=l[0],d=l[1],m=t.serviceId,f=t.projectId,v=t.name,y=J(Object(n.useState)(),2),g=y[0],h=y[1],O=J(Object(n.useState)([]),2),I=O[0],j=O[1],w=J(Object(n.useState)("select "),2),S=w[0],k=w[1],N=J(Object(n.useState)(!1),2),C=N[0],A=N[1],x=J(Object(n.useState)([]),2),P=x[0],D=x[1],q=J(Object(n.useState)("TSL"),2),R=q[0],F=q[1],K=J(Object(n.useState)({}),2),Z=K[0],_=K[1],Q=J(Object(n.useState)(!1),2),$=Q[0],X=Q[1],Y=J(Object(n.useState)(),2),W=Y[0],ee=Y[1],te=J(Object(n.useState)([]),2),ae=te[0],ne=te[1],re=J(Object(n.useState)(!1),2),ce=re[0],ie=re[1],le=J(Object(n.useState)(!1),2),oe=le[0],ue=le[1],se=function(e){var t=e[0];t&&k(S+" "+t)},de=function(){for(var e={},t=G(S),a=0;a<t.length;a++){var n=t[a],r="{{1@".concat(n,"}}");e[n]=r}return e},me=function(){ie(!0),Object(p.c)(p.a.downTslHistory,{flowId:W}).then(function(e){var t=e.data;ne(void 0===t?[]:t)}).finally(function(){ie(!1)})},pe=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e={};if(P.length>0)for(var t=G(S),a=0;a<t.length;a++){var n=t[a],r=paramsVal[a];e[n]=r}return e},fe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];D(e);var t=pe(e),a=p.a.sqlTestProductData,n={sql:S,paramsMap:encodeURI(JSON.stringify(t))};"TSL"==R&&(a=p.a.sqlTestTslData,n.projectId=f,n.productId=o),Object(p.c)(a,n).then(function(e){e.code;var t=e.data,a=void 0===t?[]:t;A(!1),a.length>100&&(a=a.slice(0,100)),j(a)})};return Object(n.useEffect)(function(){var e=i.b.asObservable().subscribe(function(e){var t=g||(new Date).getTime();Object(p.d)(p.a.saveFlowData,{projectId:f,serviceId:m,lines:"",action:t,nodes:[{nodeType:101,id:1,nodeName:"数据查询起始",location:"",input:JSON.stringify({action:t,authCheck:1,input:G(S).map(function(e,t){return{param_name:e,param_typ:0,param_required:0,param_default:P[t],param_desc:""}})}),output:""},{nodeType:3101,id:2,pid:1,nodeName:"数据查询",location:"",input:JSON.stringify({productId:o,projectId:f,logicSql:S,logicName:R,superInstanceId:localStorage.getItem("superInstanceId"),params:JSON.stringify(de())}),output:""},{nodeType:701,id:3,pid:2,nodeName:"数据查询结束",location:"",input:JSON.stringify({source:1,sourceType:0,value:2}),output:""}]},{needJson:!0,noInstance:!0}).then(function(e){Object(T.a)({type:"success",message:"保存成功"}),a()})}),t=i.a.asObservable().subscribe(function(e){ue(!0)}),n=i.c.asObservable().subscribe(function(e){G(S).length>0?A(!0):fe()});return function(){e.unsubscribe(),t.unsubscribe(),n.unsubscribe()}},[a,m,o,S,R,g]),Object(n.useEffect)(function(){m&&Object(p.c)(p.a.getFlowData,{serviceId:m},{noInstance:!0}).then(function(e){if(e.data){var t=e.data,a=t.flowNodeList,n=void 0===a?[]:a,r=t.flowId,c=t.action;if(ee(r),h(c),n&&n.length>1){var i=n[1].input;if(i){var l=JSON.parse(i),o=l.productId,u=l.logicSql,s=l.logicName;k(u),F(s),d(o)}}}})},[m]),Object(n.useEffect)(function(){Object(p.c)(p.a.getProLogicTreeData,{},{noInstance:!0}).then(function(e){_(e.data||{})})},[]),r.a.createElement("div",{className:"sql-analysis-wrapper"},r.a.createElement("div",{className:"left-wrapper"},r.a.createElement("div",{className:"table-tree-wrapper"},r.a.createElement(s.a,{activeKey:R,className:"tabpane",onChange:function(e){F(e)}},r.a.createElement(z,{tab:"物模型",key:"TSL"},r.a.createElement(b,{setSelectedData:se,setPropsProductId:d,productId:o})),r.a.createElement(z,{tab:"逻辑模型",key:"product"},r.a.createElement(E,{setSelectedData:se,proLogicData:Z}))))),r.a.createElement("div",{className:"sql-code-edit-wrapper"},r.a.createElement("div",{className:"topbtn"},r.a.createElement(c.a,{type:"primary",size:"small",onClick:function(){X(!0),me()},disabled:"product"==R}," 导出")),r.a.createElement("div",{className:"configitem"},r.a.createElement("span",{className:"itemname"},"SQL语句"),r.a.createElement(U,{rows:8,value:S,onChange:function(e){var t;t=e.target.value,k(t)}})),r.a.createElement("div",{className:"configitem"},r.a.createElement("span",{className:"itemname"},"发布路径"),r.a.createElement(u.a,{value:g,placeholder:"选填",onChange:function(e){!function(e){var t=e.target.value;h(t)}(e)}})),r.a.createElement("div",{className:"configitem"},r.a.createElement("span",{className:"itemname"},"调试结果"),I.length>0&&r.a.createElement(V,{fieldList:I}))),C&&r.a.createElement(L,{visible:!0,params:G(S),cancelHandle:function(){A(!1)},sqlTest:fe}),r.a.createElement(B,{visible:$,cancelHandle:function(){X(!1)},downHistoryLi:ae,getDownTslHistory:me,downHistoryLoading:ce,addTslHistory:function(){Object(p.c)(p.a.addTslHistory,{sql:S,projectId:f,productId:o,paramsMap:encodeURI(JSON.stringify(pe())),createTime:(new Date).getTime(),flowId:W}).then(function(e){me()})}}),r.a.createElement(H.d,{visible:oe,envdata:{id:m,actionType:1,name:v},onOk:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.d)(p.a.servePublish,M({serviceId:m,envType:1,operate:1},e),{timeout:3e5}).then(function(e){Object(T.a)({type:"success",message:"发布成功"}),a()})},onCancel:function(){return ue(!1)}}))}var _=a("lc5D"),Q=a.n(_);a("65m2"),a("EVKt"),a("umNf");function $(e){var t=e.sqlText,a=e.setSqlText;return r.a.createElement(Q.a,{mode:"sql",theme:"github",height:"100%",width:"100%",value:t,onChange:function(e){a(e)},showGutter:!0,showPrintMargin:!1,enableBasicAutocompletion:!0,name:"sql-edit",editorProps:{$blockScrolling:!0}})}a("JTJg"),a("K4yd");var X=a("9yH6"),Y=a("KZSM");a("gtRY");function W(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ee(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function te(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ee(a,!0).forEach(function(t){ae(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ee(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function ae(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ne(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var re=d.a.Option,ce=[{code:"eventTime",name:"事件时间",type:"varchar",intBit:"",doubleBit:""},{code:"windowEventTime",name:"窗口事件时间",type:"timestamp",intBit:"",doubleBit:""},{code:"deviceId",name:"设备id",type:"varchar",intBit:"",doubleBit:""},{code:"proceTime",name:"当前系统时间",type:"timestamp",intBit:"",doubleBit:""}],ie=j.a.create({name:"sql-link-input-config"})(function(e){var t=e.visible,a=e.cancelHandle,c=e.form,i=e.productList,l=void 0===i?[]:i,o=e.setInputData,s=e.inputData,m=ne(Object(n.useState)(s.deviceList||[]),2),p=m[0],f=m[1],v=ne(Object(n.useState)([]),2),y=v[0],b=v[1],E=ne(Object(n.useState)(0),2),g=E[0],I=E[1],w=ne(Object(n.useState)(s.propsOrEventList||[]),2),S=w[0],k=w[1],N=ne(Object(n.useState)(s.fields||[].concat(ce)),2),C=N[0],A=N[1],x=c.getFieldDecorator,P=c.setFieldsValue,D=c.getFieldValue,q=s.code,L=void 0===q?"":q,B=s.productId,R=void 0===B?"":B,V=s.deviceIds,H=void 0===V?[]:V,F=s.propEvent,M=void 0===F?"0":F,K=s.fieldsCodes,J=void 0===K?[]:K,z=s.eventOffset,U=void 0===z?"":z,G=function(e,t,a){return Object(Y.d)({property:t,productId:e,eventIdentifier:a}).then(function(e){return e&&e.data||[]})},Z=function(e){var t=D("productId");I(e),t?0==e?G(t,e).then(function(e){k(e),P({fieldsCodes:[]})}):function(e){return Object(Y.f)({productId:e}).then(function(e){return e&&e.data||[]})}(t).then(function(e){b(e),P({fieldsCodes:[]})}):Object(T.a)({description:"请先选择一个产品"})},_=function(e,t,a){A(function(n){var r=W(n);return r[a][e]=t,r})},Q=[{title:"字段名称",dataIndex:"name",key:"name",width:"100px"},{title:"字段编码",dataIndex:"code",key:"code",width:"100px"},{title:"字段类型",dataIndex:"type",key:"type",width:"100px"},{title:"整数位",dataIndex:"intBit",key:"intBit",width:"100px",render:function(e,t,a){var n=t.intBit;return r.a.createElement("input",{style:{width:"100px"},type:"number",value:n,onChange:function(e){return _("intBit",e.target.value,a)}})}},{title:"小数位",dataIndex:"doubleBit",key:"doubleBit",width:"100px",render:function(e,t,a){var n=t.doubleBit;return r.a.createElement("input",{style:{width:"100px"},type:"number",value:n,onChange:function(e){return _("doubleBit",e.target.value,a)}})}}];return r.a.createElement(h.a,{className:"sql-modal-self-class",visible:t,width:600,title:"输入表",closable:!0,centered:!0,okText:"保存",onOk:function(){c.validateFields(function(e,t){e||(o([te({},t,{fields:C,deviceList:p,propsOrEventList:S})]),a())})},onCancel:a,destroyOnClose:!0,maskClosable:!1},r.a.createElement("div",{className:"sql-link-input-config-wrapper"},r.a.createElement(j.a,null,r.a.createElement(j.a.Item,{label:"表名称（只允许字母,数字,下划线，必须以字母开头）"},x("code",{rules:[{required:!0,message:"请输入表名称！"},{pattern:/^[a-zA-Z]+[a-zA-Z0-9_]{0,50}$/,message:"格式错误"}],initialValue:L})(r.a.createElement(u.a,{placeholder:"请输入表名称！"}))),r.a.createElement(j.a.Item,{label:"选择产品"},x("productId",{rules:[{required:!0,message:"请选择产品！"}],initialValue:R})(r.a.createElement(d.a,{onChange:function(e){Object(Y.a)({productId:e,pageRows:9999}).then(function(e){P({deviceIds:[]}),f(e.data&&e.data.list||[])}),0==D("propEvent")&&G(e,"0").then(function(e){k(e),P({fieldsCodes:[]})})}},l.map(function(e){var t=e.productId,a=e.productName;return r.a.createElement(re,{key:t,value:t},a)})))),r.a.createElement(j.a.Item,{label:"选择设备"},x("deviceIds",{rules:[{required:!0,message:"请选择设备！"}],initialValue:H})(r.a.createElement(d.a,{mode:"multiple"},p.map(function(e){var t=e.deviceId;return r.a.createElement(re,{key:t,value:t},t)})))),r.a.createElement(j.a.Item,{label:"输入参数"},x("propEvent",{rules:[{required:!0,message:"请选择输入参数！"}],initialValue:M})(r.a.createElement(X.a.Group,{onChange:function(e){return Z(e.target.value)}},r.a.createElement(X.a,{value:"0"},"属性"),r.a.createElement(X.a,{value:"1"},"事件")))),"1"==g&&r.a.createElement(j.a.Item,null,x("eventIdentifier",{rules:[{required:!0,message:"请选择事件！"}]})(r.a.createElement(d.a,{onChange:function(e){var t=D("productId");G(t,1,e).then(function(e){k(e),P({fieldsCodes:[]})})},placeholder:"请选择事件！"},y.map(function(e){var t=e.identifier,a=e.name;return r.a.createElement(re,{key:t,value:t},a)})))),r.a.createElement(j.a.Item,null,x("fieldsCodes",{rules:[{required:!0,message:"请选择".concat("0"===g?"属性":"事件","字段！")}],initialValue:J})(r.a.createElement(d.a,{mode:"multiple",onChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=C.filter(function(t){return e.includes(t.code)}),a=t.map(function(e){return e.code}),n=[];e.forEach(function(e){a.includes(e)||n.push(e)}),S.forEach(function(e){var a=e.srcCode,r=e.srcName,c=e.srcType;n.includes(a)&&t.push({code:a,name:r,type:c,intBit:"",doubleBit:""})}),A([].concat(ce,W(t)))}},S.map(function(e){var t=e.srcName,a=e.srcCode;return r.a.createElement(re,{key:a,value:a},"".concat(t,"( ").concat(a," )"))})))),r.a.createElement(j.a.Item,{label:"窗口起始时间偏移（毫秒）"},x("eventOffset",{rules:[{required:!0,message:"请输入窗口起始时间偏移！"}],initialValue:U})(r.a.createElement(u.a,{placeholder:"请输入窗口起始时间偏移！",type:"number"}))),r.a.createElement(j.a.Item,null,r.a.createElement(O.a,{rowKey:"code",columns:Q,dataSource:C,pagination:!1})))))}),le=j.a.create({name:"sql-link-output-config"})(function(e){var t=e.visible,a=e.cancelHandle,i=e.form,l=e.changeOutput,o=e.inputData,s=ne(Object(n.useState)(o.dataSourceList||[]),2),m=s[0],p=s[1],f=ne(Object(n.useState)(o.tableList||[]),2),v=f[0],y=f[1],b=ne(Object(n.useState)(o.fieldsList||[]),2),E=b[0],g=b[1],I=ne(Object(n.useState)(o.selectedRowKeys||[]),2),w=I[0],S=I[1],k=i.getFieldDecorator,N=i.setFieldsValue,C=i.getFieldValue,A=o.code,x=o.dsType,P=o.dsId,D=o.tableCode,q=function(e,t,a){g(function(n){var r=W(n);return r[a][e]=t,r})},L=[{title:"字段编码",dataIndex:"code",key:"index",width:"100px",render:function(e,t,a){var n=t.code;return"5"==C("dsType")?r.a.createElement("input",{style:{width:"100px"},type:"text",value:n,onChange:function(e){return q("code",e.target.value,a)}}):r.a.createElement("span",null,n)}},{title:"字段类型",dataIndex:"type",key:"type",width:"100px",render:function(e,t,a){var n=t.type;return r.a.createElement("select",{value:n,onChange:function(e){return q("type",e.target.value,a)}},r.a.createElement("option",{value:"varchar"},"varchar"),r.a.createElement("option",{value:"double"},"double"),r.a.createElement("option",{value:"integer"},"integer"),r.a.createElement("option",{value:"time"},"time"),r.a.createElement("option",{value:"date"},"date"),r.a.createElement("option",{value:"timestamp(3)"},"timestamp(3)"),r.a.createElement("option",{value:"varbinary"},"varbinary"),r.a.createElement("option",{value:"decimal"},"decimal"),r.a.createElement("option",{value:"float"},"float"),r.a.createElement("option",{value:"bigint"},"bigint"),r.a.createElement("option",{value:"boolean"},"boolean"),r.a.createElement("option",{value:"tinyint"},"tinyint"),r.a.createElement("option",{value:"smallint"},"smallint"))}},{title:"整数位",dataIndex:"intBit",key:"intBit",width:"100px",render:function(e,t,a){var n=t.intBit;return r.a.createElement("input",{style:{width:"100px"},type:"number",value:n,onChange:function(e){return q("intBit",e.target.value,a)}})}},{title:"小数位",dataIndex:"doubleBit",key:"doubleBit",width:"100px",render:function(e,t,a){var n=t.doubleBit;return r.a.createElement("input",{style:{width:"100px"},type:"number",value:n,onChange:function(e){return q("doubleBit",e.target.value,a)}})}},{title:"操作",dataIndex:"code",key:"code",width:"100px",render:function(e,t,a){return r.a.createElement("a",{style:{marginLeft:"8px"},onClick:function(e){return function(e){g(function(t){return[].concat(W(t.slice(0,e)),W(t.slice(e+1)))})}(a)}},"删除")}}],B={onChange:function(e,t){S(e)},selectedRowKeys:w};return r.a.createElement(h.a,{className:"sql-modal-self-class",visible:t,width:600,title:"输出表",closable:!0,centered:!0,okText:"保存",onOk:function(){i.validateFields(function(e,t){if(!e){var n=[],r=!1;"5"!=C("dsType")?n=E.filter(function(e){return w.includes(e.code)}):(n=W(E)).forEach(function(e){e.code||(r=!0)}),r&&Object(T.a)({description:"有参数未填完！"}),l(te({},t,{fields:n,fieldsList:E,tableList:v,dataSourceList:m,selectedRowKeys:w})),a()}})},onCancel:a,destroyOnClose:!0,maskClosable:!1},r.a.createElement("div",{className:"sql-link-input-config-wrapper"},r.a.createElement(j.a,null,r.a.createElement(j.a.Item,{label:"表名称（只允许字母,数字,下划线，必须以字母开头）"},k("code",{rules:[{required:!0,message:"请输入表名称！"},{pattern:/^[a-zA-Z]+[a-zA-Z0-9_]{0,50}$/,message:"格式错误"}],initialValue:A})(r.a.createElement(u.a,{placeholder:"请输入表名称！"}))),r.a.createElement(j.a.Item,{label:"数据源类型"},k("dsType",{rules:[{required:!0,message:"请选择数据源类型！"}],initialValue:x})(r.a.createElement(d.a,{onChange:function(e){Object(Y.b)({type:e}).then(function(e){e&&e.data&&(p(W(e.data)),N({dsId:"",tableCode:""}),y([]),g([]),S([]))})}},[{key:2,name:"mysql"},{key:5,name:"rocketMq"}].map(function(e){var t=e.name,a=e.key;return r.a.createElement(re,{key:a,value:a},t)})))),r.a.createElement(j.a.Item,{label:"数据库"},k("dsId",{rules:[{required:!0,message:"请选择数据库！"}],initialValue:P})(r.a.createElement(d.a,{onChange:function(e){"5"!=C("dsType")&&Object(Y.e)({datasourceId:e}).then(function(e){e&&e.data&&(y(e.data),N({tableCode:""}),g([]),S([]))})}},m.map(function(e){var t=e.name,a=e.id;return r.a.createElement(re,{key:a,value:a},t)})))),"5"!=C("dsType")?r.a.createElement(j.a.Item,{label:"数据表"},k("tableCode",{rules:[{required:!0,message:"请选择数据表！"}],initialValue:D})(r.a.createElement(d.a,{onChange:function(e){Object(Y.c)({datasourceId:C("dsId"),tableCode:e}).then(function(e){e&&e.data&&(g(e.data.map(function(e){return{code:e.srcCode,type:"varchar",name:e.srcName,intBit:"",doubleBit:""}})),S([]))})}},v.map(function(e){var t=e.code;return r.a.createElement(re,{key:t,value:t},t)})))):r.a.createElement(j.a.Item,null,r.a.createElement(c.a,{type:"primary",size:"small",onClick:function(){g(function(e){return[].concat(W(e),[{code:"",type:"varchar",name:"",intBit:"",doubleBit:"",index:1e4*Math.random()}])})}},"新增一行")),r.a.createElement(j.a.Item,{label:"输出"},r.a.createElement(O.a,{rowKey:"5"!=C("dsType")?"code":"index",rowSelection:"5"!=C("dsType")?B:void 0,columns:"5"!=C("dsType")?L.slice(0,-1):L,dataSource:E,scroll:{y:240},pagination:!1})))))});a("m/U6");function oe(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var se=w.a.Panel;function de(e){var t=e.service,a=ue(Object(n.useState)(""),2),c=a[0],l=a[1],o=ue(Object(n.useState)([]),2),u=o[0],s=o[1],d=ue(Object(n.useState)([]),2),m=d[0],p=d[1],f=ue(Object(n.useState)([]),2),v=f[0],y=f[1],b=ue(Object(n.useState)(!1),2),E=b[0],g=b[1],h=ue(Object(n.useState)(!1),2),O=h[0],I=h[1],j=ue(Object(n.useState)(-1),2),S=j[0],k=j[1];Object(n.useEffect)(function(){var e=t.projectId,a=t.serviceId;e&&Object(Y.h)({projectId:e,pageRows:9999}).then(function(e){e&&e.data&&e.data.list&&p(oe(e.data.list))}),a&&Object(Y.g)({serviceId:a}).then(function(e){if(e.data){var t=e.data.flowNodeList,a=void 0===t?[]:t;if(a&&a.length>0){var n=(a[0]||{}).input;if(n){var r=JSON.parse(n)||{},c=r.inputTable,i=r.outputTable,o=r.sql;s(c||[]),y(i||[]),l(o||"")}}}})},[t]),Object(n.useEffect)(function(){var e=i.b.asObservable().subscribe(function(e){var a=t.projectId,n=t.serviceId;Object(Y.i)({projectId:a,serviceId:n,lines:"",nodes:[{id:1,pid:null,nodeName:"flinkSql",nodeType:2501,location:"",input:JSON.stringify({nodeType:2501,inputTable:u,outputTable:v,sql:c}),output:""}]}).then(function(){Object(T.a)({type:"success",message:"保存成功"})})});return function(){e.unsubscribe()}},[t,c,u,v]);var N=Object(n.useMemo)(function(){return-1===S?{code:"",dsType:"",dsId:"",tableCode:"",fieldsList:[],tableList:[],dataSourceList:[],fields:[],selectedRowKeys:[]}:v[S]},[S,v]),C=function(e,t){"input"===e?g(!0):(k(t),I(!0))},A=function(e,t){"input"===e?s([]):y(function(e){return[].concat(oe(e.slice(0,t)),oe(e.slice(t+1)))})};return r.a.createElement("section",{className:"sql-link-wrapper"},r.a.createElement("div",{className:"left-wrapper"},r.a.createElement("div",{className:"input-wrapper"},r.a.createElement("div",{className:"input-title"},"输入表管理",r.a.createElement("span",{className:u.length>0?"disabled":"",onClick:u.length>0?null:function(){return g(!0)}},"添加输入")),r.a.createElement("div",{className:"table-content"},r.a.createElement(w.a,{defaultActiveKey:[]},u.map(function(e,t){var a=e.code,n=e.fields;return a?r.a.createElement(se,{header:r.a.createElement("div",null,r.a.createElement("span",null,a),r.a.createElement("div",{style:{float:"right",marginRight:"12px"},onClick:function(e){return e.stopPropagation()}},r.a.createElement("span",{onClick:function(){return C("input")}},"编辑")," | ",r.a.createElement("span",{onClick:function(){return A("input")}},"删除"))),key:a+t},r.a.createElement("div",null,n.map(function(e,a){var n=e.code,c=e.type;return r.a.createElement("div",{className:"field-p",key:t+n},r.a.createElement("span",null,n),r.a.createElement("span",null,c))}))):null})))),r.a.createElement("div",{className:"output-wrapper"},r.a.createElement("div",{className:"input-title"},"输出表与维表管理",r.a.createElement("span",{onClick:function(){return I(!0)}},"添加输出或维表")),r.a.createElement("div",{className:"table-content"},r.a.createElement(w.a,{defaultActiveKey:["1"]},v.map(function(e,t){var a=e.code,n=e.fields;return a?r.a.createElement(se,{header:r.a.createElement("div",null,r.a.createElement("span",null,a),r.a.createElement("div",{style:{float:"right",marginRight:"12px"},onClick:function(e){return e.stopPropagation()}},r.a.createElement("span",{onClick:function(){return C("output",t)}},"编辑")," | ",r.a.createElement("span",{onClick:function(){return A("output",t)}},"删除"))),key:a+t},r.a.createElement("div",null,n.map(function(e,a){var n=e.code,c=e.type;return r.a.createElement("div",{className:"field-p",key:t+n},r.a.createElement("span",null,n),r.a.createElement("span",null,c))}))):null}))))),r.a.createElement("div",{className:"right-wrapper"},r.a.createElement($,{sqlText:c,setSqlText:l})),E&&r.a.createElement(ie,{inputData:u[0]||{},visible:E,productList:m,setInputData:s,cancelHandle:function(){return g(!1)}}),O&&r.a.createElement(le,{inputData:N,visible:O,changeOutput:function(e){var t=oe(v);S>-1?t[S]=e:t.push(e),y(t)},cancelHandle:function(){I(!1),k(-1)}}))}var me=a("Ty5D");a("6MFL");function pe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var i,l=e[Symbol.iterator]();!(n=(i=l.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function fe(){var e=Object(me.h)(),t=e.projectId,a=e.serviceId,c=decodeURI(Object(N.j)("name")),i=decodeURI(Object(N.j)("desc")),u=+decodeURI(Object(N.j)("analysisiType")||1),s=pe(Object(n.useState)(0),2),d=s[0],m=s[1],f=Object(n.useCallback)(function(){Object(p.c)(p.a.getServeStatu,{serveId:a}).then(function(e){e&&e.data&&m(e.data.testEnv)})},[a]);return r.a.createElement("section",{className:"data-analysis-wrapper flex-column"},r.a.createElement(l,{dataAnalysisName:c,analysisiType:u,testEnv:+d}),r.a.createElement("section",{className:"flex1"},3===u?r.a.createElement(Z,{service:{name:c,desc:i,serviceId:a,projectId:t},getServeStatu:f}):4===u?r.a.createElement(de,{service:{name:c,desc:i,serviceId:a,projectId:t}}):r.a.createElement(o.a,{service:{name:c,desc:i,serviceId:a,projectId:t}})))}a.d(t,"default",function(){return fe})},boRK:function(e,t,a){},kyDF:function(e,t,a){},"m/U6":function(e,t,a){},wJTb:function(e,t,a){}}]);