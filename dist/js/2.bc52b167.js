(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{"1Ngb":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAQCAYAAABk1z2tAAACPUlEQVRIS82VT2jTYBiH3/dLUoWtFWQoCLvpabCLPXgYQpqWgraLgnzQPw48efK+3Qq7yDztuOO2roiHtUE2GdnIQUZl21kUFGVYNlemuFnN0jafdCyrDU2TeLG55vckD1/y/l6EPr9Q0zS+Wq0SSqnhx/WFpg3WazUhk0h898MVXmpDPJgXaFKqeOGwoLwaJSTANwxyEGhW9yilTS/gYmn9KSALcQgbJ0F+5ZEo6l64pZK6CwBXGeJsEC5Oy/LYcS8Ol4prN62AyVhjIMR/uS9J3xCR9QIXFXXu/D7CEYe4nEpIb9y4fEltPxdxnwBMpsalBSeuQ9B6IcfIL2PA3J2Ix2tOkh2CZyEE/Gxi8/nEePyTE9ch2Oa2gMMnmaS0Zee6ClohAoHDG8PBSjgcrtvBboLnHLKyoGOR0tgPO9dNsJU5PUEG84LATdG74r7F9RRshQghJscbe2+3tw9yuZxpgb0ET1/I4MQEWBm+xG+IotiwOCfB9u+CxwTYNH/92iwdGTFcBS1QIMJPKkfeexX86+Q+PJRjzzwLtk1fZ+9Fb3sWxCbU0g/i7/wKIuDHrByd8SuICJsZOTbmKtjXn/jfh4SUBd30PSQMYCHAc5OuQ9K3NdMqak6oV1KJxKFb4dqLGkxSzMqRshtnL2pEnEonI/OORV1Q1kcJQd+rLq+oMwxg0PeqU9QKMBjyvOrmdnaE1oQ97lLGvVZdfnU1BHAZsnduHXnZwVZmeW3ziq7/xrQc/eqFQy+h/5n5A/v0OCDUiLvVAAAAAElFTkSuQmCC"},"40NI":function(e,t,a){},"8sIe":function(e,t,a){"use strict";a("pNMO"),a("4Brf"),a("0oug"),a("TeQF"),a("yXV3"),a("4mDm"),a("2B1R"),a("pDQq"),a("5DmW"),a("27RR"),a("tkto"),a("07d7"),a("5s+n"),a("p532"),a("PKPk"),a("EnZy"),a("FZtP"),a("3bBZ"),a("mbEz");var n=a("wCAj"),r=(a("TfFZ"),a("3S7+")),l=(a("L/Qf"),a("2/Rp")),c=(a("2oDE"),a("CtXQ")),i=(a("qNb/"),a("PArb")),o=a("BkRI"),s=a.n(o),u=a("q1tI"),d=a.n(u),m=a("Nlzp"),p=a("DgvE"),f=a("cu44"),v=a("TL2v"),g=a("2kug"),E=(a("ma9I"),a("pjDv"),a("yq1k"),a("sMBO"),a("qePV"),a("i6QF"),a("JfAA"),a("JTJg"),a("SYor"),a("k3Gp"),a("kLXV")),y=(a("QCje"),a("fyUT")),b=(a("8QGh"),a("2fM7")),h=(a("1vPl"),a("5rEg")),I=a("P2RN");function k(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function O(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?k(a,!0).forEach(function(t){w(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):k(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function w(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function x(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,l=void 0;try{for(var c,i=e[Symbol.iterator]();!(n=(c=i.next()).done)&&(a.push(c.value),!t||a.length!==t);n=!0);}catch(e){r=!0,l=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw l}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var C=h.a.TextArea,S=h.a.Search,j=b.a.Option,N=[{title:"填写任务说明"},{title:"添加配置数据"},{title:"选择配置更新的设备"}],D=["待执行","执行中","成功","失败"];function R(e){var t=e.visible,a=e.productId,r=e.onCancel,i=e.configProtoclList,o=e.isDeviceRomote,f=e.getRemoteList,v=e._deviceList,k=e.editData,w=e.protocolFormat,D=L(Object(u.useState)(0),2),R=D[0],T=D[1],A=L(Object(u.useState)(k?{taskExplain:k.taskExplain}:{taskExplain:""}),2),P=A[0],V=A[1],Q=L(Object(u.useState)(k?k.protocolSendData||[]:i.map(function(e){return e.defaultPropertyValue||""})),2),U=Q[0],J=Q[1],F=L(Object(u.useState)(k&&k.protocolSelection||[]),2),B=F[0],M=F[1],z=L(Object(u.useState)([]),2),_=z[0],G=z[1],K=L(Object(u.useState)(1),2),Z=K[0],W=K[1],X=L(Object(u.useState)([]),2),H=X[0],Y=X[1],$=L(Object(u.useState)({curDeviceInfoList:[],allDeviceInfoList:[],allDeviceInfoPager:{pageIndex:1,currPageRows:7}}),2),ee=$[0],te=$[1],ae=L(Object(u.useState)([]),2),ne=ae[0],re=ae[1],le=L(Object(u.useState)(!1),2),ce=le[0],ie=le[1],oe=L(Object(u.useState)({allList:[],successList:[],errorList:[],errorVisible:!1}),2),se=oe[0],ue=oe[1],de=L(Object(u.useState)(""),2),me=de[0],pe=de[1],fe=L(Object(u.useState)(!1),2),ve=fe[0],ge=fe[1],Ee=L(Object(u.useState)({rightAllList:k?k.deviceList:[],rightTempList:k?k.deviceList:[]}),2),ye=Ee[0],be=Ee[1],he=L(Object(u.useState)([]),2),Ie=he[0],ke=he[1],Oe=Object(u.useRef)(null),we=P.taskExplain,xe=ee.curDeviceInfoList,Le=ee.allDeviceInfoList,Ce=ee.allDeviceInfoPager,Se=se.allList,je=se.successList,Ne=se.errorList,De=se.errorVisible,Re=ye.rightAllList,Te=ye.rightTempList,Ae=o?1:2,Pe=s()(N);o&&Pe.splice(2,1);var Ve=function(e){Object(m.c)(m.a.getAllDeviceInfo,{productId:a,pageRows:8,pageIndex:e||Ce.pageIndex}).then(function(e){if(e.data){var t=e.data,a=t.list,n=void 0===a?[]:a,r=t.pager,l=void 0===r?{}:r,c=[].concat(x(Le),x(n));n.forEach(function(e){e.key=e.deviceUniqueId}),te({curDeviceInfoList:n,allDeviceInfoPager:l,allDeviceInfoList:c})}})};Object(u.useEffect)(function(){o||Ve()},[a,o]);var qe=function(e){var t=m.a.saveRomoteConfig,n={taskExplain:we,productId:a,protocolJson:JSON.stringify(1!==w?B.map(function(e){var t=i[e];return delete t._type,delete t._params,delete t._index,delete t.key,O({},t,{sendData:U[e]})}):U.map(function(e,t){var a=i[t];return delete a._type,delete a._params,delete a._index,delete a.key,O({},a,{sendData:e})}))};if(o)t=m.a.saveRomoteConfigForDevice,n.deviceList=v;else{if(Re.length<1)return void Object(I.a)({description:"请至少选择一个设备"});n.deviceList=Re.map(function(e){return{deviceId:e.deviceId,deviceUniqueId:e.deviceUniqueId,macAddress:e.macAddress}}),k&&(n.taskId=k.taskId)}Object(m.d)(t,n,{needJson:!0,loading:!0,noInstance:!0}).then(function(t){if(e){var n=t.data;Object(m.c)(m.a.submitRomoteConfig,{taskId:n,productId:a},{loading:!0}).then(function(e){f(1),r()})}else f(1),r()})},Qe=function(e){V(O({},P,{taskExplain:e.target.value.trim()}))},Ue=function(e,t){var a=x(U),n=_.filter(function(e){return e!==t});a[t]=e,J(a),G(n)},Je=function(e){W(+e),Y([]),re([])},Fe=function(e){e?(ie(!0),Object(m.c)(m.a.getDeviceInfoByIdOrMacAddress,{productId:a,query:e}).then(function(e){var t=e.data;t.key=t.deviceUniqueId,e.data&&re([t])}).finally(function(){ie(!1)})):Object(I.a)({description:"请输入查询条件"})},Be=function(e){var t=x(Re);if(e&&e.trim()){var a=e.trim();t=Re.filter(function(e){var t=e.deviceUniqueId,n=e.macAddress;return t.indexOf(a)>-1||n.indexOf(a)>-1})}be(O({},ye,{rightTempList:t}))},Me=function(){window.open(m.a.downloadRemoteDeviceTemplateExcel)},ze=function(e){console.log(1);var t=e.target;if(t.files&&t.files.length>0){var n=Object(p.e)(t.files,["xls","xlsx"],1e4),r=n.isOk;n.type,n.size;if(!r)return void Object(I.a)({description:"文件类型或者大小不符合要求"});var l=t.files[0];Object(m.d)(m.a.importRemoteDeviceExcel,{uploadExcel:l,productId:a},{needFormData:!0,loading:!0}).then(function(e){if(e.data){var t=e.data,a=[],n=[];t.forEach(function(e,t){var r=e.errorType,l=e.deviceUniqueId;e.key=l,r?n.push({deviceUniqueId:l,errorType:r,key:l}):a.push(O({},e))}),ue(O({},se,{allList:t,successList:a,errorList:n})),a.length>0&&(be({rightAllList:[].concat(a),rightTempList:[].concat(a)}),ke([])),pe(l.name),ge(!0)}})}},_e=function(){var e=(1==Z?Le:ne).filter(function(e){return H.includes(e.deviceUniqueId)}),t=Object(p.s)([].concat(x(Re),x(e)),"deviceUniqueId");Oe&&(Oe.current.input.input.value=""),be({rightAllList:t,rightTempList:t})},Ge=function(){if(0!==Ie.length){var e=Re.filter(function(e){var t=e.key;return!Ie.includes(t)}),t=Te.filter(function(e){var t=e.key;return!Ie.includes(t)});be(O({},ye,{rightAllList:e,rightTempList:t})),ke([])}},Ke=[{title:"数据名称",dataIndex:"propertyName",key:"propertyName",width:160},{title:"数据标识",dataIndex:"property",width:240,key:"property"},{title:"数据类型",dataIndex:"_type",key:"_type",width:140},{title:"数据属性",dataIndex:"propertyValueDesc",key:"propertyValueDesc"},{title:"下发数据",dataIndex:"execTime",key:"execTime",width:180,render:function(e,t){var a=t._type,n=t._params,r=t._index,l=t.key,c=null,i=1!==w&&!B.includes(l);switch(a){case"数值型":c=d.a.createElement(y.a,{value:U[r],min:n.min,max:n.max,disabled:i,onChange:function(e){return Ue(e,r)},placeholder:"请输入参数"});break;case"字符型":c=d.a.createElement(h.a,{value:U[r],maxLength:30,disabled:i,onChange:function(e){return Ue(e.target.value.trim(),r)},placeholder:"请输入参数"});break;default:c=d.a.createElement(b.a,{disabled:i,onChange:function(e){return Ue(e,r)},value:U[r]||""},d.a.createElement(j,{key:-1,value:""},"请选择参数"),n&&n.map(function(e,t){return d.a.createElement(j,{key:t+a,value:e.value},e.name)}))}return d.a.createElement("span",{className:"config-send-data ".concat(_.includes(r)?"warn":"")},c)}}],Ze=[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId",width:140},{title:"物理地址",dataIndex:"macAddress",width:140,key:"macAddress"}],We={selectedRowKeys:B,onChange:function(e){M(e)}},Xe={selectedRowKeys:H,onChange:function(e){Y(e)}},He={selectedRowKeys:Ie,onChange:function(e){ke(e)}},Ye=1===Z?xe:2===Z?ne:[];return d.a.createElement(E.a,{visible:t,width:1e3,className:"romote-modal",title:"远程配置任务",centered:!0,closable:!1,onOk:null,destroyOnClose:!0,maskClosable:!1,footer:null},d.a.createElement("div",{className:"romote-add-content flex-column"},d.a.createElement(g.a,{type:2,flowLists:Pe,style:{padding:"12px 0"},activeItem:R}),d.a.createElement("div",{className:"content-wrapper flex1"},function(){switch(R){case 0:return d.a.createElement("div",{className:"step-0-wrapper flex-row"},d.a.createElement("div",{className:"step-0-lable"},d.a.createElement("span",{className:"pre-requst-start"},"任务说明")),d.a.createElement("div",{className:"textarea-wrapper flex1"},d.a.createElement(C,{value:we,maxLength:100,onChange:Qe,autoSize:{minRows:4,maxRows:6}})),d.a.createElement("div",{className:"count-wrapper"},d.a.createElement("span",null,"".concat(we.length,"/100"))));case 1:return d.a.createElement("div",{className:"step-1-wrapper"},d.a.createElement("p",null,1!==w?"请选中需要下发的配置数据，并配置下发数据的值":"该产品使用了CLink标准数据格式（十六进制），需全量下发配置更新数据"),d.a.createElement("div",{className:"table-wrapper"},d.a.createElement(n.a,{columns:Ke,rowSelection:1!==w?We:null,dataSource:i,scroll:{y:300},pagination:!1})));case 2:return d.a.createElement("div",{className:"step-2-wrapper"},d.a.createElement("div",{className:"device-select-wrapper flex-row"},d.a.createElement("div",{className:"left flex1"},d.a.createElement("p",null,"选择配置更新的设备"),d.a.createElement(b.a,{value:Z,onChange:Je},d.a.createElement(j,{value:1,key:1},"全部设备"),d.a.createElement(j,{value:2,key:2},"通过设备ID/物理地址查找"),d.a.createElement(j,{value:3,key:3},"导入设备列表（本地文件）")),2===Z&&d.a.createElement(S,{enterButton:"查 找",loading:ce,onSearch:Fe,maxLength:50,placeholder:"请输入设备ID/物理地址查找"}),3===Z?d.a.createElement("section",{className:"file-upload-area"},d.a.createElement("p",null,"选择本地的设备数据文件上传 ",d.a.createElement("a",{onClick:Me},"设备数据模板")),d.a.createElement("p",null,"每次添加最多支持20,000个设备"),ve?d.a.createElement("div",null,d.a.createElement("div",{className:"result-area"},d.a.createElement("h3",null,me||"--"),d.a.createElement("p",null,"共".concat(Se.length,"条数据")),d.a.createElement("p",null,"".concat(je.length,"台设备成功匹配")),d.a.createElement("p",null,"".concat(Ne.length,"条数据匹配失败"))),d.a.createElement("div",{className:"tools"},d.a.createElement("a",{onClick:function(){return ge(!1)}},"重新上传"),d.a.createElement("a",{onClick:function(){return ue(O({},se,{errorVisible:!0}))}},"错误日志"))):d.a.createElement("div",null,d.a.createElement("div",{className:"file-input-wrapper"},d.a.createElement(l.a,{type:"primary"},d.a.createElement(c.a,{type:"upload"})," 选择本地设备数据文件"),d.a.createElement("input",{type:"file",onInput:ze,accept:".xls,.xlsx"})),d.a.createElement("p",null,"支持xls，xlsx格式，文件大小不超过10MB"))):2===Z?d.a.createElement(n.a,{columns:Ze,dataSource:Ye,rowSelection:Xe,pagination:!1}):d.a.createElement(n.a,{columns:Ze,dataSource:Ye,rowSelection:Xe,pagination:{total:Ce.totalRows,defaultCurrent:1,defaultPageSize:Ce.currPageRows,showQuickJumper:!1,hideOnSinglePage:!0,size:"small",onChange:function(e){return Ve(e)},showTotal:function(e){return d.a.createElement("span",null,"共 ",d.a.createElement("a",null,e)," 条")}}})),d.a.createElement("div",{className:"center"},d.a.createElement(l.a,{type:"primary",disabled:0===H.length,onClick:_e},"选择设备")),d.a.createElement("div",{className:"right flex1"},d.a.createElement("p",null,"已选中配置更新的设备"),d.a.createElement(S,{enterButton:"查 找",ref:Oe,onSearch:Be,maxLength:50,placeholder:"请输入设备ID/物理地址查找"}),d.a.createElement("div",{className:"tools-wrapper"},d.a.createElement("a",{className:Ie.length>0?"":"disable",onClick:Ge},"取消选中")),d.a.createElement(n.a,{columns:Ze,rowSelection:He,dataSource:Te,pagination:{total:Te.length,defaultCurrent:1,defaultPageSize:7,showQuickJumper:!1,hideOnSinglePage:!0,size:"small",showTotal:function(e){return d.a.createElement("span",null,"共 ",d.a.createElement("a",null,e)," 条")}}}))))}}()),d.a.createElement("div",{className:"r-footer"},d.a.createElement("span",null,R>0&&d.a.createElement(l.a,{onClick:function(){return T(R-1)},type:"primary"},"上一步"),d.a.createElement(l.a,{onClick:function(){if(0===R){if(!we)return void Object(I.a)({description:"请输入远程配置的备注信息"})}else if(1===R){var e=[];if(1!==w){if(B.length<1)return void Object(I.a)({description:"请至少选择一条配置协议"});B.forEach(function(t){[""," ",null,void 0].includes(U[t])&&e.push(t)})}else U.forEach(function(t,a){[""," ",null,void 0].includes(t)&&e.push(a)});if(e.length>0)return Object(I.a)({description:"请为配置协议添加参数"}),void G(e)}else if(2===R&&Re.length<1)return void Object(I.a)({description:"请至少选择一个设备"});R===Ae?qe(!o):T(R+1)},type:"primary"},R===Ae?"提交执行":"下一步"),d.a.createElement(l.a,{onClick:function(){2===R?qe():r()},type:2===R?"primary":"default"},2===R?"保存":"取消"))),De&&d.a.createElement(q,{visible:De,errorList:Ne,onCancel:function(){return ue(O({},se,{errorVisible:!1}))}})))}function T(e){var t=e.visible,a=e.record,r=e.statusText,c=e.onCancel,o=e.searchDeviceResult,s=e.isDeviceRomote,f=L(Object(u.useState)({selectType:1,keyWords:"",filterStatus:0}),2),v=f[0],g=f[1],y=L(Object(u.useState)({errorLogVisible:!1,errorLogRecord:{}}),2),I=y[0],k=y[1],x=a.taskId,C=a.taskExplain,S=a.status,N=a.execTime,R=a.protocolConfig,T=a.total,A=a.success,V=a.inExec,q=a.fail,Q=a.list,U=void 0===Q?[]:Q,J=a.pager,F=void 0===J?{}:J,B=v.selectType,M=v.keyWords,z=v.filterStatus,_=I.errorLogVisible,G=I.errorLogRecord,K=[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId",width:200},{title:"物理地址",dataIndex:"macAddress",width:200,key:"macAddress"},{title:"配置结果",dataIndex:"status",key:"status",width:160,render:function(e,t){var a=t.status;return d.a.createElement("span",{className:"verify-statu-".concat(a)},D[a-1])}},{title:"操作",key:"action",width:200,render:function(e,t){var a=t.status,n=t.remoteId;t.receiveMsg,t.errorType;return d.a.createElement("span",null,""+a=="4"?d.a.createElement(d.a.Fragment,null,d.a.createElement("a",{onClick:function(){return function(e){Object(m.c)(m.a.retryByTaskId,{remoteId:e}).then(function(e){W(F.pageIndex)})}(n)}},"重试"),d.a.createElement(i.a,{type:"vertical"}),d.a.createElement("a",{onClick:function(){return function(e){var t=e.remoteId,a=e.errorType;2==a?Object(m.c)(m.a.getReceiveMsg,{remoteId:t},{loading:!0}).then(function(e){k({errorLogVisible:!0,errorLogRecord:{errorType:a,receiveMsg:e.data&&e.data.receiveMsg}})}):k({errorLogVisible:!0,errorLogRecord:{errorType:a,receiveMsg:null}})}(t)}},"日志")):null)}}],Z=function(e,t){g(O({},v,w({},t,e)))},W=function(e){var t={};e&&(t.pageIndex=e),M&&(t[1===B?"deviceUniqueId":"macAddress"]=M),z&&(t.status=z),t.taskId=x,o(t)};return d.a.createElement(E.a,{visible:t,width:1e3,className:"romote-modal",title:"远程配置任务",centered:!0,closable:!0,onOk:null,onCancel:c,destroyOnClose:!0,maskClosable:!1,footer:null},d.a.createElement("div",{className:"romote-detail-content height-premit"},d.a.createElement("h3",null,"基础信息"),d.a.createElement("div",{className:"base-info"},d.a.createElement("p",null,d.a.createElement("span",null,"任务ID"),d.a.createElement("span",null,x||"--")),d.a.createElement("p",null,d.a.createElement("span",null,"任务说明"),d.a.createElement("span",null,C||"--")),d.a.createElement("p",null,d.a.createElement("span",null,"任务状态"),d.a.createElement("span",null,r[S]||"--")),d.a.createElement("p",null,d.a.createElement("span",null,"执行时间"),d.a.createElement("span",null,p.a.utcToDev(N)||"--"))),d.a.createElement("h3",null,"配置数据"),d.a.createElement(n.a,{columns:[{title:"数据名称",dataIndex:"propertyName",key:"propertyName",width:200},{title:"数据标识",dataIndex:"property",width:240,key:"property"},{title:"数据类型",dataIndex:"_type",key:"_type",width:120},{title:"数据属性",dataIndex:"propertyValueDesc",key:"propertyValueDesc"},{title:"下发数据",dataIndex:"sendData",key:"sendData",width:140}],dataSource:R||[],pagination:!1}),!s&&d.a.createElement(d.a.Fragment,null,d.a.createElement("h3",null,"配置设备"),d.a.createElement("div",{className:"device-wrapper"},d.a.createElement("div",null,d.a.createElement("h4",null,"配置设备数"),d.a.createElement("p",null,Number.isInteger(T)?T:"--")),d.a.createElement("div",null,d.a.createElement("h4",null,"配置成功"),d.a.createElement("p",null,Number.isInteger(A)?A:"--")),d.a.createElement("div",null,d.a.createElement("h4",null,"执行中"),d.a.createElement("p",null,Number.isInteger(V)?V:"--")),d.a.createElement("div",null,d.a.createElement("h4",null,"配置失败"),d.a.createElement("p",null,Number.isInteger(q)?q:"--")),d.a.createElement("div",null,d.a.createElement("span",{className:0==+q?"disable":"",onClick:+q>0?function(){Object(m.c)(m.a.batchRetry,{taskId:x}).then(function(e){W()})}:null},"批量重试"))),d.a.createElement("div",{className:"filter-wrapper"},d.a.createElement(b.a,{value:B,onChange:function(e){return Z(e,"selectType")}},d.a.createElement(j,{key:"1",value:1},"设备ID"),d.a.createElement(j,{key:"2",value:2},"物理地址")),d.a.createElement(h.a,{placeholder:"支持精确查询",value:M,maxLength:50,onChange:function(e){return Z(e.target.value,"keyWords")}}),d.a.createElement("span",null,"配置结果"),d.a.createElement(b.a,{value:z,onChange:function(e){return Z(e,"filterStatus")}},d.a.createElement(j,{key:"0",value:0},"全部"),d.a.createElement(j,{key:"1",value:1},"待执行"),d.a.createElement(j,{key:"2",value:2},"执行中"),d.a.createElement(j,{key:"3",value:3},"执行成功"),d.a.createElement(j,{key:"4",value:4},"执行失败")),d.a.createElement(l.a,{type:"primary",onClick:function(){return W()}},"查找"),d.a.createElement(l.a,{type:"primary",onClick:function(){Object(m.c)(m.a.exportTaskResult,{taskId:x}).then(function(e){window.open(m.a.exportTaskResult+"?taskId=".concat(x))})}},"导出数据")),d.a.createElement(n.a,{columns:K,dataSource:U||[],pagination:{total:F.totalRows,current:F.pageIndex,defaultCurrent:1,defaultPageSize:F.defaultPageRows,showQuickJumper:!1,hideOnSinglePage:!0,size:"small",onChange:function(e){return W(e)},showTotal:function(e){return d.a.createElement("span",null,"共 ",d.a.createElement("a",null,e)," 条")}}}),_&&d.a.createElement(P,{visible:_,onCancel:function(){return k({errorLogVisible:!1,errorLogRecord:{}})},record:G}))))}var A=["没问题","下发配置数据失败","上报的配置数据不一致","上报的配置数据在超时时间内未获取到","存在相同的设备在执行远程配置任务","后台数据异常"];function P(e){var t=e.visible,a=e.record,n=e.onCancel,r=a.errorType,l=a.receiveMsg;return d.a.createElement(E.a,{visible:t,width:600,className:"romote-modal",title:"日志",centered:!0,closable:!0,onOk:null,onCancel:n,destroyOnClose:!0,maskClosable:!1,footer:null},d.a.createElement("div",{className:"remote-error-wrapper"},d.a.createElement("div",null,d.a.createElement("label",null,"失败原因：")," ",d.a.createElement("span",null,A[r])),d.a.createElement("div",null,d.a.createElement("label",null,"报文信息："),d.a.createElement("div",{className:"msg-wrap"},function(e){if(!e)return d.a.createElement("h4",null,"无报文信息");var t=JSON.parse(e),a=Object.keys(t);return d.a.createElement(d.a.Fragment,null,d.a.createElement("h4",null,"报文解析列表"),a.map(function(e){return d.a.createElement("div",{className:"log-row"},d.a.createElement("span",{className:"log-left-key"},e),d.a.createElement("span",{className:"log-right-content"},t[e]))}))}(l)))))}var V=["设备ID的长度超过限制","物理地址的长度超限制","设备ID发生重复","物理地址发生重复","设备ID不存在或未联网","物理地址不存在或未联网"];function q(e){var t=e.visible,a=e.errorList,r=e.onCancel,l=[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId",width:200},{title:"错误原因",dataIndex:"errorType",width:200,key:"errorType",render:function(e,t){var a=t.errorType;return d.a.createElement("span",null,V[a-1])}}];return d.a.createElement(E.a,{visible:t,width:600,className:"romote-modal",title:"设备导入错误日志",centered:!0,closable:!0,onOk:null,onCancel:r,destroyOnClose:!0,maskClosable:!1,footer:null},d.a.createElement("div",null,d.a.createElement(n.a,{columns:l,dataSource:a||[],pagination:{total:a.length,defaultCurrent:1,defaultPageSize:10,showQuickJumper:!1,hideOnSinglePage:!0,size:"small",showTotal:function(e){return d.a.createElement("span",null,"共 ",d.a.createElement("a",null,e)," 条")}}})))}a("40NI");var Q=a("FC04");function U(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function J(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?U(a,!0).forEach(function(t){F(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):U(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function F(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function B(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,l=void 0;try{for(var c,i=e[Symbol.iterator]();!(n=(c=i.next()).done)&&(a.push(c.value),!t||a.length!==t);n=!0);}catch(e){r=!0,l=e}finally{try{n||null==i.return||i.return()}finally{if(r)throw l}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}a.d(t,"a",function(){return Z});var M=["平台支持远程更新设备的配置数据，您可以提交远程配置任务，实时对设备的系统参数等数据进行远程更新，并且获取设备配置的更新状态；详细说明可参考文档"],z=[{title:"创建远程配置任务"},{title:"添加配置数据"},{title:"选择设备"},{title:"执行任务"}],_=10,G=["草稿","待执行","执行中","已执行"],K=["","执行中","执行成功","执行失败"];function Z(e){var t=e.productId,a=e.protocolLists,o=void 0===a?[]:a,E=e.remoteType,y=void 0===E?"product":E,b=e.deviceId,h=e.deviceUniqueId,I=e.macAddress,k=B(Object(u.useState)(!1),2),O=k[0],w=k[1],x=B(Object(u.useState)({detailVisible:!1,selectRecord:{}}),2),L=x[0],C=x[1],S=B(Object(u.useState)([]),2),j=S[0],N=S[1],D=B(Object(u.useState)({pageIndex:1}),2),A=D[0],V=D[1],q=B(Object(u.useState)({deletevisible:!1,deleteItem:null,deleteLoading:!1}),2),U=q[0],F=q[1],Z=B(Object(u.useState)([]),2),W=Z[0],X=Z[1],H=B(Object(u.useState)(0),2),Y=H[0],$=H[1],ee=B(Object(u.useState)(null),2),te=ee[0],ae=ee[1],ne=B(Object(u.useState)({errorLogVisible:!1,errorLogRecord:{}}),2),re=ne[0],le=ne[1],ce=re.errorLogVisible,ie=re.errorLogRecord,oe=A.totalRows,se=A.pageIndex,ue=A.pageRows,de=U.deletevisible,me=U.deleteItem,pe=U.deleteLoading,fe=L.detailVisible,ve=L.selectRecord,ge="device"===y,Ee=s()(z);ge&&Ee.splice(2,1);var ye=ge?K:G,be=[{title:"任务ID",dataIndex:"taskId",key:"taskId",width:200},{title:"任务说明",dataIndex:"taskExplain",key:"taskExplain"},{title:"更新设备数量",dataIndex:"deviceTotal",key:"deviceTotal",width:180},{title:"任务状态",dataIndex:"status",key:"status",width:180,render:function(e,t){var a=t.status;return d.a.createElement("span",{className:"h5-statu-".concat(a+1)},ye[a])}},{title:"执行时间",dataIndex:"execTime",key:"execTime",width:180,render:function(e,t){var a=t.execTime;return d.a.createElement("span",null,a?p.a.utcToDev(a):"--")}},{title:"操作",key:"action",width:200,render:function(e,t){var a=t.status,n=t.taskId;return ge?d.a.createElement("span",null,d.a.createElement("a",{onClick:function(){return ke(t)}},"查看"),""+a=="3"?d.a.createElement(d.a.Fragment,null,d.a.createElement(i.a,{type:"vertical"}),d.a.createElement("a",{onClick:function(){return Le(n)}},"重试"),d.a.createElement(i.a,{type:"vertical"}),d.a.createElement("a",{onClick:function(){return Ce(t)}},"日志")):null):d.a.createElement("span",null,""+a=="1"?d.a.createElement(d.a.Fragment,null,d.a.createElement("a",{onClick:function(){return Ie(t)}},"编辑"),d.a.createElement(i.a,{type:"vertical"}),d.a.createElement("a",{onClick:function(){return F({deletevisible:!0,deleteItem:t})}},"删除")):d.a.createElement("a",{onClick:function(){return ke(t)}},"查看"))}}];ge&&be.splice(2,1);var he=function(e){var a=m.a.getRomoteConfigListByProduct,n={pageIndex:e||se,pageRows:_};ge?(a=m.a.getRomoteConfigListForDevice,n.deviceId=b):n.productId=t,Object(m.c)(a,n).then(function(e){var t=e.data,a=t.pager,n=void 0===a?{}:a,r=t.list,l=void 0===r?[]:r;N(Object(p.c)(l)),V(n)})};Object(u.useEffect)(function(){he()},[t,se,ge,b]),Object(u.useEffect)(function(){var e=o.filter(function(e){return 5==e.dataType}),t=e[0]&&e[0].list||[],a=e[0]&&e[0].protocolFormat||0;t=(t=t.filter(function(e){return"Base_Null_Reserved_Null"!==e.property})).map(function(e,t){var a=e.propertyValueDesc,n=null;if(a&&a.indexOf("|")>-1&&(n=a.split("|").map(function(e){var t=e.split("-");return t.length>1?{name:t[1],value:t[0]}:{}})),a&&a.indexOf("~")>-1){var r=B(a.split("~"),2);n={min:+r[0],max:+r[1]}}return J({},e,{_type:Object(p.q)(e),_params:n,_index:t,key:t})}),X(t),$(a)},[o]);var Ie=function(e){if(e){var t=e.taskId;Oe(t,1).then(function(e){var t=e.data,a=t.taskExplain,n=t.taskId,r=t.protocolJson,l=t.deviceList,c=JSON.parse(r),i=c.map(function(e){return e.property}),o=W.map(function(e){return e.defaultPropertyValue||""}),s=[];W.forEach(function(e,t){var a=e.property,n=i.indexOf(a);n>-1&&(o[t]=c[n].sendData,s.push(t))}),l.forEach(function(e){return e.key=e.deviceUniqueId}),ae({taskId:n,taskExplain:a,deviceList:l,protocolSendData:o,protocolSelection:s}),w(!O)})}else W.length>0&&w(!O)},ke=function(e){var t=e.taskId;ge?Object(m.c)(m.a.getRemoteDetailForDevice,{taskId:t},{loading:!0}).then(function(t){var a=t.data.protocolJson;C({detailVisible:!fe,selectRecord:J({},e,{protocolConfig:JSON.parse(a)})})}):Promise.all([Oe(t,2),we(t),xe({taskId:t})]).then(function(t){var a=B(t,3),n=a[0],r=a[1],l=a[2],c=n.data.protocolJson,i=void 0===c?"[]":c,o=r.data,s=l.data,u=s.list,d=s.pager;C({detailVisible:!fe,selectRecord:J({},e,{protocolConfig:JSON.parse(i)},o,{list:u,pager:d})})})},Oe=function(e,t){return Object(m.c)(m.a.getRemoteDetail,{taskId:e,type:t},{loading:!0})},we=function(e){return Object(m.c)(m.a.getResultTotal,{taskId:e},{loading:!0})},xe=function(e){return Object(m.c)(m.a.getDeviceResultList,J({},e),{loading:!0})},Le=function(e){Object(m.c)(m.a.retryByTaskIdForDevice,{taskId:e},{loading:!0}).then(function(e){he(se)})},Ce=function(e){var t=e.taskId,a=e.errorType;2==a?Object(m.c)(m.a.getReceiveMsgForDevice,{taskId:t},{loading:!0}).then(function(e){le({errorLogVisible:!0,errorLogRecord:{errorType:a,receiveMsg:e.data&&e.data.receiveMsg}})}):le({errorLogVisible:!0,errorLogRecord:{errorType:a,receiveMsg:null}})};return d.a.createElement("div",{className:"remote-config-wrapper"},d.a.createElement(f.a,{style:{margin:"0 0 24px",padding:"24px"}},d.a.createElement(v.a,{desc:M}),d.a.createElement("div",{style:{padding:"24px 0 0"},className:"use-service-flow-wrapper"},d.a.createElement(g.a,{type:3,flowLists:Ee}),d.a.createElement("div",{className:"extra-descs"},d.a.createElement("div",{className:"descs-item"},d.a.createElement("p",null,"创建远程配置任务，填写任务的目的或备注信息")),d.a.createElement("div",{className:"descs-item"},d.a.createElement("p",null,"添加要更新的产品配置数据字段和更新的数值")),!ge&&d.a.createElement("div",{className:"descs-item"},d.a.createElement("p",null,"可通过设备ID/物理地址，设备标签，本地导入确定要配置的设备")),d.a.createElement("div",{className:"descs-item"},d.a.createElement("p",null,"提交执行远程配置任务，设备更新结果实时可见"))))),d.a.createElement("section",{className:"remote-config-manage-wrapper section-bg"},d.a.createElement("h3",null,"远程配置任务",W.length?d.a.createElement(l.a,{style:{float:"right"},type:"primary",onClick:function(){return Ie()}},d.a.createElement(c.a,{type:"plus"}),"创建任务"):d.a.createElement(r.a,{title:"无配置协议时不支持创建"},d.a.createElement(l.a,{style:{float:"right"},type:"primary",disabled:!0},d.a.createElement(c.a,{type:"plus"}),"创建任务"))),d.a.createElement("div",{className:"table-wrapper"},d.a.createElement(n.a,{columns:be,className:"ant-table-fixed",dataSource:j,pagination:{total:oe,current:se,defaultCurrent:1,defaultPageSize:_,onChange:function(e){return function(e){he(e)}(e)},showQuickJumper:!0,hideOnSinglePage:!0,showTotal:function(e){return d.a.createElement("span",null,"共 ",d.a.createElement("a",null,e)," 条")}}})),O&&d.a.createElement(R,{visible:O,productId:t,protocolFormat:Y,onCancel:function(){w(!1),ae(null)},editData:te,configProtoclList:W,getRemoteList:he,isDeviceRomote:ge,_deviceList:[{deviceId:b,deviceUniqueId:h,macAddress:I}]}),fe&&d.a.createElement(T,{visible:fe,record:ve,statusText:ye,isDeviceRomote:ge,searchDeviceResult:function(e){xe(e).then(function(e){var t=e.data,a=t.list,n=t.pager;C({detailVisible:fe,selectRecord:J({},ve,{list:a,pager:n})})})},onCancel:function(){return C({detailVisible:!1,selectRecord:{}})}})),de&&d.a.createElement(Q.a,{visible:de,modalOKHandle:function(){var e=me.taskId;F(J({},U,{deleteLoading:!0})),Object(m.c)(m.a.deleteRomoteConfig,{taskId:e}).then(function(e){he(ue>1?se:se-1>0?se-1:1)}).finally(function(){F({deletevisible:!1,deleteItem:null,deleteLoading:!1})})},modalCancelHandle:function(){return F({deletevisible:!1,deleteItem:null,deleteLoading:!1})},targetName:me.taskId,confirmLoading:pe,title:"删除任务",needWarnIcon:!0,descText:"即将删除的任务",tipText:"任务的所有信息将完全被删除，无法找回，请谨慎操作"}),ce&&d.a.createElement(P,{visible:ce,onCancel:function(){return le({errorLogVisible:!1,errorLogRecord:{}})},record:ie}))}},YNSc:function(e,t,a){"use strict";a.d(t,"a",function(){return o});a("mbEz");var n=a("wCAj"),r=a("q1tI"),l=a.n(r),c=a("cu44"),i=[{title:"Topic",dataIndex:"topic",key:"topic"},{title:"描述",dataIndex:"desc",key:"desc"}];function o(e){var t=e.productIdHex,a=void 0===t?"":t,r=(e.type,[{fn:"属性",topic:"/sys/".concat(a,"/thing/event/property/post"),desc:"设备属性上报"},{fn:"事件info",topic:"/sys/".concat(a,"/device/thing/event/info/post"),desc:"设备信息通知"},{fn:"事件error",topic:"/sys/".concat(a,"/device/thing/event/error/post"),desc:"设备故障上报"},{fn:"事件alert",topic:"/sys/".concat(a,"/device/thing/event/alert/post"),desc:"设备告警"}]);return l.a.createElement(c.a,{title:"topic列表"},l.a.createElement("div",{style:{padding:"12px"}},l.a.createElement(n.a,{columns:i,dataSource:r,key:"topic",pagination:!1})))}}}]);