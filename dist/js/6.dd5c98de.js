(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"+J0j":function(e,t,a){},"1Ngb":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAQCAYAAABk1z2tAAACPUlEQVRIS82VT2jTYBiH3/dLUoWtFWQoCLvpabCLPXgYQpqWgraLgnzQPw48efK+3Qq7yDztuOO2roiHtUE2GdnIQUZl21kUFGVYNlemuFnN0jafdCyrDU2TeLG55vckD1/y/l6EPr9Q0zS+Wq0SSqnhx/WFpg3WazUhk0h898MVXmpDPJgXaFKqeOGwoLwaJSTANwxyEGhW9yilTS/gYmn9KSALcQgbJ0F+5ZEo6l64pZK6CwBXGeJsEC5Oy/LYcS8Ol4prN62AyVhjIMR/uS9J3xCR9QIXFXXu/D7CEYe4nEpIb9y4fEltPxdxnwBMpsalBSeuQ9B6IcfIL2PA3J2Ix2tOkh2CZyEE/Gxi8/nEePyTE9ch2Oa2gMMnmaS0Zee6ClohAoHDG8PBSjgcrtvBboLnHLKyoGOR0tgPO9dNsJU5PUEG84LATdG74r7F9RRshQghJscbe2+3tw9yuZxpgb0ET1/I4MQEWBm+xG+IotiwOCfB9u+CxwTYNH/92iwdGTFcBS1QIMJPKkfeexX86+Q+PJRjzzwLtk1fZ+9Fb3sWxCbU0g/i7/wKIuDHrByd8SuICJsZOTbmKtjXn/jfh4SUBd30PSQMYCHAc5OuQ9K3NdMqak6oV1KJxKFb4dqLGkxSzMqRshtnL2pEnEonI/OORV1Q1kcJQd+rLq+oMwxg0PeqU9QKMBjyvOrmdnaE1oQ97lLGvVZdfnU1BHAZsnduHXnZwVZmeW3ziq7/xrQc/eqFQy+h/5n5A/v0OCDUiLvVAAAAAElFTkSuQmCC"},"6LkR":function(e,t,a){},"94rQ":function(e,t,a){},GuBy:function(e,t,a){},IAq3:function(e,t,a){},KfNE:function(e,t,a){},RdJM:function(e,t,a){},sD8s:function(e,t,a){"use strict";a.r(t);a("2B1R"),a("Rm1S");var n,r=a("q1tI"),o=a.n(r),i=a("Ty5D"),c=(a("pNMO"),a("4Brf"),a("0oug"),a("4mDm"),a("NBAS"),a("ExoC"),a("07d7"),a("PKPk"),a("EnZy"),a("FZtP"),a("3bBZ"),a("mbEz"),a("wCAj")),l=(a("AUBz"),a("ZTPi")),u=a("/MKj"),s=a("yrct"),p=a("MeRu");a("IAq3");function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=l.a.TabPane,v=Object(i.i)(n=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=f(this,b(t).call(this,e)))._getDimensionList=function(){var e=1;"userDataApi"===a.dataApi&&(e=4),a.props.getDimensionList({dimensionType:e})},a._getApiList=function(e){var t=1;"userDataApi"===a.dataApi&&(t=2),a.props.getApiList({status:2,dataType:t,pageRows:10,pageIndex:e})},a.callback=function(e){a.props.getDimensionList({dimensionType:e})},a.onChange=function(e){a._getApiList(e)},a._getDataDimensionHTML=function(){var e=a.props.curDataDimension||{},t=e.dataDimension,n=e.dataIndex;return{dataDimensionHTML:t&&t.length>0?t.map(function(e,a){var n=e.dimensionName,r=e.dimensionDesc,i={};return t.length%2!=0&&a===t.length-2&&(i={borderBottom:"1px solid rgba(233, 233, 233, 1)"}),o.a.createElement("li",{key:a,style:i},o.a.createElement("span",{className:"key"},n,"："),o.a.createElement("span",{className:"value",title:r},r))}):o.a.createElement("li",null,o.a.createElement("span",{className:"key"},"暂无数据")),dataIndexHTML:n&&n.length>0?n.map(function(e,t){var a=e.indexName,r=e.indexDesc,i={};return n.length%2!=0&&t===n.length-2&&(i={borderBottom:"1px solid rgba(233, 233, 233, 1)"}),o.a.createElement("li",{key:t,style:i},o.a.createElement("span",{className:"key"},a,"："),o.a.createElement("span",{className:"value",title:r},r))}):o.a.createElement("li",null,o.a.createElement("span",{className:"key"},"暂无数据"))}},a._getAntDApiListData=function(){var e=a.props.apiList;return e.forEach(function(e){e.key=e.releaseId}),{apiList:e,columns:[{title:"方法",dataIndex:"requestType",key:"requestType"},{title:"URL",dataIndex:"apiUrl",key:"apiUrl"},{title:"描述",dataIndex:"apiDesc",key:"apiDesc"},{title:"版本",dataIndex:"releaseVersion",key:"releaseVersion"},{title:"状态",dataIndex:"status",key:"status",render:function(e){return 1===e?"未发布":"已发布"}},{title:"详情",key:"detail",render:function(e,t){return o.a.createElement("a",{href:"javascript:"},"查看说明")}}]}},a._getTabPaneHTML=function(){var e=a._getDataDimensionHTML(),t=e.dataDimensionHTML,n=e.dataIndexHTML;return["数据汇总","分析类","基础数据"].map(function(e,r){var i="deviceDataApi"===a.dataApi?r+1:r+4;return o.a.createElement(h,{tab:e,key:i},o.a.createElement("div",{className:"data-wrapper"},o.a.createElement("div",{className:"data-dimension"},o.a.createElement("header",null,"数据维度"),o.a.createElement("ul",{className:"clearfix"},t)),o.a.createElement("div",{className:"data-index"},o.a.createElement("header",null,"数据指标"),o.a.createElement("ul",{className:"clearfix"},n))))})},a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(t,r["Component"]),a=t,(n=[{key:"componentDidMount",value:function(){var e=this.props.match.path;this.dataApi=e.split("/")[3],this._getDimensionList(),this._getApiList(1)}},{key:"render",value:function(){var e=this.props.pager,t=this._getAntDApiListData(),a=t.apiList,n=t.columns,r=this._getTabPaneHTML(),i="deviceDataApi"===this.dataApi?"1":"4",u="deviceDataApi"===this.dataApi?"设备数据":"用户数据";return o.a.createElement("div",{className:"device-data-api-list-wrapper"},o.a.createElement(p.a,{noback:!0,title:u}),o.a.createElement("div",{className:"data-api-content-wrapper"},o.a.createElement("div",{className:"data-content"},o.a.createElement(l.a,{defaultActiveKey:i,tabBarStyle:{paddingLeft:"32px"},onChange:this.callback},r)),o.a.createElement("div",{className:"api-list-content"},o.a.createElement("header",null,"API"),o.a.createElement("div",{className:"api-table-wrapper"},o.a.createElement(c.a,{dataSource:a,columns:n,pagination:{onChange:this.onChange,defaultCurrent:1,pageSize:10,total:e.totalRows,showQuickJumper:!0}})))))}}])&&m(a.prototype,n),i&&m(a,i),t}())||n,g=Object(u.b)(function(e){return{curDataDimension:e.getIn(["deviceDataApi","curDataDimension"]).toJS(),apiList:e.getIn(["deviceDataApi","apiList"]).toJS(),pager:e.getIn(["deviceDataApi","pager"]).toJS()}},function(e){return{getDimensionList:function(t){var a=s.a.getDimensionList(t);e(a)},getApiList:function(t){var a=s.a.getApiList(t);e(a)}}})(v);var E=function(e){var t=e.match.path;return o.a.createElement(i.e,null,o.a.createElement(i.c,{path:"".concat(t,"/list"),component:g}),o.a.createElement(i.b,{to:"".concat(t,"/list")}))},O=(a("qNb/"),a("PArb")),w=a("55Ip"),S=a("+kVv"),I=a("Nlzp"),j=a("DgvE"),P=a("FC04"),D=a("P2RN");a("+J0j");function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function L(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var C=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=L(this,N(t).call(this,e))).componentDidMount=function(){a.props.getMethodList({pageIndex:1,pageRows:10})},a.onChange=function(e){a.props.getMethodList({pageIndex:e,pageRows:10})},a.delMethod=function(e){Object(I.c)(I.a.delMethod,{apiId:e}).then(function(e){0===e.code&&(Object(D.a)({type:"success",description:"删除统计方法成功"}),a.setState(function(e){return{showDeleteDialog:!e.showDeleteDialog}},function(){a.props.getMethodList({pageIndex:1,pageRows:10})}))})},a.showDeleteConfirm=function(e,t){a.setState(function(a){return{curApiId:e,showDeleteDialog:!a.showDeleteDialog,methodName:t}})},a._getAntDMethodListData=function(){var e=a.props,t=e.methodList,n=e.pager;return t.forEach(function(e,t){e.key=e.apiId,e.id=10*(n.pageIndex-1)+t+1}),{methodList:t,columns:[{title:"ID",dataIndex:"id",key:"id"},{title:"统计方法名称",dataIndex:"apiName",key:"apiName"},{title:"申请时间",dataIndex:"createDate",key:"createDate",render:function(e){return j.a.utcToDev(e)}},{title:"状态",dataIndex:"status",key:"status",render:function(e){return 0===e?"审核中":1===e?"审核通过":"审核拒绝"}},{title:"操作",key:"opt",render:function(e,t){return o.a.createElement("span",null,o.a.createElement(w.b,{key:"detail",to:"/open/bigData/customMethod/detail/"+t.key},"查看"),o.a.createElement(O.a,{type:"vertical"}),o.a.createElement("a",{href:"javascript:",onClick:function(){return a.showDeleteConfirm(t.apiId,t.apiName)}},"删除"))}}]}},a.updateOkHandle=function(){var e=a.state.curApiId;a.delMethod(e)},a.updateCancelHandle=function(){a.setState(function(e){return{showDeleteDialog:!e.showDeleteDialog}})},a.addMethod=function(){var e=a.props,t=e.history,n=e.methodNums,r=void 0===n?{}:n,o=r.MethodNum,i=void 0===o?0:o,c=r.MaxMethodNum;i>=(void 0===c?0:c)?Object(D.a)({description:"已达到上限值，无法新增！"}):t.push("/open/bigData/customMethod/add")},a.state={showDeleteDialog:!1,curApiId:void 0,methodName:""},a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(t,r["PureComponent"]),a=t,(n=[{key:"render",value:function(){var e=this,t=this.props.pager,a=this.state,n=a.showDeleteDialog,r=a.methodName,i=this._getAntDMethodListData(),l=i.methodList,u=i.columns;return o.a.createElement("div",{className:"method-list-wrapper"},o.a.createElement(p.a,{btnClickHandle:this.addMethod,btnIcon:"plus",noback:!0,needBtn:!0,btnText:"新增统计方法",title:"自定义统计方法"}),o.a.createElement("div",{className:"method-list-content-wrapper"},o.a.createElement("div",{className:"method-list-content"},o.a.createElement("div",{className:"content-title"},"统计方法列表："),o.a.createElement("div",{className:"content"},o.a.createElement(c.a,{dataSource:l,columns:u,pagination:{onChange:this.onChange,defaultCurrent:1,current:t.pageIndex,pageSize:10,total:t.totalRows,showQuickJumper:!0}})))),n&&o.a.createElement(P.a,{visible:n,modalOKHandle:function(){return e.updateOkHandle()},modalCancelHandle:function(){return e.updateCancelHandle()},targetName:r,title:"删除统计方法",descText:"删除该统计方法可能会导致APP图表无数据",needWarnIcon:!0,tipText:"请确认是否继续删除?"}),"}")}}])&&T(a.prototype,n),i&&T(a,i),t}(),_=Object(u.b)(function(e){return{methodList:e.getIn(["customMethod","methodList"]).toJS(),methodNums:e.getIn(["customMethod","MethodNums"]).toJS(),pager:e.getIn(["customMethod","pager"]).toJS()}},function(e){return{getMethodList:function(t){var a=S.a.getMethodList(t);e(a),e(S.a.getMethodNums())}}})(C),V=(a("ma9I"),a("tkto"),a("B6y2"),a("UxlC"),a("TeQF"),a("fbCW"),a("zKZe"),a("L/Qf"),a("2/Rp")),A=(a("K4yd"),a("9yH6")),F=(a("Jmwx"),a("BMrR")),M=(a("rO+z"),a("kPKH")),R=(a("tULf"),a("Vl3Y")),B=(a("1vPl"),a("5rEg")),H=(a("8QGh"),a("2fM7"));function q(e){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function U(){return(U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function G(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function K(e,t){return!t||"object"!==q(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var W=H.a.Option,z=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=K(this,J(t).call(this,e))).handleSubmit=function(e){e.preventDefault();var t=a.props.form.validateFieldsAndScroll,n=a.props,r=n.addMethod,o=n.protocolList,i=n.curApi;t(function(e,t){if(!e){console.log("Received values of form: ",t);var a=t.property,n=o&&o.find(function(e,t){return e.dataType===i.dataType}).list;t.propertyName=n.find(function(e){return e.property===a}).propertyName,r(t)}})},a._getProductListHTML=function(){var e=a.props.productList;return e&&e.map(function(e,t){var a=e.productId,n=e.productName;return o.a.createElement(W,{key:t,value:a},n)})},a._getProtocolListHTML=function(){var e=a.props,t=e.protocolList;return(2===e.bindType?t&&t.filter(function(e,t){var a=e.dataType;return 3===a||8===a||20===a||27===a}):t&&t.filter(function(e,t){return 3===e.dataType})).map(function(e,t){var a=e.dataType,n=e.dataTypeName;return o.a.createElement(W,{key:t,value:a},n)})},a._getCurProtocolListHTML=function(){var e=a.props,t=e.protocolList,n=e.curApi;if(0!==t.length&&n.dataType){var r=t&&t.find(function(e,t){return e.dataType===n.dataType}).list;return r&&r.map(function(e,t){var a=e.property,n=e.propertyName;return o.a.createElement(W,{key:t,value:a},n)})}},a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(t,r["Component"]),a=t,(n=[{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return o.a.createElement("div",{className:"add-method-form-wrapper"},o.a.createElement("div",{className:"title"},"添加方法"),o.a.createElement(R.a,U({},{labelCol:{span:3}},{className:"add-method-form"}),o.a.createElement("div",{className:"api-name"},o.a.createElement(R.a.Item,{label:"添加方法名称",wrapperCol:{span:10}},e("apiName",{rules:[{max:50,message:"最多可输入50个字符"},{required:!0,message:"请输入方法名称"}]})(o.a.createElement(B.a,{placeholder:"最多可输入50个字符"})))),o.a.createElement("div",{className:"select-wrapper"},o.a.createElement(F.a,{gutter:24},o.a.createElement(M.a,{span:8},o.a.createElement(R.a.Item,{label:"产品名称",labelCol:{span:9},wrapperCol:{span:15}},e("productId",{rules:[{required:!0,message:"请选择产品"}]})(o.a.createElement(H.a,{showSearch:!0,placeholder:"请选择产品",optionFilterProp:"children"},this._getProductListHTML())))),o.a.createElement(M.a,{span:8},o.a.createElement(R.a.Item,{label:"数据类型",labelCol:{span:9},wrapperCol:{span:15}},e("dataType",{rules:[{required:!0,message:"请选择数据类型"}]})(o.a.createElement(H.a,{showSearch:!0,placeholder:"请选择数据类型",optionFilterProp:"children"},this._getProtocolListHTML())))),o.a.createElement(M.a,{span:8})),o.a.createElement(F.a,{gutter:24},o.a.createElement(M.a,{span:8},o.a.createElement(R.a.Item,{label:"统计协议",labelCol:{span:9},wrapperCol:{span:15}},e("property",{rules:[{required:!0,message:"请选择统计协议"}]})(o.a.createElement(H.a,{showSearch:!0,placeholder:"请选择统计协议",optionFilterProp:"children"},this._getCurProtocolListHTML())))),o.a.createElement(M.a,{span:8},o.a.createElement(R.a.Item,{label:"统计精度",labelCol:{span:9},wrapperCol:{span:15}},e("reportFormsType",{rules:[{required:!0,message:"请选择统计精度"}]})(o.a.createElement(H.a,null,o.a.createElement(W,{value:4},"1小时"),o.a.createElement(W,{value:3},"1天"),o.a.createElement(W,{value:2},"1月"),o.a.createElement(W,{value:1},"1年"))))))),o.a.createElement("div",{className:"time-zone"},o.a.createElement(R.a.Item,{label:"时区",labelCol:{span:3},wrapperCol:{span:4}},e("cityTimeZone",{rules:[{required:!0,message:"请选择统计精度"}]})(o.a.createElement(H.a,null,o.a.createElement(W,{value:8},"北京"))))),o.a.createElement("div",{className:"compute-rule"},o.a.createElement(R.a.Item,{label:"返回值计算规则："},e("ruleType",{rules:[{required:!0,message:"请选择计算规则"}]})(o.a.createElement(A.a.Group,null,o.a.createElement(A.a,{className:"radio-item",value:1},"平均值：y=（a1+a2+...+an）/n"),o.a.createElement(A.a,{className:"radio-item",value:2},"和：y= an+a（n-1）"),o.a.createElement("br",null),o.a.createElement(A.a,{className:"radio-item",value:3},"最大值：y=amax"),o.a.createElement(A.a,{className:"radio-item",value:4},"最小值：y=amin"))))),o.a.createElement("div",{className:"submit"},o.a.createElement(V.a,{type:"primary",htmlType:"submit",onClick:this.handleSubmit},"提交审核"))))}}])&&G(a.prototype,n),i&&G(a,i),t}(),Y=R.a.create({name:"addMethod",onFieldsChange:function(e,t){console.log("changedFields",t),"{}"!==JSON.stringify(t)&&e.changeCurApi(t)},mapPropsToFields:function(e){for(var t=e.curApi,a={},n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];a[o]=R.a.createFormField({value:t[o]})}return a}})(z);a("uu5+");function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function X(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ee(e){return(ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function te(e,t){return(te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ae,ne=function(e){function t(){var e,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=$(this,(e=ee(t)).call.apply(e,[this].concat(r)))).componentDidMount=function(){a.props.getCurApi(),a.props.getProductList()},a.changeCurApi=function(e){var t=Object.keys(e)[0],n=Object.values(e)[0];"productId"===t&&a.props.getProtocolListByProductId({productId:n.value}),a.props.changeCurApi(t,n.value)},a.addMethod=function(e){Object(I.c)(I.a.addMethod,e).then(function(e){if(0===e.code){var t=a.props.history;Object(D.a)({type:"success",description:"新增统计方法成功"}),t.replace({pathname:"open/bigData/customMethod"})}})},a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(t,r["PureComponent"]),a=t,(n=[{key:"render",value:function(){var e=this,t=this.props,a=t.curApi,n=t.productList,r=t.bindType,i=t.protocolList;return o.a.createElement("div",{className:"add-method-wrapper"},o.a.createElement(p.a,{backHandle:function(){return e.props.history.goBack()},title:"自定义统计方法"}),o.a.createElement("div",{className:"add-content-wrapper"},o.a.createElement(Y,{curApi:a,productList:n,protocolList:i,bindType:r,changeCurApi:this.changeCurApi,addMethod:this.addMethod})))}}])&&X(a.prototype,n),i&&X(a,i),t}(),re=Object(u.b)(function(e){return{curApi:e.getIn(["customMethod","curApi"]).toJS(),productList:e.getIn(["customMethod","productList"]).toJS(),protocolList:e.getIn(["customMethod","protocolList"]).toJS(),bindType:e.getIn(["customMethod","bindType"])}},function(e){return{getCurApi:function(){var t=S.a.getCurApi();e(t)},getProductList:function(){var t=S.a.getProductList();e(t)},getProtocolListByProductId:function(t){var a=S.a.getProtocolListByProductId(t);e(a)},changeCurApi:function(t,a){var n=S.a.changeCurApi(t,a);e(n)}}})(ne);a("GuBy");function oe(e){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ie(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ce(e,t){return!t||"object"!==oe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function le(e){return(le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ue(e,t){return(ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var se=Object(i.i)(ae=function(e){function t(){var e,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=ce(this,(e=le(t)).call.apply(e,[this].concat(r)))).componentDidMount=function(){console.log("this.props.match.params",a.props.match.params);var e=a.props.match.params.apiId;a.props.getCurApi(e)},a.ruleType=function(e){return 1===e?o.a.createElement("span",null,"取平均值：y=（a",o.a.createElement("sub",null,"1"),"+a",o.a.createElement("sub",null,"2"),"+...+a",o.a.createElement("sub",null,"n"),"）/n"):2===e?o.a.createElement("span",null,"取和：y= a",o.a.createElement("sub",null,"n"),"+a",o.a.createElement("sub",null,"（n-1）")):3===e?o.a.createElement("span",null,"取最大值：y=a",o.a.createElement("sub",null,"max")):4===e?o.a.createElement("span",null,"取最小值：y=a",o.a.createElement("sub",null,"min")):o.a.createElement("span",null,"加载中...")},a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ue(e,t)}(t,r["PureComponent"]),a=t,(n=[{key:"render",value:function(){var e=this,t=this.props.curApi,a="",n="";switch(t.get("dataType")){case 3:a="运行数据";break;case 8:a="历史运行";break;case 20:a="历史控制";break;case 27:a="状态数据"}switch(t.get("reportFormsType")){case 1:n="1年";break;case 2:n="1月";break;case 3:n="1天";break;case 4:n="1小时"}return o.a.createElement("div",{className:"detail-method-wrapper"},o.a.createElement(p.a,{backHandle:function(){return e.props.history.goBack()},title:"自定义统计方法/查看"}),o.a.createElement("div",{className:"detail-content-wrapper"},o.a.createElement("div",{className:"detail-content"},o.a.createElement("ul",null,o.a.createElement("li",null,o.a.createElement("span",{className:"key"},"统计名称："),o.a.createElement("span",{className:"value"},t.get("apiName"))),o.a.createElement("li",null,o.a.createElement("span",{className:"key"},"产品名称："),o.a.createElement("span",{className:"value"},t.get("productName"))),o.a.createElement("li",null,o.a.createElement("span",{className:"key"},a,"："),o.a.createElement("span",{className:"value"},"".concat(t.get("propertyName")||"","-").concat(t.get("property")))),o.a.createElement("li",null,o.a.createElement("span",{className:"key"},"统计精度："),o.a.createElement("span",{className:"value"},n)),o.a.createElement("li",null,o.a.createElement("span",{className:"key"},"时区："),o.a.createElement("span",{className:"value"},t.get("cityTimeZone")?t.get("cityTimeZone"):"北京")),o.a.createElement("li",null,o.a.createElement("span",{className:"key"},"计算规则："),o.a.createElement("span",{className:"value"},this.ruleType(t.get("ruleType"))))))))}}])&&ie(a.prototype,n),i&&ie(a,i),t}())||ae,pe=Object(u.b)(function(e){return{curApi:e.getIn(["customMethod","curApi"])}},function(e){return{getCurApi:function(t){var a=S.a.getCurApi(t);e(a)}}})(se);var de=function(e){var t=e.match.path;return o.a.createElement(i.e,null,o.a.createElement(i.c,{path:"".concat(t,"/list"),component:_}),o.a.createElement(i.c,{path:"".concat(t,"/add"),component:re}),o.a.createElement(i.c,{path:"".concat(t,"/detail/:apiId"),component:pe}),o.a.createElement(i.b,{to:"".concat(t,"/list")}))},me=(a("qePV"),a("5DmW"),a("27RR"),a("yqJg"));a("RdJM");function fe(e){return(fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function be(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function ye(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?be(a,!0).forEach(function(t){he(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):be(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function he(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ve(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ge(e,t){return!t||"object"!==fe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var we={pageRows:10,pageIndex:1},Se=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=ge(this,Ee(t).call(this,e))).componentDidMount=function(){a._getDataSubscriptionList(we)},a.onChange=function(e){a._getDataSubscriptionList(ye({},we,{pageIndex:e}))},a.showActionConfirm=function(e,t){a.setState(function(a){return{showActionDialog:!a.showActionDialog,curSubscriptionId:e,dialogType:t}})},a.updateOkHandle=function(){var e=a.state,t=e.curSubscriptionId,n=e.dialogType;a._SubscriptionAction(t,n)},a.updateCancelHandle=function(){a.setState(function(e){return{showActionDialog:!e.showActionDialog,dialogType:""}})},a._getDataSubscriptionList=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(I.c)(I.a.getDataSubscriptionList,ye({},e,{version:"1.1"}),{loading:t}).then(function(e){var t=e.code,n=e.data;t===me.a&&a.setState(function(){return{dataSubscription:n}})})},a._SubscriptionAction=function(e,t){Object(I.c)("stop"===t?I.a.stopCurSubscription:I.a.enabledCurSubscription,{urlConfId:Number(e)},{loading:!0}).then(function(e){e.code===me.a&&a.setState(function(e){return{showActionDialog:!e.showActionDialog,dialogType:""}},function(){Object(D.a)({type:"success",description:"stop"===t?"停用数据订阅成功":"启用数据订阅成功"}),a._getDataSubscriptionList(we,!1)})})},a._getAntDDataSubscriptionListData=function(){var e=a.state.dataSubscription.list;return e.forEach(function(e,t){e.key=e.urlConfId}),{dataSubscriptionList:e,columns:[{title:"订阅ID",dataIndex:"urlConfId",key:"urlConfId"},{title:"订阅形式",dataIndex:"pushWay",key:"pushWay",render:function(e){return{0:"API数据PUSH形式",1:"MQTT主题订阅"}[e]||"--"}},{title:"订阅创建时间",dataIndex:"createTime",key:"createTime",render:function(e){return j.a.utcToDev(e)}},{title:"订阅更新时间",dataIndex:"updateTime",key:"updateTime",render:function(e){return j.a.utcToDev(e)}},{title:"状态",dataIndex:"pushState",key:"pushState",render:function(e){var t={color:"#FF2E00",marginRight:"10px"},a="停用";return 0===e?(t.color="#FF2E00",a="停用"):1===e?(t.color="#00B72E",a="正常"):(t.color="#FF2E00",a="锁定"),o.a.createElement("div",null,o.a.createElement("span",{style:t},"●"),o.a.createElement("span",null,a))}},{title:"操作",key:"opt",render:function(e,t){return o.a.createElement("span",null,o.a.createElement(w.b,{key:"detail",to:"/open/bigData/dataSubscription/detail/"+t.key},"查看"),o.a.createElement(O.a,{type:"vertical"}),o.a.createElement("a",{href:"javascript:",onClick:function(){return a.editSubscription(t.key)}},"编辑"),o.a.createElement(O.a,{type:"vertical"}),o.a.createElement("a",{href:"javascript:",onClick:function(){return a.showActionConfirm(t.key,0!==t.pushState?"stop":"start")}},0!==t.pushState?"停用":"启用"))}}]}},a.editSubscription=function(e){var t=a.props.history;Object(I.c)(I.a.getCurSubscription,{urlConfId:Number(e),version:"1.1"},{loading:!0}).then(function(e){var a=e.code,n=e.data;if(a===me.a){var r=n.urlConfId,o=n.productId,i=n.productName,c=n.deviceLabelIds;t.push({pathname:"/open/bigData/dataSubscription/edit/"+r,state:{urlConfId:r,productId:{dirty:!1,errors:void 0,name:"productId",touched:!0,validating:!1,value:{key:o,label:i}},labelOrDevice:{dirty:!1,errors:void 0,name:"labelOrDevice",touched:!0,validating:!1,value:c?0:1},deviceLabelIds:c}})}})},a.addSubscription=function(){var e=a.props.history,t=a.state.dataSubscription,n=t.devicePushConfMaxNum;t.currentNum>=n?Object(D.a)({description:"最多只能创建".concat(n,"个订阅")}):e.push({pathname:"/open/bigData/dataSubscription/add"})},a.state={dataSubscription:{list:[],pager:{}},showActionDialog:!1,curSubscriptionId:"",dialogType:""},a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(t,r["PureComponent"]),a=t,(n=[{key:"render",value:function(){var e=this,t=this.state,a=t.dataSubscription,n=t.showActionDialog,r=t.curSubscriptionId,i=t.dialogType,l=a.pager,u=this._getAntDDataSubscriptionListData(),s=u.dataSubscriptionList,d=u.columns;return o.a.createElement("div",{className:"subscription-list-wrapper flex-column"},o.a.createElement(p.a,{btnClickHandle:this.addSubscription,noback:!0,needBtn:!0,btnText:"新增订阅",title:"数据订阅"}),o.a.createElement("div",{className:"subscription-list-content-wrapper flex1"},o.a.createElement("div",{className:"subscription-list-content"},o.a.createElement(c.a,{className:"content",dataSource:s,columns:d,pagination:{onChange:this.onChange,defaultCurrent:1,current:l.pageIndex,pageSize:l.pageRows,total:l.totalRows,showQuickJumper:!0}}))),n&&o.a.createElement(P.a,{visible:n,modalOKHandle:function(){return e.updateOkHandle()},modalCancelHandle:function(){return e.updateCancelHandle()},targetName:r,title:"stop"===i?"停用":"启用",descText:"即将".concat("stop"===i?"停用":"启用","订阅ID"),descGray:!0,needWarnIcon:"stop"===i,tipText:"stop"===i?"停用之后不可使用，确认要停用吗？":"建议进入编辑确认是否是最新订阅内容和形式。"}))}}])&&ve(a.prototype,n),i&&ve(a,i),t}(),Ie=(a("x0AG"),a("yXV3"),a("oVuX"),a("BkRI")),je=a.n(Ie),Pe=(a("MKzF"),a("kaz8"));function De(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function ke(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?De(a,!0).forEach(function(t){Te(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):De(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function Te(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Le(e){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ne(){return(Ne=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function xe(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ce(e,t){return!t||"object"!==Le(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _e(e){return(_e=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ve(e,t){return(Ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ae=H.a.Option,Fe=(Pe.a.Group,function(e){function t(){var e,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Ce(this,(e=_e(t)).call.apply(e,[this].concat(r)))).handleSubmit=function(e){e.preventDefault();var t=a.props.form.validateFieldsAndScroll,n=a.props,r=n.changeCurrent,o=n.getProtocolListByProductId,i=n.subscriptionObjectForm,c=n.labelList,l=(i.checkedList,i.labelOrDevice);t(function(e,t){if(!e){if(console.log("Received values of form: ",t),0===l.value){var a=0;if(c.forEach(function(e){e.checked&&a++}),c.length>0&&a<=0)return void Object(D.a)({description:"请选择设备标签"});if(0===c.length)return void Object(D.a)({description:"暂无标签，请选择全量设备进行订阅"})}r("next"),o(i.productId.value.key,"1.2")}})},a.getLabelByProductId=function(e){(0,a.props.getLabelByProductId)(e)},a._getProductListHTML=function(){var e=a.props.productList;return e&&e.map(function(e,t){var a=e.productId,n=e.productName;return o.a.createElement(Ae,{key:a,value:a},n)})},a.choiceLabel=function(e){(0,a.props.choiceLabel)(e)},a._getLabelListHTML=function(e){return e.map(function(e,t){var n=e.checked,r=e.labelKey,i=e.labelValue;return o.a.createElement("div",{key:t,className:"label-item ".concat(n&&"active-label"),onClick:function(){return a.choiceLabel(t)}},r,"-",i)})},a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ve(e,t)}(t,r["Component"]),a=t,(n=[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"render",value:function(){var e=this.props,t=e.form,a=e.subscriptionObjectForm,n=(e.labelListPlains,e.labelList),r=a.indeterminate,i=a.checkAll,c=a.labelOrDevice,l=t.getFieldDecorator;return o.a.createElement("div",{className:"first-content"},o.a.createElement(R.a,Ne({},{labelCol:{span:3},wrapperCol:{span:21}},{className:"subscription-object-form"}),o.a.createElement(R.a.Item,{label:"选择产品",wrapperCol:{span:6},className:"product-select"},l("productId",{rules:[{required:!0,message:"请选择产品"}]})(o.a.createElement(H.a,{showSearch:!0,labelInValue:!0,placeholder:"请选择产品",optionFilterProp:"children",onChange:this.getLabelByProductId},this._getProductListHTML()))),o.a.createElement(R.a.Item,{label:"选择设备"},l("labelOrDevice",{rules:[{required:!0,message:"请选择设备"}]})(o.a.createElement(A.a.Group,null,o.a.createElement(A.a,{value:1},"全部设备"),o.a.createElement(A.a,{value:0},"根据标签筛选设备")))),o.a.createElement(F.a,{gutter:8,align:"middle"},o.a.createElement(M.a,{span:3,className:"product-label"}),0===c.value?n.length>0?o.a.createElement(M.a,{style:{padding:"24px"},span:20,className:"remarks"},o.a.createElement(R.a.Item,{label:"",colon:!1,labelCol:{span:0}},l("checkAll")(o.a.createElement(Pe.a,{indeterminate:r.value,checked:i.value},"全部标签"))),o.a.createElement(R.a.Item,{label:"",colon:!1,labelCol:{span:0}},o.a.createElement("div",{className:"label-wrapper"},this._getLabelListHTML(n)))):o.a.createElement("div",{className:"label-desc"},"暂无标签，请选择全量设备进行订阅"):o.a.createElement(M.a,{span:20},o.a.createElement("div",{className:"label-desc"},"备注：选择全量设备，则订阅产品下截止目前的所有激活的设备。")))))}}])&&xe(a.prototype,n),i&&xe(a,i),t}()),Me=R.a.create({name:"subscriptionObject",onFieldsChange:function(e,t){console.log("changedFields",t),"{}"!==JSON.stringify(t)&&e.changeFormData("subscriptionObjectForm",t)},mapPropsToFields:function(e){for(var t=e.subscriptionObjectForm,a={},n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];a[o]=R.a.createFormField(ke({},t[o],{value:t[o].value}))}return a}})(Fe);function Re(e){return(Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Be(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function He(e,t){return!t||"object"!==Re(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qe(e){return(qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ue(e,t){return(Ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ge=l.a.TabPane,Ke=function(e){function t(){var e,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=He(this,(e=qe(t)).call.apply(e,[this].concat(r)))).handleSubmit=function(e){e.preventDefault();var t=a.props.form.validateFieldsAndScroll,n=a.props,r=n.changeCurrent,o=n.devicePushDataConfList;t(function(e,t){if(!e){console.log("Received values of form: ",t);var a=!1;if(o&&o.forEach(function(e){e.selectedProtocolRowKeys.length>0&&(a=!0)}),!a)return void Object(D.a)({description:"请至少选择一条协议"});r("next")}})},a._getAntDProtocolListData=function(e,t){var n=a.props,r=n.devicePushDataConfList,o=n.onSelectChange,i=r.find(function(e){return e.dataType===t}),c=[];i&&(c=i.selectedProtocolRowKeys);var l=[];e.forEach(function(e){var t=e.property,a=e.bitDefList;t?l.push(e):a&&a.length>0&&a.forEach(function(e){e.property&&l.push(e)})}),l.forEach(function(e){e.key=e.property});return{rowSelection:{selectedRowKeys:c,onChange:function(e){return o(e,t)},hideDefaultSelections:!0,selections:!0},antDProtocolList:l,columns:[{title:"数据名称",dataIndex:"propertyName",key:"propertyName"},{title:"数据标志",dataIndex:"property",key:"property"},{title:"数据属性",dataIndex:"propertyValueDesc",key:"propertyValueDesc"}]}},a._getAntDTabs=function(){var e=a.props.protocolList;return e&&e.map(function(e){var t=e.dataType,n=e.dataTypeName,r=e.list,i=a._getAntDProtocolListData(r,t),l=i.rowSelection,u=i.antDProtocolList,s=i.columns;return o.a.createElement(Ge,{className:"",tab:n,key:t},o.a.createElement(c.a,{rowSelection:l,dataSource:u,columns:s,pagination:!1}))})},a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ue(e,t)}(t,r["Component"]),a=t,(n=[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"render",value:function(){var e=this.props.productName;return o.a.createElement("div",{className:"second-content"},o.a.createElement("div",{className:"product-name"},o.a.createElement("span",null,"已选择产品："),o.a.createElement("span",null,e)),o.a.createElement("div",{className:"protocol-type clearfix"},o.a.createElement("span",{className:"protocol-type-label"},"请选择协议类型："),o.a.createElement(l.a,{type:"card",className:"protocol-type-content",defaultActiveKey:"1"},this._getAntDTabs())))}}])&&Be(a.prototype,n),i&&Be(a,i),t}(),Je=R.a.create({name:"subscriptionContent"})(Ke);function Qe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function We(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Qe(a,!0).forEach(function(t){ze(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Qe(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function ze(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ye(e){return(Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ze(){return(Ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Xe(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $e(e,t){return!t||"object"!==Ye(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function et(e){return(et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tt(e,t){return(tt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var at=function(e){function t(){var e,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=$e(this,(e=et(t)).call.apply(e,[this].concat(r)))).handleSubmit=function(e){e.preventDefault();var t=a.props.form.validateFieldsAndScroll,n=a.props.createSubscription;t(function(e,t){e||n()})},a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tt(e,t)}(t,r["Component"]),a=t,(n=[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"render",value:function(){var e=this.props,t=e.form,a=e.subscriptionWayForm,n=t.getFieldDecorator,r=a.pushWay;return o.a.createElement("div",{className:"third-content"},o.a.createElement(R.a,Ze({},{labelCol:{span:2},wrapperCol:{span:22}},{className:"subscription-way-form"}),o.a.createElement(R.a.Item,{label:"订阅方式"},n("pushWay",{rules:[{required:!0,message:"请选择订阅方式"}]})(o.a.createElement(A.a.Group,null,o.a.createElement(A.a,{value:0},"API数据PUSH形式"),o.a.createElement(A.a,{value:1},"MQTT主题订阅")))),0===r.value&&o.a.createElement(R.a.Item,{label:"数据订阅URL"},n("url",{rules:[{required:!0,message:"请输入数据订阅服务器的URL"}]})(o.a.createElement(B.a,{placeholder:"请输入数据订阅服务器的URL",style:{width:"calc(70%)"}})),o.a.createElement("div",{className:"url-desc"},"第三方云服务接口的惟一标识，供C-Life云推送服务给第三方云推送数据用的，现仅支持http方式。")),0===r.value&&o.a.createElement(R.a.Item,{label:"Token"},n("pushToken",{rules:[{required:!0,message:"填写验证token"}]})(o.a.createElement(B.a,{placeholder:"填写验证token",style:{width:"calc(70%)"}})),o.a.createElement("div",{className:"token-desc"},"第三方云服务接口对接C-Life云推送服务的凭证，用来验证厂商服务接口的合法性。"))))}}])&&Xe(a.prototype,n),i&&Xe(a,i),t}(),nt=R.a.create({name:"subscriptionWay",onFieldsChange:function(e,t){"{}"!==JSON.stringify(t)&&e.changeFormData("subscriptionWayForm",t)},mapPropsToFields:function(e){for(var t=e.subscriptionWayForm,a={},n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];a[o]=R.a.createFormField(We({},t[o],{value:t[o].value}))}return a}})(at),rt=a("v7xx");a("KfNE");function ot(e){return(ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function it(){return(it=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function ct(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function lt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ct(a,!0).forEach(function(t){ut(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ct(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function ut(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function st(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function pt(e,t){return!t||"object"!==ot(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function dt(e){return(dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function mt(e,t){return(mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ft,bt=function(e){function t(e){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=pt(this,dt(t).call(this,e))).onSelectChange=function(e,t){a.setState(function(a){var n=a.devicePushDataConfList,r=n.findIndex(function(e){return e.dataType===t});return-1===r?n.push({dataType:t,selectedProtocolRowKeys:e}):n[r]={dataType:t,selectedProtocolRowKeys:e},{devicePushDataConfList:n}})},a._getProductByDeveloperId=function(){Object(I.c)(I.a.getProductByDeveloperId,{version:"1.1"},{loading:!0}).then(function(e){var t=e.code,n=e.data;t===me.a&&a.setState(function(){return{productList:n}})})},a.choiceLabel=function(e){a.setState(function(t){var a=t.subscriptionObjectForm,n=t.labelList;n[e].checked=!n[e].checked;var r=!0,o=0;return n.forEach(function(e){e.checked?o++:r=!1}),{labelList:n,subscriptionObjectForm:lt({},a,{indeterminate:{value:o&&o<n.length},checkAll:{value:r}})}})},a.changeFormData=function(e,t){a.setState(function(){var n,r=a.state[e],o=Object.keys(t),i=Object.values(t),c=o[0],l=i[0],u=a.state,s=u.labelListPlains,p=u.labelList,d=ut({},e,lt({},r,{},t));"checkAll"===c&&1===o.length?(p.forEach(function(e){e.checked=l.value}),ut(n={},e,lt({},d[e],{indeterminate:{value:!1},checkedList:{value:l.value?s:[]}})),ut(n,"labelList",p),d=n):"checkedList"===c&&1===o.length?d=ut({},e,lt({},d[e],{indeterminate:{value:!!l.value.length&&l.value.length<s.length},checkAll:{value:l.value.length===s.length}})):"pushWay"===c&&1===o.length&&(d=ut({},e,lt({},d[e],{url:{value:void 0},pushToken:{value:void 0}})));return d})},a.getProtocolListByProductId=function(e,t){Object(I.c)(I.a.getProtocolListByProductId,{productId:e,version:t},{loading:!0}).then(function(e){var t=e.code,n=e.data;t===me.a&&a.setState(function(){return{protocolList:n.list}})})},a.getLabelByProductId=function(e){a.setState(function(t){var a=t.subscriptionObjectForm;return a.checkedList={value:[]},a.indeterminate={value:!1},a.checkAll={value:!1},t.devicePushDataConfList=[],{productName:e.label}},function(){Object(I.c)(I.a.getLabelByProductId,{productId:Number(e.key),version:"1.1"},{loading:!0}).then(function(e){var t=e.code,n=e.data;if(t===me.a){var r=n&&n.map(function(e){return"".concat(e.labelId,"-").concat(e.labelKey,"-").concat(e.labelValue)});a.setState(function(){return{labelList:n||[],labelListPlains:r||[]}})}})})},a.changeCurrent=function(e){a.setState(function(t){return{current:"next"===e?t.current+1:t.current-1}})},a.goToNextStep=function(e,t){a[e].handleSubmit(t)},a.goToPreStep=function(){a.changeCurrent("pre")},a._getDataTypeScope=function(e,t){var n=a.state.protocolList,r=n&&n.find(function(t){return t.dataType===e}),o=r?r.list:[],i=0;return 0===o.length||0===t.length?i:(t.length===o.length?i=1:t.length<o.length&&(i=2),i)},a._getDeviceLabelId=function(){var e=a.state.labelList,t="";return e.forEach(function(e){e.checked&&(t+=e.labelId+",")}),t.substr(0,t.length-1)},a.createSubscription=function(){var e=a.state,t=e.subscriptionObjectForm,n=e.subscriptionWayForm,r=e.devicePushDataConfList,o=e.isEdit,i=je()(r),c=t.labelOrDevice;i.forEach(function(e){var t=e.selectedProtocolRowKeys,n=e.dataType;e.dataTypeScope=a._getDataTypeScope(n,t),t&&(e.protocolProperty=t.join(",")),e.dataFormat=1,delete e.selectedProtocolRowKeys});var l={deviceLabelIds:a._getDeviceLabelId(),devicePushDataConfList:i,pushWay:Number(n.pushWay.value)};1===c.value&&delete l.deviceLabelIds,t.productId.value.key&&(l.productId=Number(t.productId.value.key)),n.url.value&&(l.url=n.url.value),n.pushToken.value&&(l.pushToken=n.pushToken.value),o&&(l.urlConfId=o),Object(I.d)(o?I.a.saveSubscription:I.a.createSubscription,lt({},l),{loading:!0,needJson:!0,noInstance:!0}).then(function(e){var t=a.props.history;e.code===me.a&&(Object(D.a)({type:"success",description:o?"订阅编辑成功！":"订阅生成成功！"}),t.replace({pathname:"/open/bigData/dataSubscription"}))})};var n=a.props.location.state,r=void 0===n?{}:n,o=r.urlConfId,i=r.productId,c=r.labelOrDevice,l=r.deviceLabelIds;return console.log("DataSubscriptionAdd -> constructor -> state",r),a.state={subscriptionObjectForm:{productId:i||{value:void 0},checkedList:{value:[]},indeterminate:{value:!1},checkAll:{value:!1},labelOrDevice:c||{value:1}},subscriptionWayForm:{pushWay:{value:0},url:{value:void 0},pushToken:{value:void 0}},productName:"",productList:[],labelList:[],labelListPlains:[],protocolList:[],devicePushDataConfList:[],current:0,isEdit:o},l&&Object(I.c)(I.a.getLabelByProductId,{productId:Number(i.value.key),version:"1.1"},{loading:!0}).then(function(e){var t=e.code,n=e.data;if(t===me.a){var r=n&&n.map(function(e){return"".concat(e.labelId,"-").concat(e.labelKey,"-").concat(e.labelValue)}),o=l.split(",");n&&n.map(function(e){var t=e.labelId;o.indexOf(""+t)&&(e.checked=!0)}),a.setState(function(){return{labelList:n||[],labelListPlains:r||[]}})}}),a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mt(e,t)}(t,r["Component"]),a=t,(n=[{key:"componentDidMount",value:function(){this._getProductByDeveloperId()}},{key:"_getCurStepContent",value:function(){var e=this;return[{title:"配置订阅对象",content:o.a.createElement(Me,it({onRef:function(t){return e.subscriptionObjectForm=t},changeFormData:this.changeFormData,getLabelByProductId:this.getLabelByProductId,changeCurrent:this.changeCurrent,getProtocolListByProductId:this.getProtocolListByProductId,choiceLabel:this.choiceLabel},this.state))},{title:"配置订阅内容",content:o.a.createElement(Je,it({onRef:function(t){return e.subscriptionContentForm=t},changeFormData:this.changeFormData,changeCurrent:this.changeCurrent,onSelectChange:this.onSelectChange},this.state))},{title:"配置订阅方式",content:o.a.createElement(nt,it({changeFormData:this.changeFormData,createSubscription:this.createSubscription,onRef:function(t){return e.subscriptionWayForm=t}},this.state))}]}},{key:"render",value:function(){var e=this,t=this.state,a=t.current,n=t.isEdit,r=this._getCurStepContent();return o.a.createElement("div",{className:"subscription-add-page-wrapper flex-column"},o.a.createElement(p.a,{backHandle:function(){return e.props.history.goBack()},title:n?"订阅编辑":"新增订阅"}),o.a.createElement("div",{className:"step-header-wrapper"},o.a.createElement("div",{className:"step-header flex-row"},o.a.createElement("div",{className:"step-item flex-row flex1 ".concat(0===a&&"current-step")},o.a.createElement("i",{className:"step-product"}),o.a.createElement("span",null,"1. 选择订阅产品")),o.a.createElement("div",{className:"step-item flex1 flex-row ".concat(1===a&&"current-step")},o.a.createElement("i",{className:"step-data"}),o.a.createElement("span",null,"2. 选择订阅数据")),o.a.createElement("div",{className:"step-item flex1 flex-row ".concat(2===a&&"current-step")},o.a.createElement("i",{className:"step-way"}),o.a.createElement("span",null,"3. 选择订阅方式")))),o.a.createElement("div",{className:"add-content-wrapper flex1"},o.a.createElement("div",{className:"add-content"},o.a.createElement("div",{className:"steps-content"},r[a].content),o.a.createElement("div",{className:"steps-action"},0===a&&o.a.createElement(rt.a,{preBtn:!1,nextHandle:function(t){return e.goToNextStep("subscriptionObjectForm",t)}}),0!==a&&a<r.length-1&&o.a.createElement(rt.a,{preHandle:this.goToPreStep,nextHandle:function(t){return e.goToNextStep("subscriptionContentForm",t)}}),a===r.length-1&&o.a.createElement(rt.a,{nextText:"提交",preHandle:this.goToPreStep,nextHandle:function(t){return e.goToNextStep("subscriptionWayForm",t)}})))))}}])&&st(a.prototype,n),i&&st(a,i),t}();a("94rQ");function yt(e){return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ht(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vt(e,t){return!t||"object"!==yt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function gt(e){return(gt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Et(e,t){return(Et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ot=Object(i.i)(ft=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=vt(this,gt(t).call(this,e))).componentDidMount=function(){var e=a.props.match.params.urlConfId;a._getCurSubscription(e)},a._getCurSubscription=function(e){Object(I.c)(I.a.getCurSubscription,{urlConfId:Number(e),version:"1.1"},{loading:!0}).then(function(e){var t=e.code,n=e.data;t===me.a&&a.setState(function(){return{curSubscription:n}})})},a._getProtocol=function(e){var t=e&&e.map(function(e,t){var a=e.dataType,n=e.protocolProperty,r="";switch(a){case 2:r="控制数据";break;case 3:r="运行数据";break;case 4:r="故障数据"}return o.a.createElement("div",{className:"protocol-type",key:t},o.a.createElement("div",{className:"protocol-type-name"},r),o.a.createElement("div",{className:"protocol-type-list clearfix"},n&&n.split(",").map(function(e,t){return o.a.createElement("div",{key:t,className:"protocol-type-list-item fl"},e)})))});return o.a.createElement("div",{className:"protocol-wrapper"},t)},a._editProtocol=function(){var e=a.state.curSubscription,t=a.props.history,n=e.urlConfId,r=e.productId,o=e.productName,i=e.deviceLabelIds;n&&t.push({pathname:"/open/bigData/dataSubscription/edit/"+n,state:{urlConfId:n,productId:{dirty:!1,errors:void 0,name:"productId",touched:!0,validating:!1,value:{key:r,label:o}},labelOrDevice:{dirty:!1,errors:void 0,name:"labelOrDevice",touched:!0,validating:!1,value:i?0:1},deviceLabelIds:i}})},a.state={curSubscription:{}},a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Et(e,t)}(t,r["PureComponent"]),a=t,(n=[{key:"render",value:function(){var e=this,t=this.state.curSubscription,a=t.pushWay,n=t.pushState,r=t.createTime,i=t.updateTime,c=t.productName,l=t.labelVoList,u=t.devicePushDataConfList,s=t.pushToken,d=t.url,m=l&&l.map(function(e,t){return o.a.createElement("div",{key:t,className:"label-item fl"},e.labelValue)}),f={color:"#00B72E"},b="正常";return 0===n?(f={color:"#FF2E00"},b="停用"):1===n||(f={color:"#FF2E00"},b="锁定"),o.a.createElement("div",{className:"detail-subscription-wrapper flex-column"},o.a.createElement(p.a,{backHandle:function(){return e.props.history.goBack()},title:"订阅详情"}),o.a.createElement("div",{className:"detail-content-wrapper flex1"},o.a.createElement("div",{className:"detail-content"},o.a.createElement(F.a,{gutter:8,className:"detail-line"},o.a.createElement(M.a,{span:3,className:"detail-left"},"订阅方式："),o.a.createElement(M.a,{span:10,className:"detail-right"},0==a?"API数据PUSH形式":"MQTT主题订阅")),o.a.createElement(F.a,{gutter:8,className:"detail-line"},o.a.createElement(M.a,{span:3,className:"detail-left"},"订阅状态："),o.a.createElement(M.a,{span:10,style:f,className:"detail-right"},b)),o.a.createElement(F.a,{gutter:8,className:"detail-line"},o.a.createElement(M.a,{span:3,className:"detail-left"},"创建时间："),o.a.createElement(M.a,{span:10,className:"detail-right"},j.a.pekingToStr(r))),o.a.createElement(F.a,{gutter:8,className:"detail-line"},o.a.createElement(M.a,{span:3,className:"detail-left"},"更新时间："),o.a.createElement(M.a,{span:10,className:"detail-right"},j.a.pekingToStr(i))),o.a.createElement(F.a,{gutter:8,className:"detail-line"},o.a.createElement(M.a,{span:3,className:"detail-left"},"订阅产品："),o.a.createElement(M.a,{span:10,className:"detail-right"},c)),0===a&&o.a.createElement(o.a.Fragment,null,o.a.createElement(F.a,{gutter:8,className:"detail-line"},o.a.createElement(M.a,{span:3,className:"detail-left"},"数据订阅Url："),o.a.createElement(M.a,{span:10,className:"detail-right"},d)),o.a.createElement(F.a,{gutter:8,className:"detail-line"},o.a.createElement(M.a,{span:3,className:"detail-left"},"token："),o.a.createElement(M.a,{span:10,className:"detail-right"},s))),o.a.createElement(F.a,{gutter:8,className:"detail-line"},o.a.createElement(M.a,{span:3,className:"detail-left product-label"},"产品标签："),o.a.createElement(M.a,{span:22,className:"detail-right"},m)),o.a.createElement(F.a,{gutter:8,className:"detail-line"},o.a.createElement(M.a,{span:3,className:"detail-left"},"订阅数据："),o.a.createElement(M.a,{span:22,className:"detail-right"},this._getProtocol(u))),o.a.createElement("div",{className:"edit-wrapper"},o.a.createElement(V.a,{onClick:this._editProtocol,type:"primary"},"编辑")))))}}])&&ht(a.prototype,n),i&&ht(a,i),t}())||ft;var wt,St=function(e){var t=e.match.path;return console.log("DataSubscription -> path",t),o.a.createElement(i.e,null,o.a.createElement(i.c,{path:"".concat(t,"/list"),component:Se}),o.a.createElement(i.c,{path:"".concat(t,"/add"),component:bt}),o.a.createElement(i.c,{path:"".concat(t,"/edit/:urlConfId"),component:bt}),o.a.createElement(i.c,{path:"".concat(t,"/detail/:urlConfId"),component:Ot}),o.a.createElement(i.b,{to:"".concat(t,"/list")}))},It=(a("0lcf"),a("mr32")),jt=(a("k3Gp"),a("kLXV")),Pt=(a("bipt"),a("lrIw")),Dt=(a("gySj"),a("DFOY")),kt=a("rVDo"),Tt=a("rwTb"),Lt=[{id:1,nam:"模组固件"},{id:2,nam:"MCU固件"},{id:4,nam:"系统固件"}],Nt=[{nam:"待验证",color:"blue"},{nam:"验证中",color:"gold"},{nam:"已发布",color:"green"},{nam:"验证完成",color:"lime"}],xt=[{nam:"待升级",color:"blue"},{nam:"升级中",color:"gold"},{nam:"升级成功",color:"green"},{nam:"升级失败",color:"magenta"},{nam:"取消",color:"geekblue"},{nam:"下载结束",color:"geekblue"},{nam:"重置升级",color:"geekblue"}],Ct=[{value:1,label:"模组固件",children:[{value:1,label:"bootLoader"},{value:2,label:"servicePack"},{value:3,label:"hetProtocol"}]},{value:2,label:"MCU固件",children:[{value:1,label:"controlboard"},{value:2,label:"displayboard"},{value:3,label:"driveboard"}]},{value:4,label:"系统固件",children:[{value:1,label:"Android系统"},{value:2,label:"Linux系统"}]}],_t={strextVer:/^[a-zA-Z0-9_\-\.]{1,30}$/,verNam:/^[a-zA-Z0-9\u4e00-\u9fa5][a-zA-Z0-9_\u4e00-\u9fa5]{0,39}$/,mainVer:/^[0-9]*$/,url:/https?:\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/},Vt=[{id:1,nam:"普通升级",desc:"用户可感知，升级触发时用户可以在app上查看到升级提醒，确认后才能升级"},{id:2,nam:"强制升级",desc:"用户可感知，在app上查看到升级提示，无需确认自动开始升级"},{id:3,nam:"静默升级",desc:"用户无感知，无需确认，设备主动请求升级"},{id:4,nam:"推送升级",desc:"用户无感知，无需确认，平台主动推送下发升级到设备（需配置升级策略）"}],At=[{id:0,nam:"全部设备"},{id:1,nam:"设备分组"},{id:2,nam:"指定设备"}],Ft=[{id:0,nam:"不重试"},{id:1,nam:"30分钟后"},{id:2,nam:"1小时后"}],Mt=[{id:1,nam:"1 次"},{id:2,nam:"2 次"},{id:3,nam:"3 次"}],Rt=["触发升级","定时升级"],Bt=["整包","差分包"],Ht=["升级中","已完成"],qt=a("+vmU");function Ut(e){return(Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gt(){return(Gt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Kt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function Jt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Qt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{n||null==c.return||c.return()}finally{if(r)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Wt(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function zt(e,t){return!t||"object"!==Ut(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Yt(e){return(Yt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Zt(e,t){return(Zt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Xt,$t=H.a.Option,ea={labelCol:{xs:{span:24},sm:{span:7}},wrapperCol:{xs:{span:24},sm:{span:15}}},ta=R.a.create({name:"addFirmwareDialog"})(Object(u.b)(function(e){var t=e.get("otaUpgrade");return{productList:t.productList,extVerisonLi:t.extVerisonLi}},function(e){return{getVersionLi:function(t){return e(Object(qt.d)(t))},getExtVerLi:function(t){return e(Object(qt.b)(t))}}})(wt=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=zt(this,Yt(t).call(this,e))).handleSubmit=function(){var e=a.props,t=e.form.validateFieldsAndScroll,n=e.changeState;t(function(e,t){var r=Qt(t.verType,2),o=r[0],i=r[1];if(delete t.verType,!e){var c=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Kt(a,!0).forEach(function(t){Jt(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Kt(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},t,{deviceVersionType:o,firmwareVersionType:i});if(0==a.state.uploadType){var l=a.addFirmwareInput.getFileListUrl().length>0?a.addFirmwareInput.getFileListUrl().join(","):"";if(!l)return Object(D.a)({description:"请上传固件程序"}),!1;c.filePath=l}Object(I.d)(I.a.otaAddVersion,c,{needFormData:!0,needVersion:1.1,loading:!0}).then(function(e){a.resetForm(),a.props.getVersionLi(),n("addFirmwareDialog",!1)})}})},a.resetForm=function(){a.props.form.resetFields(),a.addFirmwareInput.setState({fileList:[]})},a.changePackType=function(e){var t=e.target.value;a.setState({packType:t},function(){a.getExtVersion()})},a.uploadType=function(e){var t=e.target.value;a.setState({uploadType:t})},a.getExtVersion=function(){if(0!=a.state.packType){var e=a.props.form.getFieldValue,t=e("productId"),n=e("totalVersion"),r=e("verType")||[],o=Qt(r,2),i=o[0],c=o[1];t&&n&&2==r.length?a.props.getExtVerLi({productId:t,totalVersion:n,deviceVersionType:i,firmwareVersionType:c}):a.props.getExtVerLi()}},a.checkMainVersion=function(e,t,a){+t>2147483647?a("最大不能超过数值2147483647"):a()},a.state={packType:0,uploadType:0},a}var a,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zt(e,t)}(t,o.a.Component),a=t,(n=[{key:"componentDidMount",value:function(){this.props.onRef(this)}},{key:"render",value:function(){var e=this,t=this.props,a=t.form.getFieldDecorator,n=t.productList,r=t.extVerisonLi,i=this.state,c=i.packType,l=i.uploadType;return o.a.createElement(R.a,Gt({},ea,{className:"ota_add_firmware_dialog"}),o.a.createElement(R.a.Item,{label:o.a.createElement(Tt.a,{label:"包类型",tip:"可选择整体升级包，或者差分包进行升级。"})},a("packageType",{rules:[{required:!0,message:"请选择包类型"}],initialValue:0})(o.a.createElement(A.a.Group,{onChange:this.changePackType},o.a.createElement(A.a.Button,{value:0},"整 包"),o.a.createElement(A.a.Button,{value:1},"差 分")))),o.a.createElement(R.a.Item,{label:"固件包名称",hasFeedback:!0},a("deviceVersionName",{rules:[{required:!0,message:"请输入固件包名称"},{pattern:_t.verNam,message:"仅支持中英文、数字、下划线，须以中英文或数字开头，不超过40个字符"}]})(o.a.createElement(B.a,{maxLength:40,placeholder:"中英文、数字、下划线，且须以中英文或数字开头"}))),o.a.createElement(R.a.Item,{label:"所属产品"},a("productId",{rules:[{required:!0,message:"请选择所属产品"}]})(o.a.createElement(H.a,{placeholder:"选择产品",onBlur:this.getExtVersion,showSearch:!0,optionFilterProp:"children"},n.map(function(e,t){var a=e.productId,n=e.productName;return o.a.createElement($t,{key:t,value:a},n)})))),o.a.createElement(R.a.Item,{label:"固件类型"},a("verType",{rules:[{required:!0,message:"请选择固件类型"}]})(o.a.createElement(Dt.a,{options:Ct,onChange:this.getExtVersion,expandTrigger:"hover",placeholder:"请选择固件类型"}))),o.a.createElement(R.a.Item,{label:o.a.createElement(Tt.a,{label:"固件系列标识",tip:"区分不同的固件系列，同系列同版本号的固件才能触发升级"}),hasFeedback:!0},a("totalVersion",{rules:[{required:!0,message:"请输入固件系列标识"},{pattern:_t.strextVer,message:"仅支持字母、数字、下划线、短横线、点号，不超过30个字符"}]})(o.a.createElement(B.a,{maxLength:30,onBlur:this.getExtVersion,placeholder:"支持字母、数字、下划线、短横线、点号"}))),o.a.createElement(R.a.Item,{label:o.a.createElement(Tt.a,{label:"内部版本号",tip:"同一系列标识的固件通过对比内部版本号决定是否升级"}),hasFeedback:!0},a("mainVersion",{rules:[{required:!0,message:"请输入内部版本号"},{pattern:_t.mainVer,message:"须为不小于0的整数"},{validator:this.checkMainVersion}]})(o.a.createElement(B.a,{maxLength:10,placeholder:"内部版本须为不小于0的整数"}))),0==c?o.a.createElement(R.a.Item,{label:o.a.createElement(Tt.a,{label:"外部版本号",tip:"升级时对外部用户可见的公开版本号"}),hasFeedback:!0},a("extVersion",{rules:[{required:!0,message:"请输入外部版本号!"},{pattern:_t.strextVer,message:"仅支持字母、数字、下划线、短横线、点号，不超过30个字符"}]})(o.a.createElement(B.a,{maxLength:30,placeholder:"支持字母、数字、下划线、短横线、点号"}))):o.a.createElement(o.a.Fragment,null,o.a.createElement(R.a.Item,{label:o.a.createElement(Tt.a,{label:"升级对象的外部版本号",tip:"需要升级的对象设备的外部版本号"}),hasFeedback:!0},a("upgradeExtVerison",{rules:[{required:!0,message:"请输入外部版本号!"},{pattern:_t.strextVer,message:"仅支持字母、数字、下划线、短横线、点号，不超过30个字符"}]})(o.a.createElement(Pt.a,{dataSource:r,placeholder:r.length>0?"选择或输入":"没有查到可选项请手动输入",maxLength:"30",filterOption:!0}))),o.a.createElement(R.a.Item,{label:o.a.createElement(Tt.a,{label:"升级后的外部版本号",tip:"升级时对外部用户可见的公开版本号"}),hasFeedback:!0},a("extVersion",{rules:[{required:!0,message:"请输入外部版本号!"},{pattern:_t.strextVer,message:"仅支持字母、数字、下划线、短横线、点号，不超过30个字符"}]})(o.a.createElement(B.a,{maxLength:30,placeholder:"支持字母、数字、下划线、短横线、点号"})))),o.a.createElement(R.a.Item,{label:"固件程序：",required:!0},o.a.createElement(A.a.Group,{defaultValue:0,onChange:this.uploadType},o.a.createElement(A.a.Button,{value:0},"本地上传"),o.a.createElement(A.a.Button,{value:1},"填写URL"))),o.a.createElement(R.a.Item,{className:"filepathinpt",hasFeedback:!0},1==l?a("filePath",{rules:[{required:!0,message:"请输入URL"},{pattern:_t.url,message:"请输入正确的URL"}]})(o.a.createElement(B.a,{maxLength:100,placeholder:"请输入URL"})):o.a.createElement(kt.a,{onRef:function(t){return e.addFirmwareInput=t},isNotImg:!0,format:".bin,.hex,.zip,.cyacd,.apk,.dpkg",maxSize:200})))}}])&&Wt(a.prototype,n),r&&Wt(a,r),t}())||wt),aa=(a("sMBO"),a("U8R4"),a("+eQT")),na=(a("7W5+"),a("8z0m")),ra=(a("RKNx"),a("L41K")),oa=a("wd/R"),ia=a.n(oa);function ca(e){return(ca="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function la(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function ua(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}function sa(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function pa(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function da(e,t){return!t||"object"!==ca(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ma(e){return(ma=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fa(e,t){return(fa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ba=H.a.Option,ya=B.a.TextArea,ha=ra.a.Step,va=[5,19],ga={labelCol:{span:va[0]},wrapperCol:{span:va[1]}},Ea=R.a.create({name:"ota_reaease_ver"})(Object(u.b)(function(e){var t=e.get("otaUpgrade");return{extVerisonLi:t.extVerisonLi,deviceGorupLi:t.deviceGorupLi}},function(e){return{getGroupLi:function(){return e(Object(qt.a)())},getVersionLi:function(t){return e(Object(qt.d)(t))}}})(Xt=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=da(this,ma(t).call(this,e))).changeState=function(e,t){var n=t.target?t.target.value:t;a.setState(sa({},e,n))},a.downloadMac=function(){window.location.href="https://open.clife.cn/v1/web/open/device/mac/download?type=2"},a.beforeUpload=function(e){if(!(e.size/1024<500))return Object(D.a)({description:"文件上传大小超过500k限制"}),!1;var t=a.props,n=t.deviceVersionId,r=t.form.setFieldsValue;return Object(I.d)(I.a.otaImportMac,{multipartFile:e,deviceVersionId:n},{needFormData:!0}).then(function(e){var t=e.data,a=void 0===t?{}:t,n=a.successes,o=(a.fails,a.totalCount),i=a.successCount,c=a.failCount,l=n.join(",");r({upgradeDevice:l}),Object(D.a)({message:"Mac导入结果",description:"共导入".concat(o,"条，成功了").concat(i,"条，失败了").concat(c,"条").concat("")})}),!1},a.goPreStep=function(){a.setState({stepcurrent:0})},a.goNextStep=function(){(0,a.props.form.validateFieldsAndScroll)(function(e,t){e||a.setState({stepcurrent:1})})},a.commit=function(){var e=a.props,t=e.form.validateFieldsAndScroll,n=e.deviceVersionId,r=e.close;t(function(e,t){if(!e){var o=t.extVersion,i=t.upgradeDevice,c=t.beginDate,l=t.endDate,u=ua(t,["extVersion","upgradeDevice","beginDate","endDate"]);o&&(u.extVersion=o.join(",")),i&&(u.upgradeDevice=i.join&&i.join(",")||i),(c||l)&&(u.beginDate=ia()(c).format("YYYY-MM-DD HH:mm:ss"),u.endDate=ia()(l).format("YYYY-MM-DD HH:mm:ss")),Object(I.c)(I.a.otaRelease,function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?la(a,!0).forEach(function(t){sa(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):la(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({deviceVersionId:n},u),{loading:!0}).then(function(){a.props.getVersionLi(),r()})}})},a.state={upgradeType:1,upgradeRange:1,stepcurrent:0,triggerTime:0},a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fa(e,t)}(t,r["Component"]),a=t,(n=[{key:"componentDidMount",value:function(){this.props.getGroupLi()}},{key:"render",value:function(){var e=this,t=this.props,a=t.form.getFieldDecorator,n=t.extVerisonLi,r=t.deviceGorupLi,i=t.packageType,c=this.state,l=c.upgradeType,u=c.upgradeRange,s=c.stepcurrent,p=c.triggerTime,d=Vt.find(function(e){return e.id==l}).desc;return o.a.createElement("div",{className:"ota_release_dialog"},o.a.createElement("div",{className:"stepbox"},o.a.createElement(ra.a,{current:s,size:"small"},o.a.createElement(ha,{title:"选择升级范围"}),o.a.createElement(ha,{title:"配置升级策略"})),4!=l&&o.a.createElement("div",{className:"disabled"})),o.a.createElement(R.a,ga,o.a.createElement("div",{style:{display:s?"none":"block"}},o.a.createElement(R.a.Item,{label:"升级方式",required:!0,help:d,className:"helpitem"},a("upgradeType",{initialValue:1})(o.a.createElement(A.a.Group,{onChange:function(t){e.changeState("upgradeType",t)}},Vt.map(function(e){var t=e.id,a=e.nam;return o.a.createElement(A.a.Button,{key:t,value:t},a)})))),o.a.createElement(R.a.Item,{label:"升级提示信息"},a("upgradeRemark")(o.a.createElement(ya,{placeholder:"仅普通升级和强制升级时，用户可在app（或设备屏幕）查看到升级提示，最多50个字符",rows:3,maxLength:50}))),o.a.createElement(R.a.Item,{label:"升级范围",required:!0,help:"若选择全部设备，则有且仅能发布一个批次，不能新增其他发布批次",className:"helpitem"},a("upgradeRange",{initialValue:1})(o.a.createElement(A.a.Group,{onChange:function(t){e.changeState("upgradeRange",t)}},At.map(function(e){var t=e.id,a=e.nam;return 4==l&&0==t?null:o.a.createElement(A.a.Button,{key:t,value:t},a)})))),2==u?o.a.createElement(o.a.Fragment,null,o.a.createElement(R.a.Item,{label:"设备Mac"},a("upgradeDevice",{rules:[{required:!0,message:"请输入或导入要升级的设备Mac"}]})(o.a.createElement(ya,{placeholder:"请输入或导入要升级的设备Mac，多个用逗号隔开",rows:5}))),o.a.createElement("div",{className:"ota_uploadbox"},o.a.createElement(na.a,{className:"upbtn",beforeUpload:this.beforeUpload,fileList:[],accept:".xls,.xlsx"},o.a.createElement(V.a,{type:"primary",icon:"upload"},"批量导入")),o.a.createElement(V.a,{className:"downbtn",type:"link",onClick:this.downloadMac},"下载模板"))):o.a.createElement(o.a.Fragment,null,1==u&&o.a.createElement(R.a.Item,{label:"升级设备组"},a("upgradeDevice",{rules:[{required:!0,message:"请选择设备组"}]})(o.a.createElement(H.a,{placeholder:"选择待升级设备组",mode:"multiple"},r.map(function(e){var t=e.id,a=e.name;return o.a.createElement(ba,{key:t,value:t},a)})))),1==i&&o.a.createElement(R.a.Item,{label:"外部版本号"},a("extVersion",{rules:[{required:!0,message:"请选择版本号"}]})(o.a.createElement(H.a,{placeholder:"请选择待升级外部版本号",mode:"multiple"},n.map(function(e,t){return o.a.createElement(ba,{key:t,value:e},e)})))))),4==l&&1==s&&o.a.createElement("div",null,o.a.createElement(R.a.Item,{label:"升级时间策略",required:!0},a("triggerTime",{initialValue:0})(o.a.createElement(A.a.Group,{onChange:function(t){e.changeState("triggerTime",t)}},o.a.createElement(A.a.Button,{value:0},"触发升级"),o.a.createElement(A.a.Button,{value:1},"定时升级")))),1==p&&o.a.createElement(o.a.Fragment,null,o.a.createElement(R.a.Item,{label:"升级开始时间"},a("beginDate",{rules:[{required:!0,message:"请选择开始时间"}]})(o.a.createElement(aa.a,sa({showTime:!0,placeholder:"请选择开始时间",format:"YYYY-MM-DD HH:mm:ss"},"showTime",{defaultValue:ia()("00:00:00","HH:mm:ss")})))),o.a.createElement(R.a.Item,{label:"升级结束时间"},a("endDate",{rules:[{required:!0,message:"请选择结束时间"}]})(o.a.createElement(aa.a,sa({showTime:!0,placeholder:"请选择结束时间",format:"YYYY-MM-DD HH:mm:ss"},"showTime",{defaultValue:ia()("00:00:00","HH:mm:ss")}))))),o.a.createElement(R.a.Item,{label:"失败重试时间",required:!0},a("retryTime",{initialValue:0})(o.a.createElement(A.a.Group,null,Ft.map(function(e){var t=e.id,a=e.nam;return o.a.createElement(A.a.Button,{key:t,value:t},a)})))),o.a.createElement(R.a.Item,{label:"失败重试次数",required:!0},a("retryCount",{initialValue:1})(o.a.createElement(A.a.Group,null,Mt.map(function(e){var t=e.id,a=e.nam;return o.a.createElement(A.a.Button,{key:t,value:t},a)})))))),o.a.createElement("div",{className:"btnbox"},4==l?o.a.createElement(o.a.Fragment,null,0==s?o.a.createElement(V.a,{onClick:this.goNextStep,type:"primary"},"下一步"):o.a.createElement(o.a.Fragment,null,o.a.createElement(V.a,{onClick:this.goPreStep},"上一步"),o.a.createElement(V.a,{type:"primary",onClick:this.commit},"确定"))):o.a.createElement(V.a,{type:"primary",onClick:this.commit},"确定")))}}])&&pa(a.prototype,n),i&&pa(a,i),t}())||Xt),Oa=(a("2DKY"),a("+KLJ"));function wa(e){return(wa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sa(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ia(e,t){return!t||"object"!==wa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ja(e){return(ja=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pa(e,t){return(Pa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Da,ka=B.a.TextArea,Ta={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:19}}},La=["系统验证：要求输入的设备全部都升级成功到新版本后，状态才更新成验证完成。","手动验证：用户线下自行对设备验证，验证通过后，选择验证完成状态。"],Na=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=Ia(this,ja(t).call(this,e))).changeValidateType=function(){},a.handleSubmit=function(){var e=a.props,t=e.deviceVersionId,n=e.validationDetail,r=n.macSet,o=n.validateType,i=e.pagerIndex,c=e.pageIndex,l=e.close;if(r){var u=a.state.status;Object(I.d)(I.a.otaValidate,{deviceVersionId:t,macSet:r,validateType:o,status:u},{loading:!0}).then(function(e){i(c),l()})}else a.setState({error:!0})},a.downloadMac=function(){window.location.href="https://open.clife.cn/v1/web/open/device/mac/download?type=2"},a.beforeUpload=function(e){if(!(e.size/1024<500))return Object(D.a)({description:"文件上传大小超过500k限制"}),!1;var t=a.props.deviceVersionId;return Object(I.d)(I.a.otaImportMac,{multipartFile:e,deviceVersionId:t},{needFormData:!0}).then(function(e){var t=e.data,n=void 0===t?{}:t,r=n.successes,o=(n.fails,n.totalCount),i=n.successCount,c=n.failCount,l=r.join(",");a.props.setValidationDetail("macSet",l),Object(D.a)({message:"Mac导入结果",description:"共导入".concat(o,"条，成功了").concat(i,"条，失败了").concat(c,"条").concat("")})}),!1},a.changeStatus=function(e){console.log(1111,e),a.setState({status:e})},a.changeValue=function(e,t){var n=t.target.value;(0,a.props.setValidationDetail)(e,n)},a.state={status:0,error:!1},a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pa(e,t)}(t,r["Component"]),a=t,(n=[{key:"componentDidMount",value:function(){this.props.onRef(this.handleSubmit)}},{key:"render",value:function(){var e=this,t=this.props.validationDetail,a=t.macSet,n=t.validateType,r=this.state.error;return o.a.createElement("div",{className:"ota_validationdialog"},o.a.createElement(R.a,Ta,o.a.createElement(R.a.Item,{label:"验证模式",name:"validateType"},o.a.createElement(A.a.Group,{value:n,onChange:function(t){e.changeValue("validateType",t)}},o.a.createElement(A.a.Button,{value:0},"系统验证"),o.a.createElement(A.a.Button,{value:1},"手动验证"))),o.a.createElement(R.a.Item,{label:"设备Mac",required:!0,help:!a&&r?"请输入或导入要验证的设备Mac":"",hasFeedback:!0,validateStatus:!a&&r?"error":""},o.a.createElement(ka,{value:a,placeholder:"请输入或导入要验证的设备Mac，多个用逗号隔开",rows:7,onChange:function(t){e.changeValue("macSet",t)}})),o.a.createElement("div",{className:"ota_uploadbox"},o.a.createElement(na.a,{className:"upbtn",beforeUpload:this.beforeUpload,fileList:[],accept:".xls,.xlsx"},o.a.createElement(V.a,{type:"primary",icon:"upload"},"批量导入")),o.a.createElement(V.a,{className:"downbtn",type:"link",onClick:this.downloadMac},"下载模板")),1==n&&o.a.createElement(R.a.Item,{label:"线下验证状态",name:"status"},o.a.createElement(A.a.Group,{defaultValue:0,onChange:function(t){e.changeStatus(t.target.value)}},o.a.createElement(A.a.Button,{value:0},"验证中"),o.a.createElement(A.a.Button,{value:1},"验证完成")))),o.a.createElement(Oa.a,{message:La[n],type:"info",showIcon:!0}))}}])&&Sa(a.prototype,n),i&&Sa(a,i),t}(),xa=a("cu44"),Ca=a("2kug");a("6LkR");function _a(e){return(_a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Va(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function Aa(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Va(a,!0).forEach(function(t){Fa(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Va(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function Fa(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ma(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ra(e,t){return!t||"object"!==_a(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ba(e){return(Ba=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ha(e,t){return(Ha=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var qa,Ua=B.a.Search,Ga=B.a.Group,Ka=H.a.Option,Ja=Object(u.b)(function(e){var t=e.get("otaUpgrade");return{productList:t.productList,versionList:t.versionList,extVerisonLi:t.extVerisonLi}},function(e){return{getProLi:function(t){return e(Object(qt.c)(t))},getVersionLi:function(t){return e(Object(qt.d)(t))},getExtVerLi:function(t){return e(Object(qt.b)(t))},sendFirmwareDetails:function(t){return e(Object(qt.e)(t))}}})(Da=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=Ra(this,Ba(t).call(this,e))).toFirmwareDetails=function(e){window.location.hash="#/open/bigData/OTA/firmwareDetails/".concat(e)},a.changeState=function(e,t){a.setState(Fa({},e,t))},a.switchDialog=function(e){var t=a.state[e];a.setState(Fa({},e,!t))},a.openRelease=function(e,t){var n=e.deviceVersionId,r=e.packageType;a.props.getExtVerLi(t),a.setState({releaseFirmwareDialog:!0,deviceVersionId:n,releasePackageType:r})},a.openValidation=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{macSet:"",validateType:0};a.setState({validationFirmwareDialog:!0,deviceVersionId:e,validationDetail:t,validationModTit:t.macSet?"修改验证":"验证"})},a.getValidateInfo=function(e){Object(I.c)(I.a.otaValiGetinfo,{deviceVersionId:e}).then(function(e){var t=e.data||[];a.setState({validateInfo:t}),t.length||Object(D.a)({description:"没有查到验证信息"})})},a.closeValidateInfo=function(){a.setState({validateInfo:[]})},a.deleteConfirm=function(e){jt.a.confirm({title:"删除固件",content:"即将删除 ID 为 ".concat(e," 的固件，此固件包下各批次的升级设备信息也将一并删除。"),okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){Object(I.c)(I.a.otaDeleteVer,{deviceVersionId:e}).then(function(e){var t=a.state.pager,n=t.totalRows,r=t.pageIndex;r=n%(10*(r-1))>1?r:r-1,a.pagerIndex(r)})}})},a.pagerIndex=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=a.state,n=t.productId,r=t.deviceVersionType,o=t.deviceVersionName,i={pageIndex:e};-1!=n&&(i.productId=n),-1!=r&&(i.deviceVersionType=r),o&&(i.deviceVersionName=o),a.props.getVersionLi(i)},a.closeValiFirm=function(){a.switchDialog("validationFirmwareDialog")},a.setValidationDetail=function(e,t){var n=a.state.validationDetail;a.setState({validationDetail:Aa({},n,Fa({},e,t))})},a.refAddFirmware={},a.refValidationFirmware=function(){},a.state={versionList:[],pager:{pageIndex:1,totalRows:10},productId:void 0,deviceVersionType:void 0,deviceVersionName:void 0,addFirmwareDialog:!1,validationFirmwareDialog:!1,deviceVersionId:"",validationDetail:{macSet:"",validateType:0},validationModTit:"验证",validateInfo:[],releaseFirmwareDialog:!1,releasePackageType:0},a.columns=[{title:"固件ID",dataIndex:"deviceVersionId"},{title:"固件包名称",dataIndex:"deviceVersionName"},{title:"固件类型",dataIndex:"deviceVersionType",render:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return Lt.find(function(t){return t.id==e}).nam}},{title:"包类型",dataIndex:"packageType",render:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Bt[e=e||0]}},{title:"固件包上传创建时间",dataIndex:"uploadTime",render:function(e){return o.a.createElement("span",null,j.a.utcToDev(e))}},{title:"内部版本号",dataIndex:"mainVersion"},{title:"外部版本号",dataIndex:"extVersion"},{title:"运行状态",dataIndex:"updateStatus",render:function(e){var t=Nt[e],a=t.nam,n=t.color;return o.a.createElement(It.a,{color:n},a)}},{title:"操作",dataIndex:"action",render:function(e,t){var n=t.runStatus,r=t.deviceVersionId,i=t.macSet,c=void 0===i?"":i,l=t.validateType,u=void 0===l?0:l,s=t.productId,p=t.totalVersion,d=t.deviceVersionType,m=t.firmwareVersionType,f=t.packageType;return o.a.createElement("span",null,0==n?o.a.createElement("a",{onClick:function(){a.openValidation(r)}},"验证"):1==n?o.a.createElement(o.a.Fragment,null,o.a.createElement("a",{onClick:function(){a.openValidation(r,{macSet:c,validateType:u||0})}},"修改验证"),o.a.createElement(O.a,{type:"vertical"}),o.a.createElement("a",{onClick:function(){a.getValidateInfo(r)}},"查看验证")):o.a.createElement(o.a.Fragment,null,4!=n&&o.a.createElement(o.a.Fragment,null,o.a.createElement("a",{onClick:function(){a.openRelease({deviceVersionId:r,packageType:f},{productId:s,totalVersion:p,deviceVersionType:d,firmwareVersionType:m})}},"发布"),o.a.createElement(O.a,{type:"vertical"})),3!=n&&o.a.createElement("a",{onClick:function(){a.toFirmwareDetails(r)}},"查看批次")),o.a.createElement(O.a,{type:"vertical"}),o.a.createElement("a",{onClick:function(){a.deleteConfirm(r)}},"删除"))}}],a.valInfoColumns=[{title:"Mac地址",dataIndex:"macAddress"},{title:"验证时间",dataIndex:"upgradeTime",render:function(e){return o.a.createElement("span",null,j.a.utcToDev(e))}},{title:"升级前版本",dataIndex:"beforeVersion"},{title:"验证状态",dataIndex:"upgradeStatus",render:function(e){var t=xt[e],a=t.nam,n=t.color;return o.a.createElement(It.a,{color:n},a)}},{title:"失败原因",dataIndex:"remark",render:function(e,t){return 3==t.upgradeStatus&&e||"--"}}],a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ha(e,t)}(t,r["Component"]),a=t,(n=[{key:"componentDidMount",value:function(){this.props.getProLi({pageRows:999}),this.pagerIndex()}},{key:"render",value:function(){var e=this,t=this.state,a=t.addFirmwareDialog,n=t.releaseFirmwareDialog,r=t.validationFirmwareDialog,i=t.deviceVersionId,l=t.validationDetail,u=t.validateInfo,s=t.releasePackageType,d=t.validationModTit,m=this.props,f=m.productList,b=m.versionList,y=b.list,h=b.pager,v=h.pageIndex,g=h.totalRows;return o.a.createElement("div",{className:"ota-firmware-up"},o.a.createElement(p.a,{noback:!0,title:"OTA升级"}),o.a.createElement(xa.a,null,o.a.createElement("div",{className:"use-service-flow-wrapper"},o.a.createElement(Ca.a,{type:3,flowLists:[{title:"步骤一"},{title:"步骤二"},{title:"步骤三"}]}),o.a.createElement("div",{className:"extra-descs"},o.a.createElement("div",{className:"descs-item"},o.a.createElement("p",null,"添加升级包，区分不同的MCU、模组、系统，区分整体包、差分包等。")),o.a.createElement("div",{className:"descs-item"},o.a.createElement("p",null,"配置升级对象，配置升级批次、升级范围、升级时间等升级具体策略。")),o.a.createElement("div",{className:"descs-item"},o.a.createElement("p",null,"查看升级包各升级批次的具体设备列表，以及各设备的升级状态。"))))),o.a.createElement("div",{className:"commonContentBox"},o.a.createElement("div",{className:"centent"},o.a.createElement(Ga,{compact:!0,className:"searchgroupbox"},o.a.createElement(H.a,{onChange:function(t){e.changeState("productId",t)},className:"proselect",showSearch:!0,optionFilterProp:"children",defaultValue:-1},o.a.createElement(Ka,{value:-1},"全部产品"),f.map(function(e,t){var a=e.productId,n=e.productName;return o.a.createElement(Ka,{key:t,value:a},n)})),o.a.createElement(H.a,{className:"typeselect",defaultValue:-1,onChange:function(t){e.changeState("deviceVersionType",t)}},o.a.createElement(Ka,{value:-1},"全部类型"),Lt.map(function(e,t){var a=e.id,n=e.nam;return o.a.createElement(Ka,{key:t,value:a},n)})),o.a.createElement(Ua,{placeholder:"输入升级包名称查找",className:"serachinpt",enterButton:!0,maxLength:20,onChange:function(t){e.changeState("deviceVersionName",t.target.value)},onSearch:function(){e.pagerIndex(1)}})),o.a.createElement(V.a,{className:"button",onClick:function(){e.switchDialog("addFirmwareDialog")},type:"primary"},"添加固件")),o.a.createElement("div",{className:"listBox"},o.a.createElement(c.a,{rowKey:"deviceVersionId",columns:this.columns,dataSource:y,pagination:{defaultCurrent:v,total:g,hideOnSinglePage:!1,onChange:this.pagerIndex}})),o.a.createElement(jt.a,{title:"新增固件",visible:a,onOk:function(){e.refAddFirmware.handleSubmit()},onCancel:function(){e.switchDialog("addFirmwareDialog"),e.refAddFirmware.resetForm()},width:650,maskClosable:!1},o.a.createElement(ta,{onRef:function(t){e.refAddFirmware=t},changeState:this.changeState})),n&&o.a.createElement(jt.a,{title:"发布固件",visible:!0,width:660,onCancel:function(){e.switchDialog("releaseFirmwareDialog")},footer:null,maskClosable:!1},o.a.createElement(Ea,{packageType:s,deviceVersionId:i,close:function(){e.switchDialog("releaseFirmwareDialog")}})),o.a.createElement(jt.a,{title:d,visible:r,onOk:function(){e.refValidationFirmware()},onCancel:this.closeValiFirm,width:650,maskClosable:!1},o.a.createElement(Na,{deviceVersionId:i,validationDetail:Aa({},l),setValidationDetail:this.setValidationDetail,pagerIndex:this.pagerIndex,pageIndex:v,onRef:function(t){e.refValidationFirmware=t},close:this.closeValiFirm})),o.a.createElement(jt.a,{title:"验证信息",visible:!!u.length,onCancel:this.closeValidateInfo,width:800,footer:null,maskClosable:!1},o.a.createElement(c.a,{rowKey:"macAddress",columns:this.valInfoColumns,dataSource:u,pagination:!1}))))}}])&&Ma(a.prototype,n),i&&Ma(a,i),t}())||Da,Qa=(a("hByQ"),a("OrB1"),a("gFTJ"));function Wa(e){return(Wa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function za(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function Ya(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?za(a,!0).forEach(function(t){Za(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):za(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function Za(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Xa(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $a(e,t){return!t||"object"!==Wa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function en(e){return(en=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function tn(e,t){return(tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var an,nn=Object(u.b)(function(e){e.get("otaUpgrade").firmwareDetails;return{}},function(e){return{}})(qa=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=$a(this,en(t).call(this,e))).toBatchDetail=function(e){window.location.hash="#/open/bigData/OTA/firmwareBatch/".concat(a.props.match.params.id,"/").concat(e)},a.getBatch=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=a.props.match.params.id,n=a.state.batchId;Object(I.c)(I.a.otaGetBatch,{deviceVersionId:t,batchId:n,pageIndex:e,pageRows:10}).then(function(e){var t=e.data,n=t.list,r=void 0===n?[]:n,o=t.pager,i=void 0===o?{}:o;a.setState({list:r,pager:i})})},a.getDetail=function(){var e=a.props.match.params.id;Object(I.c)(I.a.otaGetVersionDetail,{deviceVersionId:e}).then(function(e){var t=e.data;a.setState({details:Ya({},t)})})},a.search=function(e){a.setState({batchId:e},function(){a.getBatch()})},a.state={batchId:void 0,list:[],pager:{},details:{}},a.columns=[{title:"批次ID",dataIndex:"batchId"},{title:"发布时间",dataIndex:"createTime",render:function(e){return o.a.createElement("span",null,e&&j.a.utcToDev(e)||"--")}},{title:"升级范围",dataIndex:"upgradeRange",render:function(e){return At[e].nam}},{title:"升级方式",dataIndex:"upgradeType",render:function(e){return Vt[e-1].nam}},{title:"升级策略",dataIndex:"triggerTime",render:function(e){return Rt[e]}},{title:"升级状态",dataIndex:"upgradeStatus",render:function(e){return["升级中","已完成"][e]}},{title:"操作",key:"id",render:function(e,t){var n=t.batchId;return o.a.createElement("span",null,o.a.createElement("a",{onClick:function(){a.toBatchDetail(n)}},"查看"))}}],a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&tn(e,t)}(t,r["PureComponent"]),a=t,(n=[{key:"componentDidMount",value:function(){this.getBatch(),this.getDetail()}},{key:"render",value:function(){var e=this,t=this.state,a=t.pager,n=a.pageIndex,r=a.totalRows,i=t.list,l=t.details,u=l.deviceVersionName,s=l.packageType,d=l.productName,m=l.deviceVersionType,f=void 0===m?1:m,b=l.firmwareVersionType,y=void 0===b?1:b,h=l.uploadTime,v=l.mainVersion,g=l.extVersion,E=l.totalVersion,O=Ct.find(function(e){return e.value==f}),w=O.children[y-1].label;return o.a.createElement("section",{className:"ota-firmwaredetail flex-column"},o.a.createElement(p.a,{title:"OTA升级 / "+u}),o.a.createElement("header",{className:"page-content-header"},o.a.createElement(Qa.a,{title:"",className:"descriptions",column:4},o.a.createElement(Qa.a.Item,{label:"包类型"},Bt[s]),o.a.createElement(Qa.a.Item,{label:"所属产品"},d),o.a.createElement(Qa.a.Item,{label:"固件类型"},"".concat(O.label,"/").concat(w)),o.a.createElement(Qa.a.Item,{label:"上传时间"},h&&j.a.utcToDev(h)),o.a.createElement(Qa.a.Item,{label:"内部版本号"},v),o.a.createElement(Qa.a.Item,{label:"外部版本号"},g),o.a.createElement(Qa.a.Item,{label:"固件系列标识"},E))),o.a.createElement(xa.a,{title:"批次列表"},o.a.createElement("div",{className:"alone-section-content-default"},o.a.createElement(B.a.Search,{placeholder:"输入发布批次ID查询",className:"search",enterButton:!0,maxLength:20,onSearch:function(t){return e.search(t)}}),o.a.createElement(c.a,{rowKey:"batchId",columns:this.columns,dataSource:i,pagination:{defaultCurrent:n,total:r,hideOnSinglePage:!1,onChange:function(t){e.getBatch(t)},current:n}}))))}}])&&Xa(a.prototype,n),i&&Xa(a,i),t}())||qa;function rn(e){return(rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function on(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function cn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?on(a,!0).forEach(function(t){ln(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):on(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function ln(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function un(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function sn(e,t){return!t||"object"!==rn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function pn(e){return(pn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function dn(e,t){return(dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var mn=Object(u.b)(function(e){e.get("otaUpgrade").firmwareDetails;return{}},function(e){return{}})(an=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=sn(this,pn(t).call(this,e))).cancel=function(e){var t=a.verid,n=a.id;Modal.confirm({title:"取消升级",content:"即将取消升级 deviceId 为 ".concat(e," 的设备。"),okText:"确定",okType:"danger",cancelText:"取消",onOk:function(){Object(I.c)(I.a.otaCancelDevicePub,{deviceVersionId:t,batchId:n,deviceId:e}).then(function(){var e=a.state.pager,t=e.totalRows,n=e.pageIndex;n=t%(10*(n-1))>1?n:n-1,a.getList(n)})}})},a.getList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=a.verid,n=a.id,r=a.state.deviceId;Object(I.c)(I.a.otaGetBatchDevice,{deviceVersionId:t,batchId:n,deviceId:r,pageIndex:e,pageRows:10}).then(function(e){var t=e.data,n=t.list,r=void 0===n?[]:n,o=t.pager,i=void 0===o?{}:o;a.setState({list:r.map(function(e,t){return cn({},e,{index:t})}),pager:i})})},a.getDetail=function(){var e=a.verid,t=a.id;Object(I.c)(I.a.otaGetBatchInfo,{deviceVersionId:e,batchId:t}).then(function(e){var t=e.data;a.setState({details:cn({},t)})})},a.search=function(e){a.setState({deviceId:e},function(){a.getList()})},a.id=e.match.params.id,a.verid=e.match.params.verid,a.state={deviceId:void 0,list:[],pager:{},details:{}},a.columns=[{title:"设备ID",dataIndex:"deviceId"},{title:"MAC地址",dataIndex:"mac"},{title:"产品",dataIndex:"productName"},{title:"设备分组名",dataIndex:"groupName"},{title:"最新升级时间",dataIndex:"updateTime",render:function(e){return o.a.createElement("span",null,e&&j.a.utcToDev(e)||"--")}},{title:"升级前版本",dataIndex:"beforeVersion"},{title:"升级状态",dataIndex:"upgradeStatus",render:function(e){return e&&xt[e].nam}},{title:"操作",key:"act",render:function(e,t){var n=t.deviceId,r=t.upgradeStatus;return o.a.createElement("span",null,0==r&&o.a.createElement("a",{onClick:function(){a.cancel(n)}},"取消"))}}],a}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dn(e,t)}(t,r["PureComponent"]),a=t,(n=[{key:"componentDidMount",value:function(){this.getList(),this.getDetail()}},{key:"render",value:function(){var e=this,t=this.state,a=t.pager,n=a.pageIndex,r=a.totalRows,i=t.list,l=t.details,u=l.deviceVersionName,s=l.upgradeStatus,d=void 0===s?0:s,m=l.upgradeRange,f=void 0===m?0:m,b=l.createTime,y=l.triggerTime,h=l.beginTime,v=l.endTime,g=l.retryCount,E=l.retryTime,O=l.deviceVersionType,w=void 0===O?1:O,S=l.firmwareVersionType,I=void 0===S?1:S,P=Ct.find(function(e){return e.value==w}),D=P.children[I-1].label;return o.a.createElement("section",{className:"ota-firmwaredetail flex-column"},o.a.createElement(p.a,{title:"OTA升级 / ".concat(u||"固件包"," / ").concat(this.id)}),o.a.createElement("header",{className:"page-content-header"},o.a.createElement(Qa.a,{title:"",className:"descriptions",column:4},o.a.createElement(Qa.a.Item,{label:"升级状态"},Ht[d]),o.a.createElement(Qa.a.Item,{label:"升级范围"},At[f].nam),o.a.createElement(Qa.a.Item,{label:"发布时间"},b&&j.a.utcToDev(b)),o.a.createElement(Qa.a.Item,{label:"升级方式"},"".concat(P.label,"/").concat(D)),o.a.createElement(Qa.a.Item,{label:"升级触发策略"},Rt[y]),o.a.createElement(Qa.a.Item,{label:"升级开始时间"},h&&j.a.utcToDev(h)),o.a.createElement(Qa.a.Item,{label:"升级结束时间"},v&&j.a.utcToDev(v)),o.a.createElement(Qa.a.Item,{label:"升级失败重试"},E,"次"),o.a.createElement(Qa.a.Item,{label:"失败重试次数"},g))),o.a.createElement(xa.a,{title:"设备列表"},o.a.createElement("div",{className:"alone-section-content-default"},o.a.createElement(B.a.Search,{placeholder:"输入设备ID查询",className:"search",enterButton:!0,maxLength:20,onSearch:function(t){return e.search(t)}}),o.a.createElement(c.a,{rowKey:"index",columns:this.columns,dataSource:i,pagination:{defaultCurrent:n,total:r,hideOnSinglePage:!1,onChange:function(t){e.getList(t)},current:n}}))))}}])&&un(a.prototype,n),i&&un(a,i),t}())||an;var fn=function(e){var t=e.match.path;return o.a.createElement(i.e,null,o.a.createElement(i.c,{path:"".concat(t,"/firmwareList"),component:Ja}),o.a.createElement(i.c,{path:"".concat(t,"/firmwareDetails/:id"),component:nn}),o.a.createElement(i.c,{path:"".concat(t,"/firmwareBatch/:verid/:id"),component:mn}),o.a.createElement(i.b,{to:"".concat(t,"/firmwareList")}))};function bn(e){var t=e.match,a=e.muenList,n=t.path;return o.a.createElement(i.e,null,a.map(function(e,t){return"设备数据API"==e.menuname?o.a.createElement(i.c,{key:"设备数据API",path:"".concat(n,"/deviceDataApi"),component:E}):"用户数据API"==e.menuname?o.a.createElement(i.c,{key:"用户数据API",path:"".concat(n,"/userDataApi"),component:E}):"自定义统计方法"==e.menuname?o.a.createElement(i.c,{key:"自定义统计方法",path:"".concat(n,"/customMethod"),component:de}):"数据订阅"==e.menuname?o.a.createElement(i.c,{key:"数据订阅",path:"".concat(n,"/dataSubscription"),component:St}):void 0}),o.a.createElement(i.c,{key:"OTA",path:"".concat(n,"/OTA"),component:fn}),o.a.createElement(i.b,{to:"".concat(n,"/customMethod")}))}a.d(t,"default",function(){return bn})},"uu5+":function(e,t,a){},yqJg:function(e,t,a){"use strict";a.d(t,"a",function(){return n});var n=0}}]);