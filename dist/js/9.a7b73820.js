(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"+ch6":function(e,t,a){"use strict";a("pNMO"),a("4Brf"),a("0oug"),a("ma9I"),a("x0AG"),a("pjDv"),a("4mDm"),a("oVuX"),a("2B1R"),a("pDQq"),a("sMBO"),a("07d7"),a("5s+n"),a("p532"),a("JfAA"),a("PKPk"),a("3bBZ"),a("L/Qf");var n=a("2/Rp"),r=(a("1vPl"),a("5rEg")),c=(a("8QGh"),a("2fM7")),o=a("q1tI"),l=a.n(o);function i(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var s=c.a.Option,d=["按产品","按分组"];t.a=function(e){var t=e.list,a=e.searchedData,m=e.multiple,p=void 0!==m&&m,f=e.onRef,v=e.inputkey,b=u(Object(o.useState)(0),2),y=b[0],g=b[1],h=u(Object(o.useState)([-1]),2),E=h[0],O=h[1],j=u(Object(o.useState)(""),2),w=j[0],I=j[1],S=u(Object(o.useState)(!1),2),C=S[0],P=S[1],k=u(Object(o.useState)(!1),2),N=k[0],T=k[1];Object(o.useEffect)(function(){f&&f(x)});var L=function(e,t){var a=e.findIndex(function(e){return t==e}),n=i(e);return a>-1&&n.splice(a,1),n},x=function(){var e={type:y};return w&&(e[v]=w),E.length>0&&-1!==E[0]&&(e.productIds=E.join(",")),e};return l.a.createElement("div",{className:"comm-search-box"},l.a.createElement(r.a.Group,{compact:!0,className:"inputgroup"},l.a.createElement(c.a,{value:y,onChange:function(e){g(e),O([-1])}},d.map(function(e,t){return l.a.createElement(s,{key:t,value:t},e)})),l.a.createElement(c.a,{showSearch:!0,optionFilterProp:"children",mode:p?"multiple":"",defaultValue:[-1],value:E,onChange:!p&&function(e){O([e])}||void 0,onSelect:p&&function(e){O(-1==e?[-1]:function(t){var a=L(t,-1);return[].concat(i(a),[e])})}||void 0,onDeselect:p&&function(e){O(function(t){return L(t,e)})}||void 0,style:{width:250}},l.a.createElement(s,{value:-1},"全部".concat(0==y?"产品":"分组")),t[y].map(function(e,t){var a=e.productId,n=e.id,r=e.name,c=e.productName;return l.a.createElement(s,{key:t,value:[a,n][y]},[c,r][y])})),v&&l.a.createElement(r.a,{value:w,maxLength:30,placeholder:"请输入设备ID查询",style:{width:200},onChange:function(e){I(e.target.value)}})),l.a.createElement(n.a,{type:"primary",className:"btn",onClick:function(){P(!0),a(x()).finally(function(e){console.log("---rrr--",e),P(!1)})},loading:C,icon:"search"},"查询"),l.a.createElement(n.a,{type:"default",className:"btn",loading:N,onClick:function(){g(0),O([-1]),I(""),T(!0),a({}).finally(function(){T(!1)})}},"重置"))}},"1Ngb":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAQCAYAAABk1z2tAAACPUlEQVRIS82VT2jTYBiH3/dLUoWtFWQoCLvpabCLPXgYQpqWgraLgnzQPw48efK+3Qq7yDztuOO2roiHtUE2GdnIQUZl21kUFGVYNlemuFnN0jafdCyrDU2TeLG55vckD1/y/l6EPr9Q0zS+Wq0SSqnhx/WFpg3WazUhk0h898MVXmpDPJgXaFKqeOGwoLwaJSTANwxyEGhW9yilTS/gYmn9KSALcQgbJ0F+5ZEo6l64pZK6CwBXGeJsEC5Oy/LYcS8Ol4prN62AyVhjIMR/uS9J3xCR9QIXFXXu/D7CEYe4nEpIb9y4fEltPxdxnwBMpsalBSeuQ9B6IcfIL2PA3J2Ix2tOkh2CZyEE/Gxi8/nEePyTE9ch2Oa2gMMnmaS0Zee6ClohAoHDG8PBSjgcrtvBboLnHLKyoGOR0tgPO9dNsJU5PUEG84LATdG74r7F9RRshQghJscbe2+3tw9yuZxpgb0ET1/I4MQEWBm+xG+IotiwOCfB9u+CxwTYNH/92iwdGTFcBS1QIMJPKkfeexX86+Q+PJRjzzwLtk1fZ+9Fb3sWxCbU0g/i7/wKIuDHrByd8SuICJsZOTbmKtjXn/jfh4SUBd30PSQMYCHAc5OuQ9K3NdMqak6oV1KJxKFb4dqLGkxSzMqRshtnL2pEnEonI/OORV1Q1kcJQd+rLq+oMwxg0PeqU9QKMBjyvOrmdnaE1oQ97lLGvVZdfnU1BHAZsnduHXnZwVZmeW3ziq7/xrQc/eqFQy+h/5n5A/v0OCDUiLvVAAAAAElFTkSuQmCC"},O0UD:function(e,t,a){},PE3M:function(e,t,a){"use strict";a.r(t);a("Rm1S");var n=a("q1tI"),r=a.n(n),c=a("Ty5D"),o=(a("pNMO"),a("4Brf"),a("0oug"),a("TeQF"),a("4mDm"),a("2B1R"),a("sMBO"),a("zKZe"),a("5DmW"),a("27RR"),a("tkto"),a("07d7"),a("PKPk"),a("FZtP"),a("3bBZ"),a("k3Gp"),a("kLXV")),l=(a("tULf"),a("Vl3Y")),i=(a("1vPl"),a("5rEg")),u=a("MeRu"),s=a("8QW8"),d=a("cu44"),m=a("FC04"),p=a("Nlzp"),f=a("55Ip"),v=a("DgvE");function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(a,!0).forEach(function(t){h(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function h(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var O=/^[\w\u4E00-\u9FA5]{1,30}$/,j="中英文、数字、下划线，长度不超过30";var w=l.a.create({name:"form_in_modal-project-add"})(function(e){var t=e.form,a=(e.history,E(Object(n.useState)([]),2)),c=a[0],y=a[1],h=E(Object(n.useState)(!1),2),w=h[0],I=h[1],S=E(Object(n.useState)(!1),2),C=S[0],P=S[1],k=E(Object(n.useState)(null),2),N=k[0],T=k[1],L=t.getFieldDecorator,x=i.a.TextArea,D=Object(n.useCallback)(function(){Object(p.c)(p.a.getProjectList,{loading:!0}).then(function(e){e&&e.data&&y(e.data)})},[]);Object(n.useEffect)(function(){D()},[D]);var R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=e.serveCount,a=e.deviceCount,n=e.proCount,r="";return(t>0||a>0||n>0)&&(r="项目下仍有服务未删除，或有产品/设备未解除关联关系，请进入项目内删除对应内容"),r};return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{noback:!0,title:"项目管理",needBtn:!0,btnText:"新建项目",btnClickHandle:function(e){N&&T(e),I(!0)},btnIcon:"plus"}),r.a.createElement(d.a,{style:{minHeight:"calc(100% - 102px)"}},c.length>0?r.a.createElement("div",{className:"project-wrapper"},c.map(function(e,t){var a=e.name,n=e.deviceCount,c=e.serveCount,o=e.createTime,l=e.projectId;return r.a.createElement("div",{className:"project-item",key:t+t},r.a.createElement(f.b,{to:{pathname:"/open/developCenter/projectManage/detail/".concat(l),search:"?name=".concat(a)},className:"title"},a),r.a.createElement("span",{className:"time"},"创建于：".concat(v.a.utcToDev(+o))),r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"item"},r.a.createElement("span",null,"关联设备"),r.a.createElement("h2",null,n)),r.a.createElement("div",{className:"item"},r.a.createElement("span",null,"服务"),r.a.createElement("h2",null,c))),r.a.createElement("div",{className:"btns"},r.a.createElement("span",{onClick:function(){T(g({},e)),I(!0)}},"编辑"),r.a.createElement("span",{onClick:function(){!function(e){var t=e.serveCount,a=e.deviceCount,n=e.projectId;if(t>0||a>0)return T(e),void P(!0);Object(p.c)(p.a.getProductInProject,{projectId:n},{loading:!0}).then(function(t){var a=t&&t.data&&t.data.list||[];e.proCount=a.length,T(e),P(!0)})}(g({},e))}},"删除")))})):r.a.createElement(s.a,{tipText:"没有项目，请添加"})),w&&r.a.createElement(o.a,{visible:w,width:600,title:"新增项目",centered:!0,closable:!1,onCancel:function(){T(null),I(!1)},onOk:function(){t.validateFields(function(e,t){if(!e){var a=p.a.addProject,n=g({},t);N&&(a=p.a.updateProject,n.projectId=N.projectId),Object(p.d)(a,n,{loading:!0}).then(function(e){I(!1),N&&T(null),D()})}})},destroyOnClose:!0,maskClosable:!1},r.a.createElement(l.a,b({labelCol:{span:4},wrapperCol:{span:20}},{labelAlign:"left"}),r.a.createElement(l.a.Item,{label:"项目名称"},L("name",{rules:[{required:!0,message:"请输入项目名称"},{pattern:O,message:j}],initialValue:N?N.name:""})(r.a.createElement(i.a,{placeholder:j}))),r.a.createElement(l.a.Item,{label:"项目描述"},L("desc",{rules:[{required:!0,message:"请输入项目描述"},{pattern:O,message:j}],initialValue:N?N.desc:""})(r.a.createElement(x,{placeholder:j,rows:3}))))),C&&r.a.createElement(m.a,{visible:C,title:"删除项目",needWarnIcon:!0,descText:"即将删除的项目",targetName:N.name,tipText:R(),modalCancelHandle:function(){P(!1),T(null)},modalOKHandle:function(){var e=N.projectId;if(R())return P(!1),void T(null);Object(p.c)(p.a.deleteProject,{id:e},{loading:!0}).then(function(e){P(!1),T(null),D()})}}))}),I=(a("ma9I"),a("oVuX"),a("+2oP"),a("5s+n"),a("p532"),a("mbEz"),a("wCAj")),S=(a("L/Qf"),a("2/Rp")),C=(a("qNb/"),a("PArb")),P=(a("8QGh"),a("2fM7")),k=(a("AUBz"),a("ZTPi")),N=a("P2RN"),T=a("+ch6");function L(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function x(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function D(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}P.a.Option;function R(e){var t=e.visible,a=e.okLoading,c=e.onOkHandle,l=e.onCancelHandle,u=e._selectedRowKeys,s=e.columns,d=e.type,m=void 0===d?1:d,p=e.dataInRela,f=e.getRelaList,v=D(Object(n.useState)(u||[]),2),b=v[0],y=v[1],g=D(Object(n.useState)(""),2),h=g[0],E=g[1],O=D(Object(n.useState)(!1),2),j=O[0],w=O[1],C=D(Object(n.useState)(!1),2),P=C[0],k=C[1],R=p.list,A=p.pager,F=p.relatedProductList,Q=p.deviceGroupList,_=function(){},M=function(e){var t={};1===m?h&&(t.name=h):Object.assign(t,_()),"number"==typeof e?t._index=e:w(!0),f(t).finally(function(){w(!1)})},V={selectedRowKeys:b,onChange:function(e){y(e)}};return r.a.createElement(o.a,{visible:t,width:1e3,title:"关联".concat(["产品","设备"][m-1]),okText:"确定",confirmLoading:a,onOk:function(){b.length?c(b):Object(N.a)({message:"请至少选中一个后再进行管理"})},cancelText:"取消",onCancel:l,centered:!0,closable:!1,destroyOnClose:!0,maskClosable:!1},r.a.createElement("div",{style:{marginBottom:"24px"}},1===m&&r.a.createElement(r.a.Fragment,null,r.a.createElement(i.a,{placeholder:"请输入产品查询名称",style:{width:"240px",marginRight:"12px"},value:h,onChange:function(e){return E(e.target.value)},maxLength:20}),r.a.createElement(S.a,{type:"primary",style:{marginRight:"12px"},onClick:M,loading:j,icon:"search"},"查询"),r.a.createElement(S.a,{type:"default",loading:P,onClick:function(){E(""),k(!0),f({}).finally(function(){k(!1)})}},"重置")),2===m&&r.a.createElement(T.a,{multiple:!0,inputkey:"param",list:[F,Q],searchedData:function(e){return f(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?L(a,!0).forEach(function(t){x(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):L(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},e))},onRef:function(e){_=e}})),r.a.createElement(I.a,{rowKey:1===m?"productId":"deviceId",rowSelection:V,columns:s,dataSource:R,pagination:{total:A.totalRows,current:A.pageIndex,defaultCurrent:1,defaultPageSize:10,onChange:function(e){M(e)},showQuickJumper:!0,hideOnSinglePage:!0,showTotal:function(e){return r.a.createElement("span",null,"共 ",r.a.createElement("a",null,e)," 条")}}}))}a("ls82");var A=a("54Vy");a("vQck");function F(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function Q(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?F(a,!0).forEach(function(t){_(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):F(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function _(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function M(e,t,a,n,r,c,o){try{var l=e[c](o),i=l.value}catch(e){return void a(e)}l.done?t(i):Promise.resolve(i).then(n,r)}function V(e){return function(){var t=this,a=arguments;return new Promise(function(n,r){var c=e.apply(t,a);function o(e){M(c,n,r,o,l,"next",e)}function l(e){M(c,n,r,o,l,"throw",e)}o(void 0)})}}function q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var K=10,B=["发布","发布","停止","启动","",""];function G(e){var t=e.projectId,a=q(Object(n.useState)(!1),2),c=a[0],l=a[1],u=q(Object(n.useState)({callExplainVisible:!1,paramList:[],url:[]}),2),s=u[0],d=u[1],b=q(Object(n.useState)(""),2),y=b[0],g=b[1],h=q(Object(n.useState)([]),2),E=h[0],O=h[1],j=q(Object(n.useState)({totalRows:0,pageIndex:1}),2),w=j[0],P=j[1],k=q(Object(n.useState)([]),2),T=k[0],L=k[1],x=q(Object(n.useState)({actionType:0,actionRecord:{},actionLoading:!1}),2),D=x[0],R=x[1],F=q(Object(n.useState)({dataAnlVisibel:!1,dataAnlRecord:null}),2),_=F[0],M=F[1],G=q(Object(n.useState)(-1),2),J=G[0],U=G[1],H=q(Object(n.useState)({id:-1,neme:"",desc:""}),2),W=H[0],z=H[1],Z=w.totalRows,X=w.pageIndex,Y=s.callExplainVisible,$=s.paramList,ee=s.url,te=D.actionType,ae=D.actionRecord,ne=D.actionLoading,re=_.dataAnlVisibel,ce=_.dataAnlRecord;Object(n.useEffect)(function(){oe(1)},[oe,t]);var oe=function(e){var a={pageRows:10};t&&(a.projectId=t),e&&(a.pageIndex=e),y&&(a.name=y),Object(p.c)(p.a.getServeList,a,{loading:!0}).then(function(e){var t=e&&e.data||{},a=t.list,n=t.pager;O(a),P(n)})},le=function(){var e=V(regeneratorRuntime.mark(function e(){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=5;break}return e.next=3,Object(p.c)(p.a.getProjectList,{},{loading:!0});case 3:a=e.sent,L(a.data||[]);case 5:l(!0);case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),ie=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Object(p.d)(p.a.servePublish,Q({serviceId:e,envType:t,operate:a},n),{timeout:3e5}).then(function(e){oe(X)}).finally(me)},ue=function(){var e=V(regeneratorRuntime.mark(function e(t,a){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:R(function(e){return Q({},e,{actionType:t,actionRecord:Q({},a)})});case 1:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),se=function(){R(function(e){return Q({},e,{actionLoading:!0})});var e=ae.id;3==te?function(e){Object(p.d)(p.a.serveDelete,{id:e}).then(function(){oe(),Object(N.a)({type:"success",description:"删除成功！"})}).finally(me)}(e):ie(e,1==te?1:0,2)},de=function(e){R(function(e){return Q({},e,{actionLoading:!0})});var t=ae.id,a=ae.proEnv,n=1,r=ae.testEnv;2==te&&(n=0,r=a),ie(t,n,r,e)},me=function(){R({actionType:0,actionRecord:{},actionLoading:!1})},pe=function(e,t){var a=t||ce||{},n=a.id,r=a.projectId,c=a.desc,o=a.name;Object(v.n)("/dataAnalysis/".concat(r,"/").concat(n),"desc=".concat(c,"&name=").concat(o,"&analysisiType=").concat(e)),M(function(e){return Q({},e,{dataAnlVisibel:!1})})},fe=function(e){var t=e.id,a=e.type,n=void 0===a?0:a,c=e.projectId;return 0==+n?r.a.createElement("a",{onClick:function(){return Object(v.n)("/logicDevelop/".concat(c,"/").concat(t))}},"编辑"):r.a.createElement("a",{onClick:function(){return function(e){var t=e.id;Object(p.c)(p.a.getDataAnlzType,{serveId:t}).then(function(t){var a=(t&&t.data||{}).funcType;a?pe(a,e):M(function(t){return Q({},t,{dataAnlVisibel:!0,dataAnlRecord:e})})})}(e)}},"编辑")},ve=[{title:"服务名称",dataIndex:"name",key:"name",width:160,render:function(e,t){var a=t.id,n=t.desc;return r.a.createElement("a",{onClick:function(){return z({id:a,name:e,desc:n})}},e)}},{title:"服务类型",dataIndex:"type",key:"type",width:160,render:function(e,t){var a=t.type,n=void 0===a?0:a;return r.a.createElement("span",null,["业务逻辑服务","数据分析服务"][n])}},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:160,render:function(e,t){var a=t.createTime;return r.a.createElement("span",null,a?v.a.utcToDev(a):"--")}},{title:"操作",key:"action",width:500,render:function(e,t){var a=t.id,n=t.type,c=void 0===n?0:n,o=t.testEnv,l=t.proEnv,i=t.projectId,u=t.name,s=5==o?"重新发布新版本到测试环境":"".concat(B[o],"测试环境"),m=5==l?"重新部署新版本到生产环境":"".concat(B[l],"生产环境");return r.a.createElement("span",null,2===l&&r.a.createElement(r.a.Fragment,null,r.a.createElement(f.b,{to:{pathname:"/open/developCenter/serveDetail/".concat(a),search:"?serveName=".concat(u,"&projectId=").concat(i,"&type=").concat(c)},target:"_black"},"查看"),r.a.createElement(C.a,{type:"vertical"})),fe(t),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{disabled:0===o,onClick:function(){return ue(1,t)}},s),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{disabled:!1,onClick:function(){return function(e){Object(p.c)(p.a.serveCallExplain,{serviceId:e},{loading:!0}).then(function(e){var t=[],a="";if(e.data){if(e.data.input){var n=JSON.parse(e.data.input);n.input&&(t=n.input)}e.data.flowVersion&&(a=e.data.flowVersion.invokeUrl||"")}d({paramList:t,url:a,callExplainVisible:!0})})}(a)}},"调用说明"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{disabled:0===l,onClick:function(){return ue(2,t)}},m),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){return U(a)}},"复制"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){return ue(3,t)}},"删除"))}}];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"tab-content-wrapper"},r.a.createElement("div",{className:"tools"},r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",onClick:le,icon:"plus"},"新建服务")),r.a.createElement("span",{className:"tool-item"},r.a.createElement(i.a,{placeholder:"请输入服务名称查询",style:{width:"240px"},value:y,onChange:function(e){return g(e.target.value)},maxLength:20})),r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",icon:"search",onClick:function(){return oe(1)}},"查询")))),r.a.createElement("div",{className:"table-wrapper"},r.a.createElement(I.a,{columns:ve,rowKey:"id",dataSource:E,pagination:{total:Z,current:X,defaultCurrent:1,defaultPageSize:K,onChange:function(e){return oe(e)},showQuickJumper:!0,hideOnSinglePage:!0,showTotal:function(e){return r.a.createElement("span",null,"共 ",r.a.createElement("a",null,e)," 条")}}})),c&&r.a.createElement(A.a,{visible:c,onOk:function(e){Object(p.d)(p.a.serveAdd,Q({},e),{loading:!0}).then(function(){g(""),l(!1),oe(1),Object(N.a)({type:"success",description:"新增成功！"})})},projectId:t,projectList:T,onCancel:function(){return l(!1)}}),J&&r.a.createElement(A.c,{visible:-1!==J||-1!==W.id,editContent:W,onOk:function(e){-1!==J?Object(p.d)(p.a.serveCopy,Q({},e,{id:J}),{loading:!0}).then(function(){g(""),U(-1),oe(1)}):-1!==W.id&&Object(p.d)(p.a.updateServe,Q({},e,{id:W.id}),{loading:!0}).then(function(){z({id:-1,name:"",desc:""}),oe(X)})},onCancel:function(){-1!==J?U(-1):-1!==W.id&&z({id:-1,name:"",desc:""})}}),function(){var e=ae.id,t=ae.name,a=ae.proEnv,n=ae.testEnv,c=3==te,o=1==te,l=2==te,i=2==n,u=2==a;return r.a.createElement(r.a.Fragment,null,r.a.createElement(m.a,{visible:c||o&&i||l&&u,modalOKHandle:se,modalCancelHandle:me,targetName:t,confirmLoading:ne,title:c?"删除服务":"停止服务",needWarnIcon:!0,descText:"即将".concat(["在测试环境停止","在生产环境停止","删除服务"][te-1])}),r.a.createElement(A.d,{visible:o&&!i||l&&!u,envdata:{id:e,actionType:te,testEnv:n,proEnv:a,name:t},onOk:de,confirmLoading:ne,onCancel:me}))}(),Y&&r.a.createElement(A.b,{paramList:$,url:ee,visible:Y,onCancel:function(){return d({callExplainVisible:!1,paramList:[]})}}),re&&r.a.createElement(o.a,{visible:re,className:"sql-modal-self-class",width:500,title:"选择数据分析类型",closable:!0,centered:!0,footer:null,onCancel:function(){return M({dataAnlVisibel:!1,dataAnlRecord:null})},destroyOnClose:!0,maskClosable:!1},r.a.createElement("div",{className:"type-select"},r.a.createElement("span",{onClick:function(){return pe(1)}},"节点实时流任务"),r.a.createElement("span",{onClick:function(){return pe(3)}},"数据分析任务"),r.a.createElement("span",{onClick:function(){return pe(4)}},"SQL实时流任务"))))}function J(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function U(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?J(a,!0).forEach(function(t){H(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):J(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function H(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function W(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var z=k.a.TabPane,Z=P.a.Option,X=[p.a.getProductInProject,p.a.getDeviceInProject],Y=20;function $(e){var t=e.match,a=e.history,c=W(Object(n.useState)(1),2),o=c[0],l=c[1],s=W(Object(n.useState)([]),2),b=s[0],y=s[1],g=W(Object(n.useState)({totalRows:0,pageIndex:1}),2),h=g[0],E=g[1],O=W(Object(n.useState)([]),2),j=O[0],w=O[1],T=W(Object(n.useState)({totalRows:0,pageIndex:1}),2),L=T[0],x=T[1],D=W(Object(n.useState)([]),2),A=D[0],F=D[1],Q=W(Object(n.useState)({name:"",mac:"",productId:""}),2),_=Q[0],M=Q[1],V=W(Object(n.useState)({relaVisible:!1,name:"",mac:"",productId:"",list:[],pager:{},relatedDeviceList:[],relatedProductList:[],deviceGroupList:[],_selectedRowKeys:[]}),2),q=V[0],K=V[1],B=W(Object(n.useState)(!1),2),J=B[0],$=B[1],ee=W(Object(n.useState)({actionVisibel:!1,actionType:"1",actionRecord:{},actionLoading:!1}),2),te=ee[0],ae=ee[1],ne=t.params&&t.params.id,re=decodeURI(Object(v.j)("name")),ce=q.relaVisible,oe=q._selectedRowKeys,le=te.actionVisibel,ie=te.actionType,ue=te.actionRecord,se=te.actionLoading,de=Object(n.useCallback)(function(e,t,a){var n=_.name,r=_.mac,c=_.productId,o={projectId:ne};t&&(o.pageIndex=t),1==e&&(o.name=n),2==e&&(o=U({},o,{mac:r,productId:a||c})),Object(p.c)(X[e-1],o,{loading:!0}).then(function(t){var a=t&&t.data||{},n=a.list,r=void 0===n?[]:n,c=a.pager,o=void 0===c?{}:c;1===e?y(r):w(r),1===e?E(o):x(o)})},[ne,_]),me=Object(n.useCallback)(function(e){var t=1===o?"productId":"deviceId",a=1===o?p.a.unrelaProduct:p.a.unrelaDevice;ae(function(e){return U({},e,{actionLoading:!0})}),Object(p.c)(a,H({projectId:ne},t,e)).then(function(){de(o)}).finally(function(){ae({actionVisibel:!1,actionRecord:null,actionLoading:!1})})},[ne,de,o]),pe=Object(n.useCallback)(function(){return Object(p.c)(p.a.getAllRelatedProduct,{projectId:ne,pageRows:9999}).then(function(e){return e&&e.data&&e.data.list||[]})},[ne]),fe=Object(n.useCallback)(function(){return Object(p.c)(p.a.getGroupList,{pageRows:9999}).then(function(e){return e.data.list||[]})}),ve=Object(n.useCallback)(function(e){l(2),M(function(t){return U({},t,{productId:e})}),pe().then(function(e){F(e)}),de(2,void 0,e)},[pe,de]),be=Object(n.useMemo)(function(){switch(o){case 1:return[{title:"产品ID",dataIndex:"productId",key:"productId",width:200},{title:"产品名称",dataIndex:"productName",key:"productName",width:200},{title:"产品类型",dataIndex:"productClassId",key:"productClassId",width:180,render:function(e,t){var a=t.productClassId,n=void 0===a?0:a;return r.a.createElement("span",null,["普通设备","网关设备"][n])}},{title:"状态",dataIndex:"mode",key:"mode",width:180,render:function(e,t){var a=t.mode,n=void 0===a?0:a;return r.a.createElement("span",null,["开发中","已发布","审核中"][n])}},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:180,render:function(e,t){var a=t.createTime;return r.a.createElement("span",null,a?v.a.utcToDev(a):"--")}},{title:"操作",key:"action",width:200,render:function(e,t){var a=t.productId,n=t.mode;return r.a.createElement("span",null,r.a.createElement(f.b,{to:{pathname:"/open/base/product/".concat(1==n?"details":"edit","/").concat(a)}},"查看"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){return ve(a)}},"设备管理"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){return we("1",t)}},"解除关联"))}}];case 2:return[{title:"设备ID",dataIndex:"deviceUniqueId",key:"deviceUniqueId",width:200},{title:"物理地址",dataIndex:"deviceMac",key:"deviceMac",width:200},{title:"产品",dataIndex:"productName",key:"productName",width:180},{title:"分类",dataIndex:"productClass",key:"productClass",width:180,render:function(e,t){var a=t.productClass,n=void 0===a?0:a;return r.a.createElement("span",null,["普通设备","网关设备"][n])}},{title:"状态",dataIndex:"status",key:"status",width:180,render:function(e,t){var a=t.status;return r.a.createElement("span",null,["开发中","已发布","审核中"][a||0])}},{title:"最后上线",dataIndex:"lastOnlineTime",key:"lastOnlineTime",width:180,render:function(e,t){var a=t.lastOnlineTime;return r.a.createElement("span",null,a?v.a.utcToDev(a):"--")}},{title:"操作",key:"action",width:200,render:function(e,t){var a=t.deviceId;return r.a.createElement("span",null,r.a.createElement(f.b,{to:{pathname:"/open/base/device/onlineDevice/details/".concat(a)}},"查看"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){return we("1",t)}},"解除绑定"))}}]}},[o,ve]),ye=function(e,t){M(function(a){var n=U({},a);return n[e]=t,n})};Object(n.useEffect)(function(){ne?(de(1),de(2),pe().then(function(e){F(e)})):Object(N.a)({description:"请传入项目ID"})},[ne]);var ge=function(e){var t=_.name,n=_.mac,c=_.productId;return 1===e?r.a.createElement("div",{className:"tools"},r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",loading:J,icon:"plus",onClick:Oe},"关联产品")),r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"default",name:t,onClick:function(){return a.push({pathname:"/open/base/product/add",search:"projectId=".concat(ne)})},icon:"plus"},"创建产品")),r.a.createElement("span",{className:"tool-item"},r.a.createElement(i.a,{placeholder:"请输入产品查询名称",onChange:function(e){return ye("name",e.target.value)},style:{width:"240px"},maxLength:20})),r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",onClick:function(){return de(1)},icon:"search"},"查询"))):2===e?r.a.createElement("div",{className:"tools"},r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",loading:J,onClick:Oe,icon:"plus"},"关联设备")),r.a.createElement("span",{className:"tool-item"},r.a.createElement(i.a,{placeholder:"请输入设备物理地址/设备ID",mac:n,onChange:function(e){return ye("mac",e.target.value)},style:{width:"240px"},maxLength:50})),r.a.createElement("span",{className:"tool-item"},r.a.createElement(P.a,{style:{width:"240px"},value:c,onChange:function(e){return ye("productId",e)}},r.a.createElement(Z,{value:""},"全部产品"),A.map(function(e){var t=e.productId,a=e.productName;return r.a.createElement(Z,{key:t,value:t},a)}))),r.a.createElement("span",{className:"tool-item"},r.a.createElement(S.a,{type:"primary",icon:"search",onClick:function(){return de(2)}},"查询"))):void 0},he=function(){var e=1===o?h:L,t=e.totalRows,a=e.pageIndex,n=1===o?b:j;return r.a.createElement(I.a,{columns:be,rowKey:1===o?"productId":"deviceId",dataSource:n,pagination:{total:t,current:a,defaultCurrent:1,defaultPageSize:Y,onChange:function(e){return de(o,e)},showQuickJumper:!0,hideOnSinglePage:!0,showTotal:function(e){return r.a.createElement("span",null,"共 ",r.a.createElement("a",null,e)," 条")}}})},Ee=function(e){var t=e.name,a=e.param,n=e.productIds,r=e._index,c=e.type,l={projectId:ne,pageRows:10,pageIndex:r||1},i=p.a.getRelaProduct;return 1===o?t&&(l.name=t):2===o&&(i=p.a.getRelaDevice,l.type=c||0,a&&(l.param=a),n&&(l.productIds=n)),Object(p.c)(i,l).then(function(e){return e&&e.data&&K(function(t){return U({},t,{},e.data)}),e})},Oe=function(){var e=[Ee({})];2===o&&e.push(pe(),fe()),$(!0),Promise.all(e).then(function(e){var t=W(e,3),a=(t[0],t[1]),n=void 0===a?[]:a,r=t[2],c=void 0===r?[]:r;K(function(e){return U({},e,{relaVisible:!0,relatedProductList:n,deviceGroupList:c})})}).finally(function(){$(!1)})},je=function(){K({relaVisible:!1,name:"",mac:"",productId:"",list:[],pager:{}})},we=function(e,t){ae(function(a){return U({},a,{actionType:e,actionRecord:U({},t),actionVisibel:!0})})};return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{title:re||"--"}),r.a.createElement(d.a,{style:{minHeight:"calc(100% - 102px)"}},r.a.createElement(k.a,{activeKey:""+o,onChange:function(e){return l(+e)}},r.a.createElement(z,{tab:"产品列表",key:1},r.a.createElement("div",{className:"tab-content-wrapper"},ge(1)),r.a.createElement("div",{className:"table-wrapper"},he())),r.a.createElement(z,{tab:"设备列表",key:2},r.a.createElement("div",{className:"tab-content-wrapper"},ge(2)),r.a.createElement("div",{className:"table-wrapper"},he())),r.a.createElement(z,{tab:"服务列表",key:3},r.a.createElement(G,{projectId:ne})))),ce&&r.a.createElement(R,{visible:ce,getRelaList:Ee,onOkHandle:function(e){var t,a;(t=e.join(","),a=1===o?p.a.relaProduct:p.a.relaDevice,Object(p.d)(a,{projectId:ne,ids:t})).then(function(e){je(),de(o)})},onCancelHandle:je,columns:be.slice(0,-1),type:o,dataInRela:q,setDataInRela:K,_selectedRowKeys:oe}),le&&r.a.createElement(m.a,{visible:le,modalOKHandle:function(){var e=ue.deviceId,t=ue.productId;"1"===ie&&(1===o&&me(t),2===o&&me(e))},modalCancelHandle:function(){return ae({actionVisibel:!1,actionRecord:null,actionLoading:!1})},targetName:ue[1===o?"productName":"deviceUniqueId"],confirmLoading:se,title:"解除关联",needWarnIcon:!0,descText:"即将解除关联"}))}a("O0UD");function ee(e){var t=e.match.path;return r.a.createElement(c.e,null,r.a.createElement(c.c,{path:"".concat(t,"/list"),render:function(e){return r.a.createElement(w,e)}}),r.a.createElement(c.c,{path:"".concat(t,"/detail/:id"),render:function(e){return r.a.createElement($,e)}}),r.a.createElement(c.b,{to:"".concat(t,"/list")}))}var te=a("2kug"),ae=[{title:"步骤一"},{title:"步骤二"},{title:"步骤三"}];function ne(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{noback:!0,title:"服务开发"}),r.a.createElement(d.a,null,r.a.createElement("div",{className:"use-service-flow-wrapper"},r.a.createElement(te.a,{type:3,flowLists:ae}),r.a.createElement("div",{className:"extra-descs"},r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"新建服务，填写服务名称和关联项目")),r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"编辑业务逻辑，进行部署调试")),r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"发布服务，生成正式地址，可以对服务进行启动/停止"))))),r.a.createElement(d.a,{style:{minHeight:"calc(100% - 300px)"}},r.a.createElement(G,null)))}a("U8R4");var re,ce,oe=a("+eQT"),le=a("Cr9J"),ie=(a("NBAS"),a("ExoC"),a("/MKj")),ue=a("AcTD"),se=a("vzJ4"),de=a("zrZB"),me=a("gtRY");a("3tak");function pe(e){return(pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ve(e,t){return!t||"object"!==pe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function be(e){return(be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ye(e,t){return(ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ge=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=ve(this,be(t).call(this,e)),e.init(re,ce,!0),a}var a,c,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ye(e,t)}(t,n["Component"]),a=t,(c=[{key:"render",value:function(){return r.a.createElement("div",{className:"draw-wrap"},r.a.createElement(ue.a,null),r.a.createElement(se.a,null),r.a.createElement(de.a,null))}}])&&fe(a.prototype,c),o&&fe(a,o),t}(),he=Object(ie.b)(void 0,function(e){return{init:function(t,a,n){return e(Object(me.z)(t,a,n))}}})(ge),Ee=function(e){return re=e.projectId,ce=e.serviceId,r.a.createElement(he,null)};function Oe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function je(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Oe(a,!0).forEach(function(t){we(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Oe(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function we(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ie(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Se=k.a.TabPane,Ce=P.a.Option;function Pe(){var e=Object(c.h)().id,t=decodeURI(Object(v.j)("serveName")),a=decodeURI(Object(v.j)("projectId")),o=decodeURI(Object(v.j)("type")),l=Ie(Object(n.useState)({searchKey:"",since:null,searchLoading:!1}),2),s=l[0],m=l[1],f=Ie(Object(n.useState)({logList:[],logPager:{}}),2),b=f[0],y=f[1],g=s.searchKey,h=s.since,E=s.searchLoading,O=b.logList,j=(b.logPager,Object(n.useCallback)(function(t){var a={serviceId:e,tail:100,follow:!1};return t&&(a=t),Object(p.c)(p.a.getServiceLog,a).then(function(e){e&&e.data&&y(je({},b,{logList:e.data}))})},[e,b]));Object(n.useEffect)(function(){j()},[e]);var w=function(e,t){m(function(a){return je({},a,{},we({},e,t))})};return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{noback:!0,title:t||"测试"}),r.a.createElement(d.a,{style:{minHeight:"calc(100% - 102px)"}},r.a.createElement(k.a,{defaultActiveKey:"1"},r.a.createElement(Se,{tab:"运行数据",key:1},r.a.createElement("div",null,r.a.createElement(d.a,null,r.a.createElement("div",{className:"all-data-wrapper"},r.a.createElement("div",{className:"data-item"},r.a.createElement("h3",null,"服务总数"),r.a.createElement("p",null,"100")),r.a.createElement("div",{className:"data-item"},r.a.createElement("h3",null,"测试环境"),r.a.createElement("p",null,"49")),r.a.createElement("div",{className:"data-item"},r.a.createElement("h3",null,"正式环境"),r.a.createElement("p",null,"51")))))),r.a.createElement(Se,{tab:"服务日志",key:2},r.a.createElement("div",{className:"serve-log-wrapper"},r.a.createElement("div",{style:{marginBottom:"24px"}},r.a.createElement(P.a,{value:"",style:{width:"240px",marginRight:"12px"}},r.a.createElement(Ce,{value:""},"错误日志")),r.a.createElement(oe.a,{style:{width:"240px",marginRight:"12px"},showTime:!0,showToday:!0,value:h,onChange:function(e){return w("since",e)}}),r.a.createElement(i.a,{placeholder:"请输入关键字",style:{width:"240px",marginRight:"12px"},value:g,onChange:function(e){return w("searchKey",e.target.value)},maxLength:20}),r.a.createElement(S.a,{type:"primary",style:{marginRight:"12px"},onClick:function(){if(h){var e=1e3*(h.unix()-28800);j(e)}else j()},loading:E,icon:"search"},"查询")),r.a.createElement("div",null,r.a.createElement(I.a,{rowKey:"timestamp",columns:[{title:"调用时间",dataIndex:"timestamp",key:"timestamp"},{title:"节点执行日志",dataIndex:"text",key:"text"}],dataSource:O,pagination:!1})))),r.a.createElement(Se,{tab:"服务编排",key:3},r.a.createElement("div",{className:"static-flow-wrapper"},r.a.createElement("div",{className:"relative-wrapper"},1==o?r.a.createElement(le.a,{service:{serviceId:e,projectId:a},isStatic:!0}):r.a.createElement(Ee,{projectId:a,serviceId:e})))))))}a("2DKY");var ke=a("+KLJ"),Ne=a("1Ngb"),Te=a.n(Ne),Le=(a("gSWv"),a("M7r8")),xe=l.a.create({name:"add-dataflow-rule"})(function(e){var t=e.form,a=t.validateFieldsAndScroll,n=t.getFieldValue,c=t.getFieldDecorator,u=t.resetFields,s=e.closeMod,d=e.visable,m=e.transferId,f=void 0===m?void 0:m,v=e.transferName,b=void 0===v?"":v,y=e.transferDesc,g=void 0===y?"":y,h=f?"编辑规则":"新增规则";return r.a.createElement(o.a,{title:h,visible:d,width:600,onOk:function(){a(function(e,t){var a=t.transferName,n=t.transferDesc;e||Object(p.d)(p.a.saveTransfer,{transferName:a,transferDesc:n,transferId:f},{needJson:!0}).then(function(e){s(!0),u()})})},onCancel:function(){s(),u()},maskClosable:!1,className:"self-modal"},r.a.createElement(l.a,{labelCol:{span:4},wrapperCol:{span:20}},r.a.createElement(l.a.Item,{label:"规则名称"},c("transferName",{rules:[{required:!0,message:"请输入规则名称"},{max:50,message:"最大输入长度为50"}],initialValue:b})(r.a.createElement(i.a,{placeholder:"请输入规则名称"}))),r.a.createElement(Le.a,{label:"规则描述",formId:"transferDesc",astrictNub:"50",rows:"4",placeholder:"规则描述",getFieldDecorator:c,getFieldValue:n,initialVal:g})))});function De(e){return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Re(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Ae(e,t){return!t||"object"!==De(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Fe(e){return(Fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Qe(e,t){return(Qe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _e=["创建规则","选择产品","编写SQL，处理数据","添加操作，转发数据","验证规则","启动规则"],Me=[["删除","即将要删除规则"],["启动","即将要启动规则"],["停用","即将要停用规则"]],Ve=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=Ae(this,Fe(t).call(this,e))).getList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.c)(p.a.getDataTransferList,e).then(function(e){a.setState({ruleList:e.data.list,pager:e.data.pager,loading:!1})})},a.openAdd=function(){a.setState({addRuleVisible:!0})},a.closeAdd=function(e){a.setState({addRuleVisible:!1}),e&&a.pagerIndex(1)},a.searchRule=function(e){a.setState({loading:!0,searchName:e},function(){a.pagerIndex(1)})},a.pagerIndex=function(e){a.setState({pageIndex:e,loading:!0},function(){a.getList({pageIndex:e,pageRows:10,transferName:a.state.searchName||void 0})})},a.getGuidStep=function(){for(var e=[],t=0;t<_e.length;t++)e.push(r.a.createElement("div",{className:"step",key:"step_"+t},r.a.createElement("span",{className:"number"},t+1),r.a.createElement("span",{className:"desc"},_e[t]))),t+1<_e.length&&e.push(r.a.createElement("img",{className:"arrow",key:"img_"+t,src:Te.a}));return e},a.openConfirmMod=function(e,t,n){a.setState({id:e,name:t,confirmType:n})},a.modOk=function(){var e=a.state,t=e.id,n=e.confirmType,r=e.pageIndex,c=void 0===r?1:r,o=e.ruleList;if(1==n)Object(p.c)(p.a.delOneTransfer,{transferId:t},{loading:!0}).then(function(e){1==o.length&&c>1&&--c,a.pagerIndex(c),a.setState({confirmType:0})});else{var l=2==n?1:0;Object(p.d)(p.a.saveTransfer,{transferId:t,status:l},{needJson:!0,noInstance:!0,loading:!0}).then(function(e){a.pagerIndex(c),a.setState({confirmType:0})})}},a.modCancel=function(){a.setState({confirmType:0})},a.state={loading:!0,ruleList:[],pager:{},searchName:"",name:"",id:"",confirmType:0,addRuleVisible:!1,pageIndex:1},a.columns=[{title:"规则名称",dataIndex:"transferName"},{title:"规则ID",dataIndex:"transferId",width:90},{title:"描述",dataIndex:"transferDesc"},{title:"创建时间",dataIndex:"createTime",width:162,render:function(e){return r.a.createElement("span",null,v.a.utcToDev(e))}},{title:"状态",dataIndex:"status",width:90,render:function(e){return r.a.createElement("span",null,{0:"未启用",1:"启用"}[e]||"--")}},{title:"操作",key:"action",width:160,render:function(e,t){var n=t.transferId,c=t.transferName,o=t.status;return r.a.createElement("span",null,r.a.createElement(f.b,{to:"/open/developCenter/dataFlow/ruledetail/".concat(n)},"查看"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){a.openConfirmMod(n,c,o+2)}},["启用","停用"][o]),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){a.openConfirmMod(n,c,1)}},"删除"))}}],a}var a,c,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qe(e,t)}(t,n["Component"]),a=t,(c=[{key:"componentDidMount",value:function(){this.pagerIndex(1)}},{key:"render",value:function(){var e=this,t=this.state,a=t.loading,n=t.name,c=t.addRuleVisible,o=t.ruleList,l=t.pager,s=t.confirmType;return r.a.createElement("div",{className:"dataflow-page"},r.a.createElement(u.a,{noback:!0,title:"数据流转"}),r.a.createElement("header",{className:"page-content-header"},r.a.createElement("div",{className:"searchBox"},r.a.createElement(i.a.Search,{placeholder:"请输入规则名查找",enterButton:!0,maxLength:20,onSearch:function(t){return e.searchRule(t)}})),r.a.createElement("div",{className:"butFloatRight"},r.a.createElement(S.a,{className:"but-add",type:"primary",icon:"plus",onClick:this.openAdd},"创建规则"))),r.a.createElement("div",{className:"commonContentBox"},r.a.createElement("div",{className:"centent"},r.a.createElement(ke.a,{message:"数据流转规则可以对设备上报的数据进行简单处理，并将处理后的数据流转到其他Topic或其他存储实例，目前只支持Json数据的处理",type:"info",showIcon:!0}),r.a.createElement("div",{className:"guid-step"},this.getGuidStep()))),r.a.createElement("div",{className:"commonContentBox"},r.a.createElement("div",{className:"centent"},r.a.createElement(I.a,{rowKey:"transferId",columns:this.columns,dataSource:o,pagination:{defaultCurrent:l.pageIndex,total:l.totalRows,hideOnSinglePage:!1,onChange:this.pagerIndex,current:l.pageIndex},loading:a}))),r.a.createElement(xe,{visable:c,closeMod:function(t){e.closeAdd(t)}}),r.a.createElement(m.a,{visible:s>0,modalOKHandle:this.modOk,modalCancelHandle:this.modCancel,title:s>0&&Me[s-1][0],descText:s>0&&Me[s-1][1],targetName:n}))}}])&&Re(a.prototype,c),o&&Re(a,o),t}(),qe=(a("pjDv"),a("JfAA"),a("vAZS"),a("ECub")),Ke=(a("OrB1"),a("gFTJ")),Be=(a("k994"),a("NJEC")),Ge=(a("x0AG"),a("pDQq"),a("fPXa"));function Je(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function Ue(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Je(a,!0).forEach(function(t){He(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Je(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function He(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function We(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ze(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Ze=P.a.Option,Xe=l.a.create({name:"add-dataflow-editsql"})(Object(n.memo)(function(e){var t=e.form,a=t.validateFieldsAndScroll,c=t.getFieldValue,u=t.getFieldDecorator,s=t.resetFields,d=(t.validateFields,t.setFieldsValue),m=e.visable,f=e.tableData,v=e.productList,b=e.closeMod,y=e.transferId,g=e.transferSQL,h=g.transferSQL,E=void 0===h?"SELECT \n\nFROM \n\nWHERE":h,O=g.productId,j=g.deviceIdList,w=g.isAllDevice,I=void 0===w?0:w,S=g.transferSQLId,C=ze(Object(n.useState)(E),2),k=C[0],N=C[1],T=ze(Object(n.useState)([]),2),L=T[0],x=T[1],D=ze(Object(n.useState)([]),2),R=D[0],A=D[1];Object(n.useEffect)(function(){var e=F();(x(e),S)&&d({transferSQL:E,productId:O,deviceIdList:0==I&&[-1]||j})},[f]);var F=function(){var e=[];return Object.keys(f||{}).forEach(function(t){e.push(Q(t,"数据表")),f[t].forEach(function(t){e.push(Q(t,"表属性"))})}),e.length>0&&e||null},Q=function(e,t){return{name:"name",value:e,score:100,meta:t}},_=function(e,t){var a=e.findIndex(function(e){return t==e}),n=We(e);return a>-1&&n.splice(a,1),n};return r.a.createElement(o.a,{title:"编写SQL",visible:m,width:700,onOk:function(){a(function(e,t){if(console.log(999,t),!e){var a=t.deviceIdList,n=1;-1==a[0]&&(n=0,a=null);var r=S&&{transferSQLId:S}||{};Object(p.d)(p.a.saveTransfer,{transferId:y,transferSQL:Ue({},t,{isAllDevice:n},r,{deviceIdList:a})},{needJson:!0,noInstance:!0}).then(function(e){b(!0),s()})}})},onCancel:function(){b(),s()},maskClosable:!1},r.a.createElement(l.a,null,r.a.createElement(l.a.Item,{labelCol:{span:3},wrapperCol:{span:21}},r.a.createElement(Ge.a,{mode:"mysql",height:200,code:k,completers:L,onChange:function(e){!function(e){N(e),d({transferSQL:e})}(e)}}),u("transferSQL",{initialValue:k,rules:[{required:!0,message:"请编写SQL"}]})(r.a.createElement(i.a,{type:"hidden"}))),r.a.createElement(l.a.Item,{label:"选择产品",labelCol:{span:3},wrapperCol:{span:12}},u("productId",{rules:[{required:!0,message:"请选择产品"}]})(r.a.createElement(P.a,{showSearch:!0,placeholder:"选择产品",optionFilterProp:"children",onChange:function(e){Object(p.c)(p.a.getDeviceList,{classType:1,pageRows:9999,infoType:1,productId:e},{loading:!0}).then(function(e){var t=e.data;A(t&&t.list||[]),d({deviceIdList:[]})})}},v.map(function(e){var t=e.productId,a=e.productName;return r.a.createElement(Ze,{key:t,value:t},a)})))),r.a.createElement(l.a.Item,{label:"选择设备",labelCol:{span:3},wrapperCol:{span:12}},u("deviceIdList",{rules:[{required:!0,message:"请选择设备"}]})(r.a.createElement(P.a,{showSearch:!0,mode:"multiple",placeholder:"选择设备",optionFilterProp:"children",onSelect:function(e){if(-1==e)d({deviceIdList:[-1]});else{var t=c("deviceIdList"),a=_(t,-1);console.log(888,t,a),d({deviceIdList:We(a)})}}},R.length>0&&r.a.createElement(Ze,{value:-1},"全部设备"),R.map(function(e){var t=e.deviceId,a=e.deviceMac;return r.a.createElement(Ze,{key:t,value:t},a)}))))))})),Ye=(a("Re5i"),a("/wGt")),$e=(a("Aosp"),a("diRs")),et=(a("2oDE"),a("CtXQ")),tt=a("OIuG");function at(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function nt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var rt=P.a.Option,ct=l.a.create({name:"add-dataflow-checksql"})(Object(n.memo)(function(e){var t=e.transferId,a=e.form,c=a.validateFieldsAndScroll,o=a.getFieldValue,u=a.getFieldDecorator,s=a.resetFields,d=a.setFieldsValue,m=e.visable,f=e.productList,v=e.closeMod,b=nt(Object(n.useState)("{\n\n}"),2),y=b[0],g=b[1],h=nt(Object(n.useState)([]),2),E=h[0],O=h[1],j=nt(Object(n.useState)(void 0),2),w=j[0],I=j[1];Object(n.useEffect)(function(){},[]);var C=function(e,t){var a=e.findIndex(function(e){return t==e}),n=at(e);return a>-1&&n.splice(a,1),n};return r.a.createElement(Ye.a,{title:"SQL调试",visible:m,width:480,onClose:function(){v(),s()}},r.a.createElement(l.a,null,r.a.createElement(l.a.Item,{label:"产品",labelCol:{span:24},wrapperCol:{span:12}},u("productId",{rules:[{required:!0,message:"请选择产品"}]})(r.a.createElement(P.a,{showSearch:!0,placeholder:"选择产品",optionFilterProp:"children",onChange:function(e){Object(p.c)(p.a.getDeviceList,{classType:1,pageRows:9999,infoType:1,productId:e},{loading:!0}).then(function(e){var t=e.data;O(t&&t.list||[]),d({deviceIdList:[]})})}},f.map(function(e){var t=e.productId,a=e.productName;return r.a.createElement(rt,{key:t,value:t},a)})))),r.a.createElement(l.a.Item,{label:"设备",labelCol:{span:24},wrapperCol:{span:12}},u("deviceIdList",{rules:[{required:!0,message:"请选择设备"}]})(r.a.createElement(P.a,{showSearch:!0,mode:"multiple",placeholder:"选择设备",optionFilterProp:"children",onSelect:function(e){if(-1==e)d({deviceIdList:[-1]});else{var t=o("deviceIdList"),a=C(t,-1);console.log(888,t,a),d({deviceIdList:at(a)})}}},E.length>0&&r.a.createElement(rt,{value:-1},"全部设备"),E.map(function(e){var t=e.deviceId,a=e.deviceMac;return r.a.createElement(rt,{key:t,value:t},a)})))),r.a.createElement(l.a.Item,{label:r.a.createElement($e.a,{content:"设备使用自定义 Topic 时 Payload 数据格式即为上报的数据",overlayClassName:"draw-popover"},"Payload数据 ",r.a.createElement(et.a,{type:"question-circle"})),labelCol:{span:24},wrapperCol:{span:24}},r.a.createElement(Ge.a,{mode:"json",height:200,code:y,onChange:function(e){!function(e){g(e),d({payload:e})}(e)}}),u("payload",{initialValue:y,rules:[{required:!0,message:"请编写Payload数据"}]})(r.a.createElement(i.a,{type:"hidden"})))),r.a.createElement(S.a,{className:"",type:"primary",onClick:function(){c(function(e,a){if(console.log(999,a),!e){var n=a.deviceIdList,r=a.productId,c=a.payload;try{c=JSON.parse(c)}catch(e){return console.log("eeeeee",e),void Object(N.a)({description:"Payload数据请输入正确的json格式"})}var o=-1==n[0]?0:1,l={transferSQL:{transferId:t,productId:r,isAllDevice:o,deviceIdList:n},payload:c};I(void 0),Object(p.d)(p.a.checkSqlTransfer,l,{needJson:!0,noInstance:!0}).then(function(e){I(e.data)})}})}},"调 试"),w&&r.a.createElement(tt.a,{keyName:"调试结果",data:w}))}));function ot(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function lt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ot(a,!0).forEach(function(t){it(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ot(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function it(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function ut(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var st=P.a.Option,dt=l.a.create({name:"add-dataflow-addsend"})(Object(n.memo)(function(e){var t,a,c,u,s,d=e.operateList,m=e.transferId,f=e.form,v=f.validateFieldsAndScroll,b=(f.getFieldValue,f.getFieldDecorator),y=f.resetFields,g=(f.validateFields,f.setFieldsValue),h=e.operateType,E=e.transferTargetIndex,O=e.closeMod,j=e.transferTargetList,w=e.transferRecover,I=e.topicList,S=(t=1,a=Object(n.useRef)(),c=ut(Object(n.useState)(t),2),u=c[0],s=c[1],Object(n.useEffect)(function(){a.current&&a.current(u)},[u]),[u,function(e,t){a.current=t,s(e)}]),C=ut(S,2),k=C[0],N=C[1];Object(n.useEffect)(function(){if(2==h||4==h){var e,t;if(2==h){var a=j[E];e=a.targetType,t=a.targetConfig}else t=w.recoverConfig,e=w.recoverType;var n=JSON.parse(t),r=n.transferId,c=n.topic,o=n.tag,l={optype:e,destination:c||r};1==e&&(l.tag=o),N(e),g(l)}},[h]);return r.a.createElement(o.a,{title:h%2==0?"编辑":"添加",visible:h>0,width:600,onOk:function(){v(function(e,t){if(!e){var a=t.optype,n=t.destination,r=t.tag,c=0==a?{transferId:n}:{topic:n,tag:r},o=JSON.stringify(c),l={transferId:m};if(h>2)l.transferRecover=lt({},w,{recoverType:a,recoverConfig:o});else if(1==h)l.transferTargetList=[{targetType:a,targetConfig:o}];else{var i=lt({},j[E],{targetType:a,targetConfig:o});l.transferTargetList=[i]}Object(p.d)(p.a.saveTransfer,l,{needJson:!0,noInstance:!0,loading:!0}).then(function(e){O(!0),y()})}})},onCancel:function(){O(),y()},maskClosable:!1},r.a.createElement(l.a,{labelCol:{span:6},wrapperCol:{span:16}},r.a.createElement(l.a.Item,{label:"选择操作"},b("optype",{rules:[{required:!0,message:"请选择操作"}],initialValue:1})(r.a.createElement(P.a,{placeholder:"选择操作",onChange:function(e){N(e),g({destination:void 0})}},d.map(function(e,t){return r.a.createElement(st,{disabled:1!=t,key:t,value:t},e)})))),0==k&&r.a.createElement(l.a.Item,{label:"数据目的地"},b("destination",{rules:[{required:!0,message:"请选择数据目的地"}]})(r.a.createElement(P.a,{placeholder:"请选择"},I[0].map(function(e){var t=e.transferId,a=e.transferName;return r.a.createElement(st,{key:t,value:t},a)}))))||r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a.Item,{label:"数据目的地"},b("destination",{rules:[{required:!0,message:"请填写数据目的地"}]})(r.a.createElement(i.a,{placeholder:"自定义或者从平台选择"}))),r.a.createElement("div",{className:"hidselectbox"},r.a.createElement("a",null,"从平台选择"),r.a.createElement(P.a,{className:"hidselect",placeholder:"请选择",onChange:function(e){g({destination:e})}},I[1].map(function(e){return r.a.createElement(st,{key:e,value:e},e)}))),r.a.createElement(l.a.Item,{label:"tag"},b("tag",{rules:[{required:!0,message:"请填写tag"}]})(r.a.createElement(i.a,{placeholder:"输入tag"}))))))}));function mt(e){return(mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ft(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function vt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function bt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function yt(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function gt(e,t){return!t||"object"!==mt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ht(e){return(ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Et(e,t){return(Et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ot=["发布到另一个流转规则","发布到RocketMQ","发布到MQTT","发布到MySQL","发布到Redis"],jt=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=gt(this,ht(t).call(this,e))).openEditServe=function(){a.setState({editvisable:!0})},a.closeEditServe=function(e){a.setState({editvisable:!1}),e&&a.getDetail()},a.getTableInfo=function(){Object(p.c)(p.a.getTransferDataTable).then(function(e){var t=e.data,n=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?vt(a,!0).forEach(function(t){bt(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):vt(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},void 0===t?{}:t);a.setState({tableData:n})})},a.getDetail=function(){Object(p.c)(p.a.getDataTransfer,{transferId:a.id},{loading:!0}).then(function(e){var t=e.data||{},n=t.transferDesc,r=t.transferName,c=t.transferSQL,o=t.transferTargetList,l=t.transferRecover;a.setState({transferName:r,transferDesc:n,transferSQL:c||{},transferTargetList:o||[],transferRecover:l||{}})})},a.openEditSQL=function(){a.setState({editSQLvisiable:!0})},a.openCheckSQL=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a.setState({checkSQLvisiable:e})},a.closeEditSQL=function(e){a.setState({editSQLvisiable:!1}),e&&a.getDetail()},a.openOperate=function(e,t){var n={operateType:e};2==e&&(n.transferTargetIndex=t),a.setState(n);var r=a.state,c=r.transferMenuList,o=r.rocketMQTopicList;0==c.length&&a.getTransferMenuList(),0==o.length&&a.getRocketMQTopicList()},a.closeOperate=function(e){a.setState({operateType:0}),e&&a.getDetail()},a.getProList=function(){Object(p.c)(p.a.getProductList,{pageRows:9999,instanceId:2},{needVersion:1.2}).then(function(e){var t=e.data&&e.data.list||[];a.setState({productList:t})})},a.getTransferMenuList=function(){Object(p.c)(p.a.getTransferMenuList).then(function(e){var t=e.data,n=ft(void 0===t?{}:t);a.setState({transferMenuList:n})})},a.getRocketMQTopicList=function(){Object(p.c)(p.a.getRocketMQTopicList).then(function(e){var t=e.data,n=ft(void 0===t?{}:t);a.setState({rocketMQTopicList:n})})},a.getColumns=function(e){var t=pt(4==e&&["recoverType","recoverConfig","transferRecoverId"]||["targetType","targetConfig","transferTargetId"],3);return[{title:"操作类型",dataIndex:t[0],render:function(e){return Ot[e]}},{title:"数据目的地",dataIndex:t[1]},{title:"操作",dataIndex:t[2],width:120,render:function(t,n,c){return r.a.createElement("span",null,r.a.createElement("a",{onClick:function(){a.openOperate(e,c)}},"编辑"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement(Be.a,{title:"确定要移除吗？",onConfirm:function(){a.deleteTarget(t,e)},okText:"是",cancelText:"否"},r.a.createElement("a",null,"移除")))}}]},a.deleteTarget=function(e,t){var n=4==t&&{transferRecoverId:e}||{transferTargetId:e};Object(p.c)(p.a.delOneTransfer,n,{loading:!0,noInstance:!0}).then(function(e){a.getDetail()})},a.id=e.match.params.id,a.state={transferName:"--",transferDesc:"--",transferSQL:{},transferTargetList:[],transferRecover:{},operateType:0,transferTargetIndex:0,editvisable:!1,editSQLvisiable:!1,checkSQLvisiable:!1,tableData:null,productList:[],transferMenuList:[],rocketMQTopicList:[]},a}var a,c,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Et(e,t)}(t,n["PureComponent"]),a=t,(c=[{key:"componentDidMount",value:function(){this.getDetail(),this.getTableInfo(),this.getProList()}},{key:"render",value:function(){var e=this,t=this.state,a=t.transferDesc,n=t.transferName,c=t.editvisable,o=t.transferSQL,l=t.editSQLvisiable,i=t.checkSQLvisiable,s=t.tableData,m=t.productList,p=t.operateType,f=t.transferTargetIndex,v=t.transferTargetList,b=t.transferRecover,y=t.transferMenuList,g=t.rocketMQTopicList;return r.a.createElement("section",{className:"page-dataflowdetail"},r.a.createElement(u.a,{title:"规则详情"}),r.a.createElement("header",{className:"header"},r.a.createElement(Ke.a,{className:"descriptions",column:2},r.a.createElement(Ke.a.Item,{label:"规则名称"},n),r.a.createElement(Ke.a.Item,{label:"规则 ID"},this.id),r.a.createElement(Ke.a.Item,{label:"规则描述"},a)),r.a.createElement(S.a,{className:"deitbtn",type:"primary",onClick:this.openEditServe},"编辑")),r.a.createElement(d.a,{title:"处理数据"},r.a.createElement("div",{className:"alone-section-content-default"},r.a.createElement(S.a,{className:"addbtn",type:"primary",onClick:this.openEditSQL},"编写 SQL"),r.a.createElement("div",{className:"sqltit"},"规则查询语句:"),o.transferSQL&&r.a.createElement("div",{className:"sqlstr"},o.transferSQL," ",r.a.createElement("a",{onClick:function(){return e.openCheckSQL(!0)}},"调试SQL"))||r.a.createElement(r.a.Fragment,null,r.a.createElement(qe.a,{className:"emptyimg",description:!1,image:qe.a.PRESENTED_IMAGE_SIMPLE}),r.a.createElement("div",{className:"emptysql"},"您还没有编写 SQL 语句处理数据，",r.a.createElement("a",{onClick:this.openEditSQL},"编写 SQL"))))),r.a.createElement(d.a,{title:"转发数据"},r.a.createElement("div",{className:"alone-section-content-default"},r.a.createElement(S.a,{className:"addbtn",type:"primary",onClick:function(){e.openOperate(1)}},"添加操作"),v.length>0&&r.a.createElement(I.a,{rowKey:"transferTargetId",columns:this.getColumns(2),dataSource:v,pagination:!1})||r.a.createElement(r.a.Fragment,null,r.a.createElement(qe.a,{className:"emptyimg",description:!1,image:qe.a.PRESENTED_IMAGE_SIMPLE}),r.a.createElement("div",{className:"emptysql"},"暂无转发数据，",r.a.createElement("a",{onClick:function(){e.openOperate(1)}},"添加操作"))))),r.a.createElement(d.a,{title:"转发错误操作数据"},r.a.createElement("div",{className:"alone-section-content-default"},b.recoverConfig&&r.a.createElement(I.a,{rowKey:"transferRecoverId",columns:this.getColumns(4),dataSource:[b],pagination:!1})||r.a.createElement(r.a.Fragment,null,r.a.createElement(qe.a,{className:"emptyimg",description:!1,image:qe.a.PRESENTED_IMAGE_SIMPLE}),r.a.createElement("div",{className:"emptysql"},"暂无转发错误操作数据，",r.a.createElement("a",{onClick:function(){e.openOperate(3)}},"添加操作"))))),r.a.createElement(xe,{visable:c,transferId:this.id,transferName:n,transferDesc:a,closeMod:function(t){e.closeEditServe(t)}}),l&&r.a.createElement(Xe,{visable:l,transferId:this.id,tableData:s,productList:m,transferSQL:o,closeMod:function(t){e.closeEditSQL(t)}}),i&&r.a.createElement(ct,{visable:i,transferId:this.id,productList:m,closeMod:function(){return e.openCheckSQL(!1)}}),p>0&&r.a.createElement(dt,{operateList:Ot,transferId:this.id,operateType:p,transferTargetIndex:f,topicList:[y,g],transferTargetList:v,transferRecover:b,closeMod:function(t){e.closeOperate(t)}}))}}])&&yt(a.prototype,c),o&&yt(a,o),t}();function wt(e){var t=e.match.path;return r.a.createElement(c.e,null,r.a.createElement(c.c,{path:"".concat(t,"/list"),render:function(e){return r.a.createElement(Ve,e)}}),r.a.createElement(c.c,{path:"".concat(t,"/ruledetail/:id"),render:function(e){return r.a.createElement(jt,e)}}),r.a.createElement(c.b,{to:"".concat(t,"/list")}))}function It(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function St(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ct(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Pt=[{title:"配置数据流转"},{title:"选择监控对象"},{title:"定义监控规则"},{title:"确定监控形式"}],kt={pageRows:10,pageIndex:1},Nt=function(e){var t=Ct(Object(n.useState)({pager:{},list:[]}),2),a=t[0],c=t[1],o=Ct(Object(n.useState)([]),2),l=o[0],s=o[1],f=Ct(Object(n.useState)([]),2),b=f[0],y=f[1];Object(n.useEffect)(function(){g(kt)},[]);var g=function(e){b&&(e.warningId=b),Object(p.c)(p.a.geMonitorList,e,{loading:!0}).then(function(e){c(e.data)})},h=[{title:"规则名称",dataIndex:"name",key:"name"},{title:"描述",dataIndex:"description",key:"description"},{title:"运行状态",dataIndex:"runType",key:"runType",render:function(e){return r.a.createElement("span",null,{0:"初始状态",1:"运行中",2:"已停止"}[e])}},{title:"最近编辑时间",dataIndex:"updateTime",key:"updateTime",render:function(e){return e?v.a.utcToDev(e):"--"}},{title:"操作",dataIndex:"id",key:"id",render:function(e,t){var a=t.id,n=t.name,c=t.runType;return r.a.createElement("span",null,r.a.createElement("a",{href:"#/open/developCenter/deviceMonitor/edit/".concat(a)},"编辑"),r.a.createElement(C.a,{type:"vertical"}),1==c&&r.a.createElement("a",{onClick:function(){s([a,n,"stop"])},href:"javascript:"},"停止")||r.a.createElement("a",{onClick:function(){O(a)},href:"javascript:"},"启动"),r.a.createElement(C.a,{type:"vertical"}),r.a.createElement("a",{onClick:function(){s([a,n,"del"])},href:"javascript:"},"删除"))}}],E=function(e){g(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?It(a,!0).forEach(function(t){St(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):It(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},kt,{pageIndex:e}))},O=function(e){Object(p.c)(p.a.startMonitor,{id:e},{loading:!0}).then(function(e){E(a.pager.pageIndex||1)})},j=a.list,w=a.pager;return r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,{noback:!0,title:"设备监控"}),r.a.createElement(d.a,null,r.a.createElement("div",{className:"use-service-flow-wrapper"},r.a.createElement(te.a,{type:3,flowLists:Pt}),r.a.createElement("div",{className:"extra-descs"},r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"配置数据流转，选择需要进行设备监控的rocketMQ数据对象。")),r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"选择需要进行设备监控配置的对象，包括设备、产品、设备组。")),r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"定义监控对象的具体监控规则，包括参数对比值、时长定义、条件比较等规则。")),r.a.createElement("div",{className:"descs-item"},r.a.createElement("p",null,"在配置好规则前，可自定义具体整体规则的监控形式。"))))),r.a.createElement("div",{className:"commonContentBox"},r.a.createElement("div",{className:"centent"},r.a.createElement(S.a,{href:"#/open/developCenter/deviceMonitor/add",icon:"plus",type:"primary"},"新增配置"),r.a.createElement(i.a,{placeholder:"请输入预警唯一ID查询",style:{width:"240px",margin:"0 24px 24px"},value:b,onChange:function(e){return y(e.target.value)},maxLength:20}),r.a.createElement(S.a,{type:"primary",icon:"search",onClick:function(){return E(1)}},"查询"),r.a.createElement(I.a,{rowKey:"id",columns:h,dataSource:j,pagination:{defaultCurrent:w.pageIndex,total:w.totalRows,onChange:E,current:w.pageIndex,showTotal:function(e){return r.a.createElement("span",null,"共 ",e," 条")}}}))),r.a.createElement(m.a,{visible:l.length>0,modalOKHandle:function(){var e="del"==l[2]&&p.a.deleteMonitor||p.a.stopMonitor;Object(p.c)(e,{id:l[0]},{loading:!0}).then(function(e){E(a.pager.pageIndex||1),s([])})},modalCancelHandle:function(){s([])},title:"del"==l[2]?"删除":"停止",descText:"即将".concat("del"==l[2]?"删除":"停止","监控规则"),needWarnIcon:!0,targetName:l[1]}))},Tt=(a("gySj"),a("DFOY"));function Lt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function xt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}P.a.Option;var Dt={labelCol:{span:4},wrapperCol:{span:14}},Rt=l.a.create({name:"monitor-baseinfo"})(function(e){var t=e.form,a=t.validateFieldsAndScroll,c=t.getFieldValue,o=t.getFieldDecorator,u=(t.resetFields,t.setFieldsValue),s=e.saveBaseInfo,d=e.baseFormData,m=e.transferList;Object(n.useEffect)(function(){var e=d.description,t=d.name,a=d.transferId,n=d.transferTopic,r=d.transferTag;u({description:e,name:t,transferId:a,transferTopic:n,transferTag:r})},[d]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a,Dt,r.a.createElement(l.a.Item,{label:"规则名称"},o("name",{rules:[{required:!0,message:"请输入监控规则名称"},{max:50,message:"最大输入长度为50"}]})(r.a.createElement(i.a,{placeholder:"请输入监控规则名称"}))),r.a.createElement(Le.a,{label:"描述",formId:"description",astrictNub:"100",rows:"3",placeholder:"监控规则描述",getFieldDecorator:o,getFieldValue:c}),r.a.createElement("div",{className:"formitembox"},r.a.createElement(l.a.Item,{label:"数据流转"},o("transferObj",{rules:[{required:!0,message:"请选择数据流转对象"}]})(r.a.createElement(Tt.a,{style:{width:"450px"},options:void m.map(function(e){for(var t=e.transferId,a=e.transferName,n=e.recoverConfigList,r=void 0===n?[]:n,c={},o=0;o<r.length;o++){var l=JSON.parse(r[o]),i=l.topic,u=l.tag;c[i]?c[i].push(u):c[i]=[u]}var s=[];for(var d in c){console.log(c[d]);var m=c[d].map(function(e){return{value:e,label:e}});s.push({value:d,label:d,children:m})}return{value:t,label:a,children:s}}),placeholder:"流转对象 / topic / tag"}))),r.a.createElement("div",{className:"tips"},"没有数据？请先配置",r.a.createElement("a",{href:"#/open/developCenter/dataFlow/list"}," 数据流转")))),r.a.createElement("div",{className:"stepbtnbox"},r.a.createElement(S.a,{className:"btn",type:"primary",onClick:function(){a(function(e,t){var a=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Lt(a,!0).forEach(function(t){xt(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Lt(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},t);s(a)})}},"下一步")))}),At=(a("yXV3"),a("EnZy"),a("K4yd"),a("9yH6")),Ft=a("BkRI"),Qt=a.n(Ft);a("xuDP");function _t(e){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mt(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},c=Object.keys(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}function Vt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function qt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Vt(a,!0).forEach(function(t){Kt(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Vt(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function Kt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Bt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,r=!1,c=void 0;try{for(var o,l=e[Symbol.iterator]();!(n=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw c}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Gt(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Jt(e,t){return!t||"object"!==_t(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ut(e){return(Ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ht(e,t){return(Ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Wt={labelCol:{span:4},wrapperCol:{span:16}},zt=P.a.Option,Zt=(oe.a.RangePicker,[{id:"==",nam:"等于"},{id:">",nam:"大于"},{id:">=",nam:"大于等于"},{id:"<",nam:"小于"},{id:"<=",nam:"小于等于"}]),Xt=[{id:"noDeviceData",nam:"设备无数据告警"},{id:"peak",nam:"设备数据触发阈值告警"},{id:"statistical",nam:"设备时间段内数据汇聚输出"},{id:"threshold",nam:"设备数据持续触发阈值告警"}],Yt={ruleType:"noDeviceData",ruleId:"",stickTime:"",resendIntervalTime:""},$t={info:{productId:"",productName:""},rules:[Qt()(Yt)]},ea={name:"",uniqueId:"",products:[Qt()($t)]},ta=function(e){function t(e){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=Jt(this,Ut(t).call(this,e))).changeParam=function(e,t,n){var r=Qt()(a.state.campusConf),c=Bt(n,3),o=c[0],l=c[1],i=c[2];e.target&&(e=e.target.value),"fields"==t&&(e=e.split(",")),r[o].products[l].rules[i][t]=e,a.setState({campusConf:r})},a.getOneWarForm=function(e,t,n){var c=t.startTime,o=t.endTime,l=t.stickTime,u=t.judgeField,s=t.judgeValue,d=t.judgeType;switch(e){case"noDeviceData":var m=t.resendIntervalTime;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"配置时长"),r.a.createElement(i.a,{className:"timeinput",value:l,onChange:function(e){a.changeParam(e,"stickTime",n)}}),"毫秒无数据，则触发告警"),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"规则重发时间间隔"),r.a.createElement(i.a,{className:"timeinput",value:m,onChange:function(e){a.changeParam(e,"resendIntervalTime",n)}}),"毫秒"));case"peak":return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"配置起止时间"),r.a.createElement(i.a,{onChange:function(e){a.changeParam(e,"startTime",n)},placeholder:"例：08:30:00",className:"hourtime",value:c}),r.a.createElement("span",{className:"rangeline"},"--"),r.a.createElement(i.a,{onChange:function(e){a.changeParam(e,"endTime",n)},placeholder:"例：09:30:00",className:"hourtime",value:o})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"比较的字段和值"),r.a.createElement(i.a,{onChange:function(e){a.changeParam(e,"judgeField",n)},placeholder:"输入比较的字段",className:"kvinput",value:u}),r.a.createElement("span",{className:"rangeline"},":"),r.a.createElement(i.a,{onChange:function(e){a.changeParam(e,"judgeValue",n)},placeholder:"输入字段的值",className:"kvinput",value:s})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"比较方式"),r.a.createElement(P.a,{placeholder:"比较方式",defaultValue:"==",value:d,className:"compareselect",onChange:function(e){a.changeParam(e,"judgeType",n)}},Zt.map(function(e){var t=e.id,a=e.nam;return r.a.createElement(zt,{key:t,value:t},a)})),r.a.createElement("span",{className:"desc"},"备注：与数据流转rocketMQ中数据做对比。")));case"statistical":var p=t.fields;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"配置起止时间"),r.a.createElement(i.a,{value:c,onChange:function(e){a.changeParam(e,"startTime",n)},placeholder:"例：08:30:00",className:"hourtime"}),r.a.createElement("span",{className:"rangeline"},"--"),r.a.createElement(i.a,{value:o,onChange:function(e){a.changeParam(e,"endTime",n)},placeholder:"例：09:30:00",className:"hourtime"})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"需获取的字段"),r.a.createElement(i.a,{value:p&&p.join(",")||"",onChange:function(e){a.changeParam(e,"fields",n)},placeholder:"可输入多个，英文逗号隔开",className:"manykey"})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"desc solo"},"备注：蒋获取的字段k-v值做推送。")));case"threshold":return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"配置起止时间"),r.a.createElement(i.a,{value:c,onChange:function(e){a.changeParam(e,"startTime",n)},placeholder:"例：08:30:00",className:"hourtime"}),r.a.createElement("span",{className:"rangeline"},"--"),r.a.createElement(i.a,{value:o,onChange:function(e){a.changeParam(e,"endTime",n)},placeholder:"例：09:30:00",className:"hourtime"})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"比较的字段和值"),r.a.createElement(i.a,{onChange:function(e){a.changeParam(e,"judgeField",n)},placeholder:"输入比较的字段",className:"kvinput",value:u}),r.a.createElement("span",{className:"rangeline"},":"),r.a.createElement(i.a,{onChange:function(e){a.changeParam(e,"judgeValue",n)},placeholder:"输入字段的值",className:"kvinput",value:s})),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"比较方式"),r.a.createElement(P.a,{onChange:function(e){a.changeParam(e,"judgeType",n)},placeholder:"比较方式",defaultValue:"==",value:d,className:"compareselect"},Zt.map(function(e){var t=e.id,a=e.nam;return r.a.createElement(zt,{key:t,value:t},a)})),r.a.createElement("span",{className:"desc"},"备注：与数据流转rocketMQ中数据做对比。")),r.a.createElement("div",{className:"oneline"},r.a.createElement("span",{className:"label"},"持续时长"),r.a.createElement(i.a,{onChange:function(e){a.changeParam(e,"stickTime",n)},className:"timeinput",value:l}),"毫秒"));default:return null}},a.getRuleFormData=function(){var e=a.state,t=e.connector_type,n=e.connector_topic,r=e.connector_tag,c=e.connector_url,o=e.campusConf,l={connector_type:t};return"rocketmq"==t?(l.connector_topic=n,l.connector_tag=r):l.connector_url=c,{sinkConf:l,campusConf:Qt()(o)}},a.handleSubmit=function(e){var t=a.props,n=t.baseFormData,r=t.ruleId,c=qt({},n,{ruleConf:JSON.stringify(a.getRuleFormData())}),o=p.a.addMonitor;r&&(c.id=r,o=p.a.updateMonitor),Object(p.c)(o,c).then(function(e){console.log(11111,e)})},a.goPre=function(){a.props.setRuleFormData(a.getRuleFormData())},a.changeNoticeType=function(e){var t=e.target.value;a.setState({connector_type:t})},a.changeUrl=function(e){a.setState({connector_url:e})},a.addRule=function(e,t){var n=Qt()(a.state.campusConf);n[e].products[t].rules.push(Qt()(Yt)),a.setState({campusConf:n})},a.addPro=function(e){var t=Qt()(a.state.campusConf);t[e].products.push(Qt()($t)),a.setState({campusConf:t})},a.addGroup=function(){var e=Qt()(a.state.campusConf);e.push(Qt()(ea)),a.setState({campusConf:e})},a.changeWarType=function(e,t,n,r){var c=Qt()(a.state.campusConf);c[t].products[n].rules[r].ruleType=e,a.setState({campusConf:c})},a.changeGroup=function(e,t){var n=Qt()(a.state.campusConf),r=Bt(e.split("_|_"),2),c=r[0],o=r[1];n[t].uniqueId=c,n[t].name=o,a.setState({campusConf:n})},a.changePro=function(e,t,n){var r=Qt()(a.state.campusConf),c=Bt(e.split("_|_"),2),o=c[0],l=c[1];r[t].products[n].info.productId=o,r[t].products[n].info.productName=l,a.setState({campusConf:r})},a.state={connector_type:"rocketmq",connector_topic:"IOT_DEVICE_MONITOR_TOPIC_2021",connector_tag:void 0,connector_url:void 0,campusConf:[Qt()(ea)]},a}var a,c,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ht(e,t)}(t,n["Component"]),a=t,(c=[{key:"componentDidMount",value:function(){var e=this.props.ruleFormData,t=e.sinkConf,a=e.campusConf;this.setState(qt({},t,{campusConf:Qt()(a)}))}},{key:"render",value:function(){var e=this,t=this.state,a=t.campusConf,n=t.connector_type,c=t.connector_topic,o=t.connector_tag,u=t.connector_url,s=this.props,d=s.devicegrouplist,m=s.productList;return r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a,Wt,r.a.createElement(l.a.Item,{label:"通知方式"},r.a.createElement(At.a.Group,{value:n,onChange:this.changeNoticeType},r.a.createElement(At.a,{value:"rocketmq"},"rocketMQ"),r.a.createElement(At.a,{value:"dingtalk"},"钉钉推送"))),"rocketmq"==n&&r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a.Item,{label:"topic"},r.a.createElement(P.a,{value:c},r.a.createElement(zt,{value:c},c))),o&&r.a.createElement(l.a.Item,{label:"tag"},r.a.createElement(P.a,{value:o},r.a.createElement(zt,{value:o},o))))||r.a.createElement(l.a.Item,{label:"钉钉推送地址"},r.a.createElement(i.a,{value:u,placeholder:"请输入钉钉推送地址",onChange:function(t){e.changeUrl(t)}})),r.a.createElement("div",{className:"devicegroupbox"},a.map(function(t,n){var c=t.uniqueId,o=t.name,i=t.products;return r.a.createElement("div",{key:c+"_"+n,className:"devicegroup"},r.a.createElement(l.a.Item,{className:"groupselect",label:"设备分组".concat(a[1]&&n+1||"")},r.a.createElement(P.a,{placeholder:"请选择设备分组",value:c+"_|_"+o,onChange:function(t){e.changeGroup(t,n)}},d.map(function(e){var t=e.id,a=e.name;return r.a.createElement(zt,{key:t,value:t+"_|_"+a},a)}))),r.a.createElement("div",{className:"pro-gropubox"},i.map(function(t,a){var c=t.info,o=t.rules,l=c.productId,i=c.productName;return r.a.createElement("div",{className:"pro-group",key:l+"_"+a},r.a.createElement(P.a,{className:"proselect",placeholder:"选择产品",showSearch:!0,optionFilterProp:"children",value:l+"_|_"+i,onChange:function(t){e.changePro(t,n,a)}},m.map(function(e,t){var a=e.productId,n=e.productName;return r.a.createElement(zt,{key:t,value:a+"_|_"+n},n)})),r.a.createElement("div",{className:"rulebox"},o.map(function(t,c){var o=t.ruleType,l=Mt(t,["ruleType"]);return r.a.createElement("div",{className:"rule",key:c},r.a.createElement(P.a,{placeholder:"选择告警方式",onChange:function(t){e.changeWarType(t,n,a,c)},value:o,className:"typeselect"},Xt.map(function(e){var t=e.id,a=e.nam;return r.a.createElement(zt,{key:t,value:t},a)})),r.a.createElement("div",{className:"onewarn"},e.getOneWarForm(o,l,[n,a,c])))}),r.a.createElement("a",{className:"addbtn",onClick:function(){e.addRule(n,a)}},"增加规则")))}),r.a.createElement("a",{className:"addbtn",onClick:function(){e.addPro(n)}},"增加产品")))}),a.length<2&&r.a.createElement("a",{className:"addbtn",onClick:this.addGroup},"增加分组"))),r.a.createElement("div",{className:"stepbtnbox"},r.a.createElement(S.a,{className:"btn",onClick:this.goPre},"上一步"),r.a.createElement(S.a,{className:"btn",type:"primary",onClick:this.handleSubmit},"提 交")))}}])&&Gt(a.prototype,c),o&&Gt(a,o),t}(),aa=l.a.create({name:"ruleForm"})(ta);a("UgUF");function na(e){return(na="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ra(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function ca(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ra(a,!0).forEach(function(t){oa(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ra(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function oa(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function la(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ia(e,t){return!t||"object"!==na(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ua(e){return(ua=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function sa(e,t){return(sa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var da={pageIndex:1,pageRows:9999},ma=function(e){function t(e){var a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(a=ia(this,ua(t).call(this,e))).goToStep=function(e){a.setState({current:e},function(){console.log(a.state)})},a.saveBaseInfo=function(e){a.setState({baseFormData:e,current:1})},a.setRuleFormData=function(e){a.setState({ruleFormData:e,current:0})},a.baseInfoForm={},a.ruleForm={},a.publicTypeForm={},a.state={current:0,ruleId:a.props.match.params.id,baseFormData:{},ruleFormData:[],devicegrouplist:[],productList:[],transferList:[]};var n=a.props.match.params.id;return n&&Object(p.c)(p.a.getMonitor,{id:n},{loading:!0}).then(function(e){var t=e.data,r=t.description,c=t.name,o=t.transferId,l=t.transferTopic,i=t.transferTag,u=t.ruleConf,s={description:r,name:c,transferId:o,transferTopic:l,transferTag:i},d=JSON.parse(u);a.setState({ruleId:n,baseFormData:s,ruleFormData:d},function(){console.log(9999,a.state)})}),a}var a,c,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&sa(e,t)}(t,n["Component"]),a=t,(c=[{key:"componentDidMount",value:function(){var e=this;Object(p.c)(p.a.getGroupList,ca({},da)).then(function(t){e.setState({devicegrouplist:t.data.list})}),Object(p.c)(p.a.getDownProduct,ca({},da)).then(function(t){var a=t.data.list;a&&a.length&&a.length>0&&e.setState({productList:a})}),Object(p.c)(p.a.getTransfer4Monitor).then(function(t){var a=t.data||[];console.log(44,a),e.setState({transferList:a})})}},{key:"render",value:function(){var e=this,t=this.state,a=t.current,n=t.ruleId,c=t.baseFormData,o=t.ruleFormData,l=t.devicegrouplist,i=t.productList,s=t.transferList;return r.a.createElement("div",{className:"device-monitordetailpage flex-column"},r.a.createElement(u.a,{backHandle:function(){return e.props.history.push({pathname:"/open/developCenter/deviceMonitor/list",page:"2"})},title:n?"编辑设备监控":"新增设备监控"}),r.a.createElement("div",{className:"step-header-wrapper"},r.a.createElement("div",{className:"step-header flex-row"},r.a.createElement("div",{className:"step-item flex-row flex1".concat(0===a?" current-step":"")},r.a.createElement("i",{className:"step-product"}),r.a.createElement("span",null,"1. 监控信息")),r.a.createElement("div",{className:"step-item flex1 flex-row".concat(1===a?" current-step":"")},r.a.createElement("i",{className:"step-data"}),r.a.createElement("span",null,"2. 规则配置")))),r.a.createElement("div",{className:"add-content-wrapper"},r.a.createElement("div",{className:"add-content"},r.a.createElement("div",{className:"steps-content"},[r.a.createElement(Rt,{saveBaseInfo:this.saveBaseInfo,baseFormData:c,transferList:s}),r.a.createElement(aa,{baseFormData:c,ruleFormData:o,ruleId:n,setRuleFormData:this.setRuleFormData,devicegrouplist:l,productList:i})][a]))))}}])&&la(a.prototype,c),o&&la(a,o),t}();function pa(e){var t=e.match.path;return r.a.createElement(c.e,null,r.a.createElement(c.c,{path:"".concat(t,"/list"),render:function(e){return r.a.createElement(Nt,e)}}),r.a.createElement(c.c,{path:"".concat(t,"/edit/:id"),render:function(e){return r.a.createElement(ma,e)}}),r.a.createElement(c.c,{path:"".concat(t,"/add"),render:function(e){return r.a.createElement(ma,e)}}),r.a.createElement(c.b,{to:"".concat(t,"/list")}))}function fa(e){var t=e.match.path;return r.a.createElement(c.e,null,r.a.createElement(c.c,{path:"".concat(t,"/projectManage"),component:ee}),r.a.createElement(c.c,{path:"".concat(t,"/serveDevelop"),component:ne}),r.a.createElement(c.c,{path:"".concat(t,"/serveDetail/:id"),component:Pe}),r.a.createElement(c.c,{path:"".concat(t,"/dataFlow"),component:wt}),r.a.createElement(c.c,{path:"".concat(t,"/deviceMonitor"),component:pa}),r.a.createElement(c.b,{to:"".concat(t,"/projectManage")}))}a.d(t,"default",function(){return fa})},UgUF:function(e,t,a){},gSWv:function(e,t,a){},ivPg:function(e,t,a){e.exports=a.p+"static/images/no-source-tip.681eb7825cf81b5da33967ff8571f3c6.png"},vQck:function(e,t,a){}}]);